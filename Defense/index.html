
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://faisalmemon.github.io/the-road-to-zero/Defense/">
      
      
        <link rel="prev" href="../Leveraging/">
      
      
        <link rel="next" href="../AttackSurface/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.2">
    
    
      
        <title>iOS Defense Mechanisms - The Road to Zero</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f56500e0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ios-defense-mechanisms" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="The Road to Zero" class="md-header__button md-logo" aria-label="The Road to Zero" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Road to Zero
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              iOS Defense Mechanisms
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/faisalmemon/the-road-to-zero/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="The Road to Zero" class="md-nav__button md-logo" aria-label="The Road to Zero" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    The Road to Zero
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/faisalmemon/the-road-to-zero/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Author/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ZeroDay/" class="md-nav__link">
        Zero Day
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Hammer/" class="md-nav__link">
        The Hammer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Mach/" class="md-nav__link">
        Mach Programming
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../KernelDebugging/" class="md-nav__link">
        Kernel Debugging
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../JailbreakSetup/" class="md-nav__link">
        Jailbreak Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../InspectingMobileSafari/" class="md-nav__link">
        Inspecting Mobile Safari
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Leveraging/" class="md-nav__link">
        Leveraging Research
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          iOS Defense Mechanisms
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        iOS Defense Mechanisms
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#history-of-ios-mitigation-techniques" class="md-nav__link">
    History of iOS Mitigation Techniques
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#os-mitigation-techniques" class="md-nav__link">
    OS Mitigation Techniques
  </a>
  
    <nav class="md-nav" aria-label="OS Mitigation Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#code-sign-mitigation-technique" class="md-nav__link">
    Code Sign mitigation technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sandbox-mitigation-technique" class="md-nav__link">
    Sandbox Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aslr-mitigation-technique" class="md-nav__link">
    ASLR Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dep-mitigation-technique" class="md-nav__link">
    DEP Mitigation Technique
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#history-of-hardware-mitigation-techniques" class="md-nav__link">
    History of Hardware Mitigation Techniques
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware-mitigation-techniques" class="md-nav__link">
    Hardware Mitigation Techniques
  </a>
  
    <nav class="md-nav" aria-label="Hardware Mitigation Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pan-mitigation-technique" class="md-nav__link">
    PAN Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hpd-mitigation-technique" class="md-nav__link">
    HPD Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pac-mitigation-technique" class="md-nav__link">
    PAC Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mte-mitigation-technique" class="md-nav__link">
    MTE Mitigation Technique
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#software-mitigation-techniques" class="md-nav__link">
    Software Mitigation Techniques
  </a>
  
    <nav class="md-nav" aria-label="Software Mitigation Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kpp-mitigation-technique" class="md-nav__link">
    KPP Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ktrr-mitigation-technique" class="md-nav__link">
    KTRR Mitigation Technique
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../AttackSurface/" class="md-nav__link">
        Attack Surface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../KernelBugHunting/" class="md-nav__link">
        Kernel Bug Hunting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Bibliography/" class="md-nav__link">
        Bibliography
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#history-of-ios-mitigation-techniques" class="md-nav__link">
    History of iOS Mitigation Techniques
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#os-mitigation-techniques" class="md-nav__link">
    OS Mitigation Techniques
  </a>
  
    <nav class="md-nav" aria-label="OS Mitigation Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#code-sign-mitigation-technique" class="md-nav__link">
    Code Sign mitigation technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sandbox-mitigation-technique" class="md-nav__link">
    Sandbox Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aslr-mitigation-technique" class="md-nav__link">
    ASLR Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dep-mitigation-technique" class="md-nav__link">
    DEP Mitigation Technique
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#history-of-hardware-mitigation-techniques" class="md-nav__link">
    History of Hardware Mitigation Techniques
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware-mitigation-techniques" class="md-nav__link">
    Hardware Mitigation Techniques
  </a>
  
    <nav class="md-nav" aria-label="Hardware Mitigation Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pan-mitigation-technique" class="md-nav__link">
    PAN Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hpd-mitigation-technique" class="md-nav__link">
    HPD Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pac-mitigation-technique" class="md-nav__link">
    PAC Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mte-mitigation-technique" class="md-nav__link">
    MTE Mitigation Technique
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#software-mitigation-techniques" class="md-nav__link">
    Software Mitigation Techniques
  </a>
  
    <nav class="md-nav" aria-label="Software Mitigation Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kpp-mitigation-technique" class="md-nav__link">
    KPP Mitigation Technique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ktrr-mitigation-technique" class="md-nav__link">
    KTRR Mitigation Technique
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="ios-defense-mechanisms">iOS Defense Mechanisms</h1>
<p>The iOS system has become more sophisticated over time as the usage pattern and commercialisation of it has evolved.  Here we survey the <a href="../Bibliography/#MT">history</a> of the defense mechanisms (mitigation techniques) that have been deployed by Apple in iOS, often supported by enhancements available in <a href="../Bibliography/#HW">hardware</a>.</p>
<h2 id="history-of-ios-mitigation-techniques">History of iOS Mitigation Techniques</h2>
<table>
<thead>
<tr>
<th>iOS Version</th>
<th>Mechanism</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.x</td>
<td>Encrypted OS images</td>
<td>Everything runs as root; no code sign or sandbox</td>
</tr>
<tr>
<td>2.x</td>
<td>Code Sign, Sandbox</td>
<td>The Sandbox is the most durable and important technique to date</td>
</tr>
<tr>
<td>3.x</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>4.x</td>
<td>ASLR/DEP (iOS 4.3)</td>
<td>-</td>
</tr>
<tr>
<td>5.x</td>
<td>User mode ASLR</td>
<td>Harder to write shell code</td>
</tr>
<tr>
<td>6.x</td>
<td>Kernel mode ASLR, Kernel Address Space isolation</td>
<td>Harder to reach kernel</td>
</tr>
</tbody>
</table>
<h2 id="os-mitigation-techniques">OS Mitigation Techniques</h2>
<h3 id="code-sign-mitigation-technique">Code Sign mitigation technique</h3>
<h3 id="sandbox-mitigation-technique">Sandbox Mitigation Technique</h3>
<h3 id="aslr-mitigation-technique">ASLR Mitigation Technique</h3>
<h3 id="dep-mitigation-technique">DEP Mitigation Technique</h3>
<h2 id="history-of-hardware-mitigation-techniques">History of Hardware Mitigation Techniques</h2>
<p>Mitigation techniques purely in Software can have an adverse effect on performance.  When the hardware provides assistance, the software can then offer greater mitigations at no, or little, performance cost.</p>
<p>Not all available hardware mitigations are used in iOS (Darwin).  But the introduction of newer hardware protections can give hints as to what software mitigations could be introduced.</p>
<p>In the following table, we list recent iPhones (a representative example), the Apple Silicon that is provided, as the hardware architecture of the chip (from the compiler's perspective because that is what Darwin leverages).  Finally we list the software migitations that there then offered.</p>
<p>For details on the Chip-to-Compiler architecture mapping, see 
<a href="../Bibliography/#AA">AArch64TargetParser.def</a>.</p>
<table>
<thead>
<tr>
<th>iPhone Model</th>
<th>Apple Silicon</th>
<th>ARM Architecture (HW Migitations)</th>
<th>SW Mitigations</th>
</tr>
</thead>
<tbody>
<tr>
<td>5s</td>
<td>A7</td>
<td>ARMv8.0</td>
<td>KPP</td>
</tr>
<tr>
<td>6</td>
<td>A8</td>
<td>ARMv8.0</td>
<td>KPP</td>
</tr>
<tr>
<td>6s</td>
<td>A9</td>
<td>ARMv8.0</td>
<td>KPP</td>
</tr>
<tr>
<td>7</td>
<td>A10</td>
<td>ARMv8.1 (PAN)</td>
<td>KTRR</td>
</tr>
<tr>
<td>X</td>
<td>A11</td>
<td>ARMv8.2 (PAN, HPD)</td>
<td>KTRR, APRR</td>
</tr>
<tr>
<td>XR</td>
<td>A12</td>
<td>ARMv8.3 (PAN, HPD, PAC)</td>
<td>KTRR, APRR, PPL</td>
</tr>
<tr>
<td>11</td>
<td>A13</td>
<td>ARMv8.4 (PAN, HPD, PAC)</td>
<td>KTRR, APRR, PPL</td>
</tr>
<tr>
<td>12</td>
<td>A14</td>
<td>ARMv8.5 (PAN, HPD, PAC, MTE)</td>
<td>KTRR, APRR, PPL</td>
</tr>
<tr>
<td>13</td>
<td>A15</td>
<td>ARMv8.5 (PAN, HPD, PAC, MTE)</td>
<td>KTRR, APRR, PPL</td>
</tr>
</tbody>
</table>
<h2 id="hardware-mitigation-techniques">Hardware Mitigation Techniques</h2>
<h3 id="pan-mitigation-technique">PAN Mitigation Technique</h3>
<h3 id="hpd-mitigation-technique">HPD Mitigation Technique</h3>
<h3 id="pac-mitigation-technique">PAC Mitigation Technique</h3>
<h3 id="mte-mitigation-technique">MTE Mitigation Technique</h3>
<p><a href="../Bibliography/#MTE">Memory Tagging Extension (MTE)</a> is where each memory allocation is given a tag, and then any pointer that reaches that memory is checked to see if the pointer has the correct tag.  If not, it is an invalid pointer and fails.  Therefore, pointers become more restricted to where they can point to, so arbitrary maliciously crafted memory cannot be used.</p>
<p>The immediate benefit of this feature is that if two separate memory allocations are done, and they are contiguous then advancing a pointer from one allocation to reach the next allocation would fail.  This therefore is a upper bound dereference guard.  Similarly if a pointer points to memory that has been deallocated and then allocated, the newly allocated memory could have a different tag to the original memory allocation.  In such cases it would defeat a Use-After-Free exploit.</p>
<p>The MTE feature is not that strong because the number of tags is limited to 4 bits, and thus 16 possibilities.  As of 4th December, 2021, iOS does not enable MTE.  So it is a potential mitigation not yet being utilised.</p>
<h2 id="software-mitigation-techniques">Software Mitigation Techniques</h2>
<h3 id="kpp-mitigation-technique">KPP Mitigation Technique</h3>
<p>KPP is Kernel Patch Protection, also known as WatchTower.</p>
<p>In ARMv8 there is a privilege model where lower privileged subsystems cannot access the memory of higher privileged subsystems (Memory Privilege), and lower privileged subsystems cannot access the CPU resources of higher privileged subsystems (Register Access Privilege).</p>
<p>ARM denotes the Exception Privilege levels as EL0 (lowest privilege), through to EL1, EL2, and EL3 (highest privilege).  A given implementation does not need to use all the levels.</p>
<p>Privilege level changes can only occur when an Exception occurs.  Exceptions are interruptions to the flow of execution of a program.  They can either be due to the instruction of the program being executed, or unrelated to the instruction.</p>
<p>When an Exception occurs due to the instruction being executed, it is just known as an Exception.  When an Exception occurs unrelated to the instruction being executed, we call it an Interrupt (a special case of an Exception).</p>
<p>KPP is a system which checks the Kernel.  To do this is runs at a higher privilege level so cannot be tampered with by Kernel code.</p>
<p>To enable a separation of privileges, iOS arranges its code so:</p>
<ul>
<li>EL0 is where application code runs (least privilege)</li>
<li>EL1 is where the kernel runs</li>
<li>EL3 is where the KPP code runs</li>
</ul>
<p>To get to EL3 from either EL0 or EL1, an Exception is needed.</p>
<p>The two Exceptions used are:</p>
<ul>
<li>Whenever a FPU (Floating Point Unit) instruction is executed</li>
<li>Whenever a IRQ handler fires</li>
</ul>
<p>In the write-up by Xerub this is called <a href="../Bibliography/#TT">Tick-Tock</a>.  The tick is the FPU Exception, the tock is the IRQ Interrupt.  That is because it is a state machine whereby KPP checks a portion of the kernel in the tick, and re-enables the FPU upon success.  FPU usage in the tock routes interrupts into the KPP code.  If this mutually supporting state machine hits an error, the system panics.</p>
<h3 id="ktrr-mitigation-technique">KTRR Mitigation Technique</h3>
<p>KTRR is <a href="../Bibliography/#KTRR">Kernel Text Read-Only Region</a> Protection.  It is a replacement for KPP which had a software bypass.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.12658920.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5cf534bf.min.js"></script>
      
    
  </body>
</html>