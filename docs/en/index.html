<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="By Mr. Faisal Memon" />
  <title>The Road to Zero, First Edition</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="style/gitHubStyle.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  
</head>
<body>
<header id="title-block-header">
<h1 class="title">The Road to Zero, First Edition</h1>
<p class="author">By Mr. Faisal Memon</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#disclaimer">Disclaimer</a></li>
<li><a href="#preface">Preface</a></li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#what-is-a-zero-day">What is a Zero Day?</a></li>
<li><a href="#market-dynamics">Market Dynamics</a></li>
<li><a href="#ethics">Ethics</a></li>
<li><a href="#burn-out-and-mental-health">Burn out and mental health</a></li>
<li><a href="#resources">Resources</a></li>
</ul></li>
<li><a href="#bibliography">Bibliography</a></li>
</ul>
</nav>
<h1 id="disclaimer">Disclaimer</h1>
<p>Copyright Faisal Memon 2021. All Rights Reserved.</p>
<p>This publication is provided “as is” without warranty of any kind, either express or implied, including, but not limited to, the implied warranties of merchantability, fitness for a particular purpose, or non-infringement.</p>
<p>This publication could include technical inaccuracies or typographical errors. Changes are periodically added to the information herein. These changes will be incorporated in new editions of the publication.</p>
<p>Apple makes no explicit or implied endorsement of this work. Materials in this book have been determined from public information sources and binaries, or materials provided by the Apple Software Development Kits.</p>
<p>Positions held by the author, as an employee or contractor, at past or future companies and institutions makes no explicit or implied endorsement of this work by those entities.</p>
<p>Every effort has been made to identify trademark terms in this text. If there is an error or omission, please contact the author. We have thus far recognized the following trademarks:</p>
<h1 id="preface">Preface</h1>
<p>This book has come about because having written a book on iOS Crash Dump Analysis, I found that most of my audience were security-focussed engineers.</p>
<p>I share the same passion. I have been studying various “Crack Me” challenges. I thought I was doing the correct preparation for vulnerability analysis.</p>
<p>When I looked at successful exploits, mostly on Google Project Zero <span class="citation" data-cites="gpz">(“Google Project Zero” 2021)</span>, I found there was a technique gap. Not only do you need to apply standard techniques, you need to apply them on unfamiliar APIs, such as <code>IOSurface</code> and <code>XPC</code>. So I naturally looked at Crack Me challenges using those APIs. I wasn’t able to find any.</p>
<p>What I am attempting to do is to document my journey in acquiring the skills to find Zero Day Vulnerabilities on iOS in the form of a book. That is so that future engineers will have a book to take them along the same journey.</p>
<p>So the nature of this book is mostly a tutorial but with appropriate theory explanations or system knowledge explained along the way.</p>
<p>I take the view that when you are exploring new things, cost barriers are magnified because you are not sure at the time whether you will stick with it or enjoy it. Paying a lot of money for golf clubs is a straightforward choice if you’ve already fallen in love with the game. So I am going to work on the basis the reader has modest resources to hand (compared to the professionals in this area). I assume you have an iDevice, a Mac, an Xcode developer account, and maybe software, free or licensed at modest cost.</p>
<p>There is one last element I intend to add to the mix. The Hacker Mentality. This is the attitude of mind where an innocent piece of information can be viewed through a hacker’s lens. That offers the foothold for us to commence experimentation and discovery that then later will result in new vulnerabilities.</p>
<p>If I am successful, I hope this book will become the handbook of vulnerability craftsmanship in the same way that Code Complete (<span class="citation" data-cites="codecomplete2">McConnell (2004)</span>) became the handbook of software craftsmanship.</p>
<p>One thing in particular that attracts me to iOS is that its one of the hardest platforms to circumvent. It may turn out I don’t reach the high bar needed to make progress on this platform. But if it was going to be easy, what would be the point in trying?</p>
<h1 id="acknowledgements">Acknowledgements</h1>
<p>I’d like to acknowledge the help and support of my colleagues for writing this book.</p>
<p>I am indebted to the support of my Chinese-language translator, TBC, for helping bring the Chinese edition of the book into fruition.</p>
<p>Putting together this work was only possible because it was built upon generously provided open source tools, in particular <code>pandoc</code> which made writing the text of the book a pleasure.</p>
<p>Lastly, I’d like to thank my supportive family whilst I was locked in my study, and largely absent. Thank you Junghyun, and Christopher.</p>
<h1 id="introduction">Introduction</h1>
<p>This is a book about Zero Day Vulnerabilities.</p>
<p>It is called “The Road to Zero” because it is primarily a tutorial guide to take you along the path needed to find your own vulnerabilities.</p>
<p>The focus of our book is iOS. In fact, when we talk about iOS we often mean the family of Operating Systems from Apple that are based around the same underpinnings. It would be more accurate to say this book focusses on Darwin, the common UNIX technology stack from which macOS, iOS, tvOS, watchOS are derived.</p>
<p>Likewise when we refer to a device, we say iDevice because there are lots of different Apple produced products in different device classes, such as various models of iPhone, or iPad.</p>
<p>This introductory chapter covers some ground which is more of interest to the general reader, and answers those softer back-story questions that need to be addressed before we can make a more technically focussed discussion of the job in hand.</p>
<h2 id="what-is-a-zero-day">What is a Zero Day?</h2>
<p>A Zero Day Vulnerability is a security vulnerability which is not yet known to the vendor responsible for the platform that has the vulnerability. Once notified, the “day” value increases each day regardless of the action the vendor does. So a 300-Day vulnerability is one that has been reported to the vendor 300 days ago. It might have been patched on day 30. It might have been patched on day 90. It might never be patched. Even if it has been patched, a vulnerability disclosed 300 days ago is still a 300-Day vulnerability.</p>
<p>As soon as a piece of software (it could also be firmware, a configuration file, resource file, etc.) is written the opportunity for a vulnerability arises. It could be that no one ever discovers the problem. Of the set of vulnerabilities that exist, some are found by humans (or their tools). At that point there is an asymmetry between those that know about the problem and those that do not know about the problem. Such knowledge can be valuable. That knowledge is sometimes traded, sold, or shared. Other times it is kept secret. It is only when the vendor is told about the vulnerability, that the bug is no longer a Zero Day Vulnerability. The date of disclosure then governs the “day” of the vulnerability.</p>
<p>In order to encourage disclosure of vulnerabilities, vendors sometimes have a bug bounty program. They can reward researchers with money, or a promise to contribute to a charity, or with fame by acknowledging them as finding the vulnerability. Since researchers sometimes hoard vulnerabilities so that can do further research unlocked by them, platform owners have responded by giving vetted researchers enhanced access. In particular, Apple has introduced the Security Research Device programme.</p>
<h2 id="market-dynamics">Market Dynamics</h2>
<p>Sometimes multiple groups of engineers working separately find the same Zero Day. Sometimes a researcher suspects a bunch of related Zero Days, but only fully documents one. Likewise, sometimes the vendor only strictly fixes the vulnerability reported, and leaves adjacent issues as untreated. That in turn creates a dynamic in the market where recent bug fix releases are scanned for security fixes by researchers, so that adjacent issues can be explored.</p>
<p>As the stock of vulnerabilities has increased over time, organisations have sought to organize and catalog such findings. This gives insights on the kinds of things that can go wrong. Vendors will improve their game by adding mitigations, which in turn will be researched for weaknesses. So it is a cat-and-mouse game, getting ever more sophisticated.</p>
<p>If we consider “The Road to Zero” in dollar terms, where the dollar amount is the equipment cost, human time cost, etc. to achieve a 0-day, we can think of this book as a stepping stone. Firstly there is the cost to acquiring basic skills. Then there is the cost to acquiring similar skills but on iOS (Darwin) code bases. This book reduces that cost. Finally, there is the cost of finding original 0-days in iOS itself. We effectively make that final step cheaper because our skills have improved via the earlier steps.</p>
<p>The market dynamics for iOS 0-day vulnerabilities has changed over time due to the changing nature of the Threat Model that Apple face, and the changing role iPhones and other devices have in our lives. Originally the iPhone had no third party apps. There were two main threats the system had to model. First were the Jailbreak community who wanted to customise the iPhone experience and add their own apps. Second were those that wanted to Carrier-unlock their phone. The phone price would typically be subsidized by the telecommunications operator via a subscription to their network over a period of time before you were allowed to buy a subscription to another operator. With such a threat model, a simple layer of defense was needed. Apple introduced the iPhone App Store, together with sandboxed apps, requiring code-signing for installation for all third party apps. In those days, a vulnerability alone was enough to defeat the security of the phone. So finding and exploiting a 0-day was “most of the game”.</p>
<p>Over the ensuing years, Apple would increase the depth of their defenses with new security measures, but bug hunters could keep up. However, the nature of the market changed. As there became more apps, and everyday work flows became connected to, and supported by, mobile phone apps, the value of the information in your phone drew the interest of government entities, criminals, and law-enforcement, as well as “friends” and family. Now the threat model is diverse and profound. The phone must resist attack when in physical possession of an attacker (such as a phone stolen after a crime). It must resist attack wirelessly when in a hostile network environment, such as an international conference hosting a politicaly sensitive agenda, or an innocent trip to a coffee shop. It must resist attack from a curious partner, grandparent or child.</p>
<p>Since iDevices now have many layers of security, it is not one 0-day alone that unlock deeper access to the system. There are chains of vulnerabilities that need to be exploited to fully attack the system. Each subsystem has become a complex entity. So the market is now one of specialization. One person might be expert in WebKit vulnerabilities. One person might be expert in PDF file format weaknesses. One person might now how to construct “gadgets” to achieve a desired control flow path. There are companies that buy up individual vulnerabilities and assemble them. They might leverage toolkits from others for post-exploitation, etc.</p>
<p>No one person is an industry. We are small players in a complex dynamic market. So it is important to understand what our goals are, what skills we have or desire, and how we see ourselves in this bigger picture.</p>
<p>As the skill requirements have increased, together with increased specialization, the monetary cost of “doing business” has increased. This places security researchers in a novel “taxation” dynamic. Apple will improve their security. Offensive security companies will need more money to crack into the iDevices as their exploit chains will become longer and more esoteric. They will need to buy in exploits, research material, and hire from a small pool of talent to do the equivalent in-house. Such companies will demand higher fees for their tools, and their solutions will have shorter lifetimes. Law enforcement, military and government entities will need to pay more for such tools. The pressure release value is at the political level. Either politicians agree to allowing strong protections in consumer devices, iPhone chiefly among them. This means taxation on the population (or a re-allocation of funds) to pay the offensive companies more money, and more often, for valuable access to mobile phone information. Or on the other hand, politicians can espouse back-doors into consumer devices. This lowers the “taxation” but increases malicious activity from adversaries.</p>
<p>This explains our current surreal state of affairs. A vulnerabilty can be worth millions, because it is a tax on millions on users that require confidentiality, security and privacy.</p>
<h2 id="ethics">Ethics</h2>
<p>There are a lot of ethical consideration surrounding Zero Day Vulnerabilities (hereafter we shall say 0-day). The consensus is that you should not openly discuss or explain vulnerabilities until the bug is 90 days since disclosure (i.e. a 90-day). So we don’t place 0-days in this text. But we create software modules of our own, reachable from a non-compromised device. These modules emulate closely the properties of an exposed subsystem so we can discuss, explore and compromise “our own code”. We also discuss past vulnerabilities that have been patched by Apple.</p>
<p>Will this book lead to a proliferation of 0-days? My opinion is that the malicious actors already have the tools and knowledge they need. It is the wider engineering community that need to up-skill in this area. Most of these people will not be malicious. They will enhance and improve the security of systems.</p>
<p>In truth, we often tell ourselves stories that make us comfortable with what we are doing, particularly if our pay-cheque aligns with that. The best of intentions can result in adverse outcomes, as well as the converse. For example, a researcher working on their PhD might see a bug class, but just have time to explore one fully, writing up a Proof of Concept (POC), which is duly responsibly disclosed, and patched, before being published as a finding by the researcher. Another engineer might read the write-up, look at the binary diff related to the fix, notice associated vulnerabilities, and produce a variant POC and sell that to a market place for significant money. At that point, the vulnerability could be combined with others and militarized. The question is then who made that weapon, and would it have come to existance anyway? Such a weapon could be used to save lives, lose lives, start conflict or avoid conflict depending on the circumstances politically.</p>
<h2 id="burn-out-and-mental-health">Burn out and mental health</h2>
<p>We haven’t even started yet, and so why are we bringing up the topic of burn out?</p>
<p>When you start training your mind to think like a machine thinks, or start working through the details of a subsystem in great deal, it can be both engaging and exhausting. After a period of youthful exhuberance can be a down hill descent of despair when you can nearly solve something, but cannot quite get it done.</p>
<p>As ever, there is a way to hack around such problems! First, the boring stuff. Solid, regular and good-quality sleep. Three good meals a day. 30 minutes excercise a day - a good walk for example. Second, the mind hack. That first hour of the day, maybe the first half hour is the golden time. Save the heaviest and most difficult mental task to only that dream slot. Leave the manual, boring and tedious investigation work to the end of your work day. Everything else sits in-between those two things. Third, the multi-tasking hack. If security research is the only thing you are doing, then yes you have focus but you are going to have ups and downs. The way around that is to have two activities that vary in importance over a period of months but are a constant presence. One good parallel activity is software engineering. You could be writing a security tool, for example, or something unrelated. Software engineering is in some ways the opposite of vulrunability research. It is building abstractions, adding layers, and working in a problem domain instead of the machine domain. It feels very constructive and creative. The fourth hack is facilitated by the git version control system. Everything you do must be recorded and tracked with git. Because with git, you can make small incremental improvements, and then build on those. This gives a discipline of head space you need to achieve complex things. You just keep incrementally developing your ideas, code, and experiments. Do not try and keep complexity in your mind for a long period. Just keep dumping them into text files, code, etc., into a git repository. Then at the end of each day, you will feel that you made progress, even if there is no big result. That will save your sanity.</p>
<h2 id="resources">Resources</h2>
<p>To complement the book, there is a website of resources which is intended to be used alongside the printed material so example projects can be setup and run by yourself and experimented with. All references in this book are collected into the Bibliography Chapter at the end of the book. There you will find URLs to resources, for example.</p>
<p>The GitHub website supporting the book is at <span class="citation" data-cites="trtzgithub">(“The Road to Zero Book Github Resources” 2021)</span></p>
<h1 class="unnumbered" id="bibliography">Bibliography</h1>
<div id="refs" class="references hanging-indent" role="doc-bibliography">
<div id="ref-gpz">
<p>“Google Project Zero.” 2021.</p>
</div>
<div id="ref-codecomplete2">
<p>McConnell, Steve. 2004. <em>Code Complete</em>. Second Edition. 0735619670.</p>
</div>
<div id="ref-trtzgithub">
<p>“The Road to Zero Book Github Resources.” 2021. <a href="https://github.com/faisalmemon/the-road-to-zero">https://github.com/faisalmemon/the-road-to-zero</a>.</p>
</div>
</div>
</body>
</html>
