<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/Concepts/Localization.rtfd -->
<!-- Date: Sun Jun 28 19:36:20 1998 -->
<head>
<title>Localization</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Release 3.3&nbsp; Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p><br><br><br><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times" size="+3"><i>Localization</i></font>

<p><br><br><br><br>

<p><font face="Times">This file provides NEXTSTEP application developers with the information needed to develop localized versions of their applications.</font>

<p><font face="Times">Conceptual material is presented first, followed by the specific procedures for localizing an application.&nbsp; The information provided here is relevant at any point in the development cycle, so you can either start off your application development process with localization in mind, or you can wait and deal with localization issues once your application is stable.</font></td></tr>

</table>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=5></td>

<td><font face="Helvetica" size="+2"><b>What is Localization?</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Localization is the process of making your application language-independent, so that a user can choose to use your application in any of a number of languages that you make available.&nbsp; The process of localizing your application consists of two distinct phases:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">First, you make your application localizable.&nbsp; That is, you build localization support into your application by centralizing the language-specific text, images, and sounds and placing them in files in a language-specific subdirectory of your project directory.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Second, you localize the application.&nbsp; That is, for each additional language that you wish to support, you create language-specific versions of the text, image, and sound files.&nbsp; This translation process doesn't involve modifications to your source code (although any nib files will need to be edited with Interface Builder), so you can have this step performed for you either by an in-house translator or by an outside translation service.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Even if you don't have immediate plans to support multiple languages in your application, there are advantages to designing your application so that it provides support for localization:&nbsp; First, with proper design your application's source code won't have to be touched in order for the application to be localized; therefore, you won't run the risk of introducing additional bugs by putting the necessary hooks in later.&nbsp; Second, testing of the localization code can be done along with the initial monolingual product, so the amount of testing needed for any future localized version will be minimized.</font>

<p><font face="Times">Currently, localization support is provided for the following areas:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Embedded text strings</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Text strings in nib files</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">TIFF and EPS files (which may contain text or culture-specific images)</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Date, time, and currency formats</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Auxiliary files (such as help files and sound files)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">In the current release, language support is provided for English, French, German, Italian, Japanese, Portuguese, Spanish, and Swedish.&nbsp; If you wish to provide other localized versions of your application, you'll need to contact NeXT Developer Support for additional information and support.&nbsp; In general, you can localize your application for any language that can be expressed in the standard NEXTSTEP character encoding.</font></td></tr>

</table>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=5></td>

<td><font face="Helvetica" size="+2"><b>Localization Concepts</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This section briefly describes some concepts that you need to understand in order to prepare your application for localization.&nbsp; A subsequent section describes in detail the procedures you need to follow, and the final two sections describe the functions you'll be using as you modify your source code.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>The Preferences Application and Language Prioritization</b></font>

<p><font face="Times">The Preferences application lets users prioritize (that is, set the order of) the languages they prefer to use.&nbsp; In the current release, the language choices that are available in Preferences include English, French, German, and Spanish.</font>

<p><font face="Times">If your application isn't localized, users can only use it in the language you wrote it in, no matter how their language preferences are set in Preferences.&nbsp; In order to localize your application, you'll start by placing in external, editable files all the language-specific and culture-specific text, images, and sounds in your application.&nbsp; Then you'll have those files translated into whatever additional languages you wish to support.</font>

<p><font face="Times">Once your application contains translated versions of the externalized language-specific files, it can load all the necessary language-specific information from the appropriate set of files, based on the user's language preferences. Thus, your application automatically presents itself to each user in that user's preferred language-ideally (but not necessarily), the user's first choice.&nbsp; For example, assume that one user has given the default system languages the order:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">1&nbsp; English</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">2&nbsp; Spanish</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">3&nbsp; German</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">4&nbsp; French</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">5&nbsp; Italian</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">6&nbsp; Swedish</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">7&nbsp; Japanese</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">8&nbsp; Portuguese</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">and another user has given them the order:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">1&nbsp; Spanish</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">2&nbsp; French</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">3&nbsp; German</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">4&nbsp; English</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">5&nbsp; Italian</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">6&nbsp; Swedish</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">7&nbsp; Japanese</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">8&nbsp; Portuguese</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">If your application supported just English and French, then your application would appear to the first user in English (that user's first choice), and to the second user in French (that user's second choice).</font>

<p><font face="Times">Note:&nbsp; NeXT software and documentation is currently available in English, French, German, Japanese, Spanish, and Swedish.&nbsp; Since the Workspace Manager and other key NeXT applications (for example, Preferences and Mail) are available in these languages, we recommend that you consider supporting one or more of these languages now, and then supporting other languages once NeXT software and documentation become available for them.</font>

<p><font face="Times">If you do localize your application for a language not yet supported by NeXT (Russian, for example), you'll have to make that language preference available to your users in the Preferences application.&nbsp; Information about how to extend the user's set of available languages is available from NeXT Developer Support.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Application Directory Organization</b></font>

<p><font face="Times">NEXTSTEP applications (at least those developed prior to Release 3.0) may be represented by a single executable file, which is in Mach-O (Mach object file) format; this executable file contains segments that hold the application's icon, nib archives, images, sounds, and other data:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F0.gif" width=306 height=18></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">More typically an application is organized as a <i>file package</i>--a special type of directory that looks and behaves like a file.&nbsp; The file package contains the executable file, plus any additional files associated with the application.&nbsp; Although you might still choose to compile interface, image, and sound data into segments of the executable file, the file package organization allows you the option of leaving such information in external files instead.&nbsp; In this case, the organization would look something like this:</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F1.gif" width=342 height=72></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The file package organization is useful because it gives the developer a place to store external files used by the application.&nbsp; This is essential when you localize your application, because you need to create one <i>language</i><b>.lproj </b>subdirectory for each language that you want your application to support; each <i>language</i><b>.lproj</b> subdirectory will contain the language-specific and culture-specific files used by your application.&nbsp; Here's how your application might be organized when it has been localized (note that the files for the source language have been placed in the executable file, rather than in a &quot;.lproj&quot; directory):</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F2.gif" width=360 height=144></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The names for language subdirectories shown in this example aren't arbitrary-the language subdirectories must be named <b>English.lproj</b>, <b>French.lproj</b>, <b>German.lproj</b>, and <b>Spanish.lproj</b>.&nbsp; Specifically, the name <i>language</i> in the <i>language</i><b>.lproj</b> directory name must be exactly the same as the name of the language as it appears in Preferences. Even if you extend the set of available languages beyond the standard four, you'll need to maintain this exact correspondence between the name of the language as it appears in the directory name and as it appears in Preferences.</font>

<p><font face="Times">Although it's useful for you to understand the structure of the application wrapper and its language-specific subdirectories, you don't have to worry about creating and maintaining the correct directory structure--the ProjectBuilder application manages all these details for you.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">Throughout this document, source_language is used to refer to whatever language you're using for application development (English is typically used for development, but it need not be); target_language refers to any of a number of additional languages that you intend to support in your application.&nbsp; The terms <i>source_language</i><b>.lproj</b> and <i>target_language</i><b>.lproj</b> are used as well.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Functions Used in Localization</b></font>

<p><font face="Times">In addition to organizing the language-specific parts of your application into files contained in your application's &quot;.lproj&quot; subdirectories, you'll also add some functions to your source code in order to access the information contained in those &quot;.lproj&quot; subdirectories.</font>

<p><font face="Times">These functions work by first getting the list of languages (as the user has set in Preferences), and then looking through the list in order, until a language is found for which your application has an &quot;.lproj&quot; subdirectory.&nbsp; Once such a match is found, that subdirectory is searched for string files, nib files, or whatever else is needed by your application.</font>

<p><font face="Times">In the interest of robustness, these functions are defined in such a way that your application can run even if no &quot;.lproj&quot; directories exist (for example, if a user accidentally deletes them).&nbsp; If the appropriate &quot;.lproj&quot; directory or file isn't found, the source-language version of the language-specific data is searched for internally, in the appropriate section of the executable file.</font>

<p><font face="Times">Therefore, you don't actually need to ship a <i>source_language</i><b>.lproj</b> subdirectory.&nbsp; Instead, you can put that version of your application's nib, image, and sound files into the Mach-O file, just as you probably do now.&nbsp; You'll need to create a <i>source_language</i><b>.lproj</b> subdirectory as part of the process of localizing your application, but that directory is simply a place for you to put the language-specific files that translators will work from.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>String Tables and String Files</b></font>

<p><font face="Times">This section describes string tables and string files, which enable you to externalize and localize the strings that are embedded in your application's source code.</font>

<p><font face="Times">First, keep in mind that there are two kinds of embedded strings:&nbsp; those that the user sees, and those that the user doesn't see.&nbsp; An example of a string the user doesn't see is contained in the following C statement:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">matches = sscanf(s, &#34;%d %d %s&#34;, &amp;first, &amp;last, &amp;other);</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The string &quot;%d %d %s&quot; does not need to be made localizable, since the user never sees it and it has no effect on anything that the user does see (as would a font name).&nbsp; On the other hand, here is an example of a string that the user does see, and that therefore does need to be made localizable:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXRunAlertPanel(NULL, &#34;Your printer is out of paper!&#34;, NULL, NULL, NULL);</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The purpose of a string table is to associate pairs of character strings, where each pair consists of a <i>key</i> and a <i>value</i>.&nbsp; In this example, pairs of keys and values in the string table are used in order to provide French translations of English character strings:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Helvetica"><b>Key&nbsp;&nbsp;&nbsp; Value</b></font><br>
<font face="Times">&quot;Yes&quot;&nbsp; &quot;Oui&quot;</font>

<p><font face="Times">&quot;No&quot;&nbsp;&nbsp; &quot;Non&quot;</font>

<p><font face="Times">&quot;OK&quot;&nbsp;&nbsp; NULL</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Asking for a value associated with a particular key causes the corresponding value to be returned.&nbsp; If the value is NULL, then the key is returned instead.</font>

<p><font face="Times">Internally, applications use the NXStringTable object to represent these tables of associated keys and values.</font>

<p><font face="Times">Externally, these language-specific pairs of keys and values will be stored in string files (which have a &quot;.strings&quot; extension) in your application's language-specific &quot;.lproj&quot; directories.&nbsp; If your application looks in a string file contained in the <b>French.lproj</b> subdirectory, for example, the key &quot;Yes&quot; might have the corresponding value &quot;Oui&quot;; in a string file in your application's <b>German.lproj</b> subdirectory, the corresponding value would be &quot;Ja&quot;.</font>

<p><font face="Times">If you use the functions described in this paper, your application will automatically use the contents of the appropriate &quot;.lproj&quot; directory to build the internal string table from the external string files, thereby saving you the work of writing this code yourself.&nbsp; Other parts of the process-designing your code to use the appropriate functions and then generating the string files for translation-are described in the remaining parts of this section.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">See the class description for NXBundle, which is useful for finding localized resources in a directory.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Functions and Macros for Dealing with Localized Strings</b></font>

<p><font face="Times">You make each embedded string in your application localizable by replacing the string with a lookup in a string table and using the value that's returned.&nbsp; To perform this lookup, you use functions such as <b>NXLocalizedString()</b> and <b>NXLocalizedStringFromTable()</b>.&nbsp; These and related functions are described in detail in <i>NEXTSTEP General Reference</i>, but to give you an idea of how they're used, let's take a look at <b>NXLocalizedString()</b>.</font>

<p><font face="Times"><b>NXLocalizedString()</b> takes three arguments:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">NXLocalizedString(<i>key</i>, <i>value</i>, <i>comment</i>)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Normally you'll specify the embedded string as the <i>key</i> and NULL as the <i>value</i>, and include a comment that provides contextual information for the person who will be translating the string file.&nbsp; At run-time, <b>NXLocalizedString()</b> simply uses the <i>key</i> to retrieve the corresponding value from the string table and returns that value.&nbsp; If a value isn't found in the string table, then the <i>key</i> string is returned.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">The <i>value</i> and <i>comment</i> arguments are used not at run-time, but during application development when you generate the strings file from your source files.</font>

<p><font face="Times">For a concrete example of how you would use the <b>NXLocalizedString()</b> function, look again at the string that was shown earlier:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXRunAlertPanel(NULL, &#34;Your printer is out of paper!&#34;, NULL, NULL, NULL);</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">To get the localized version of this string, use <b>NXLocalizedString()</b>:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXLocalizedString(&#34;Your printer is out of paper!&#34;, NULL, Printer Empty message)</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Rather than look up the localized version of the string each time it's needed, a good strategy is to define a macro that retrieves the localized string just once:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define PRINTER_OUT_OF_PAPER \</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXLocalizedString(&#34;Your printer is out of paper!&#34;, NULL, Printer Empty message)</font>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXRunAlertPanel(NULL, PRINTER_OUT_OF_PAPER, NULL, NULL, NULL);</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">You should use this strategy to localize your application's strings into a single region of <b>#define</b> statements, both to make them easy to locate and also to avoid having to look up a particular string in a string table more than once. Another reason for doing this is to prevent identical entries from being generated in the string file (an entry is generated for each call to <b>NXLocalizedString()</b> or <b>NXLocalizedStringFromTable()</b>, so redundant macro calls must be avoided).</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Dealing with Non-Unique Strings</b></font>

<p><font face="Times">It's possible to use the literal string as the value of the <i>key</i> argument to <b>NXLocalizedString()</b> or <b>NXLocalizedStringFromTable()</b> only if the string is unique (that is, occurring only once in a particular string file).&nbsp; If your source code contains a string that isn't unique, you'll need to provide a unique identifier as the <i>key</i> instead, and specify the string as the <i>value</i>.</font>

<p><font face="Times">For example, a commonly used string which may require localization is the name of a font, such as Helvetica:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">pagefont = [Font newFont:&#34;Helvetica&#34; size:12.0];</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">headerfont = [Font newFont:&#34;Helvetica&#34; size:12.0];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">To deal with the fact that the string &quot;Helvetica&quot; occurs twice, for each of the two statements you would use a unique identifier as the <i>key</i> and &quot;Helvetica&quot; as the <i>value</i>, like this:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define PAGE_FONT \</font><br>
<img src="../Images/sp.gif" width=138 height=1><font face="Courier" size="-1">NXLocalizedString(&#34;PageFont&#34;, &#34;Helvetica&#34;, Font used to draw page)</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define PAGE_FONT_SIZE \</font><br>
<img src="../Images/sp.gif" width=138 height=1><font face="Courier" size="-1">atof(NXLocalizedString(&#34;PageFontSize&#34;, &#34;12.0&#34;, Font used to draw page))</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define HEADER_FONT \</font><br>
<img src="../Images/sp.gif" width=138 height=1><font face="Courier" size="-1">NXLocalizedString(&#34;HeaderFont&#34;, &#34;Helvetica&#34;, Font used to draw header)</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define HEADER_FONT_SIZE \</font><br>
<img src="../Images/sp.gif" width=138 height=1><font face="Courier" size="-1">atof(NXLocalizedString(&#34;HeaderFontSize&#34;, &#34;12.0&#34;, Font used to draw header))</font>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">pagefont = [Font newFont:PAGE_FONT size:PAGE_FONT_SIZE];</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">headerfont = [Font newFont:HEADER_FONT size:HEADER_FONT_SIZE];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">In the present case (where a unique identifier is specified as <i>key</i> and the string is specified as the <i>value</i>), if a value isn't found in the string table then the <i>value</i> string is returned.&nbsp; (Remember that in the previous section--where the string was specified as <i>key</i>, and <i>value</i> was NULL--we said that if a value isn't found, then the <i>key</i> string would be returned.)</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">The point of making a font name localizable is not that you would translate the string &quot;Helvetica&quot; into another language (which isn't really possible), but that you would substitute some other value in order to use a different font that's more appropriate for the target language.&nbsp; For example, Helvetica doesn't look right mixed with available Japanese fonts, so a more appropriate English-language font needs to be used instead of Helvetica if Japanese is the user's preferred language.</font>

<p><font face="Times">Note also that this example externalizes a &quot;literal number&quot;--in this case, 12.0 (again, you wouldn't translate the number 12.0 into other languages, but you might choose to substitute a different font size if it's better for a particular language).&nbsp; If a lot of literal numbers appear in your program, you may want to write your own <b>LocalNumber() </b>function to handle them.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Generating String Files</b></font>

<p><font face="Times">Once your source code and the strings it contains are fairly stable, you'll generate the string file (or files) that will later be translated into the languages that you wish to support in your application.</font>

<p><font face="Times">A program called <b>genstrings</b> (in <b>/usr/bin</b>) is available to help you generate the string files automatically.&nbsp; <b>genstrings </b>works by parsing the source files that you specify, extracting the information from each call to <b>NXLocalizedString() </b>and <b>NXLocalizedStringFromTable()</b>, and adding that information to the appropriate string files.&nbsp; Every entry generated from a call to <b>NXLocalizedString()</b> is placed in a file called <b>Localizable.strings</b> and every entry generated from a call to <b>NXLocalizedStringFromTable()</b> is placed in a file called <i>table</i><b>.strings</b> (where <i>table</i> is the value of the <i>table</i> argument to <b>NXLocalizedStringFromTable()</b>).</font>

<p><font face="Times">It's important to understand that <b>genstrings</b> outputs one entry for each call to <b>NXLocalizedString()</b> or <b>NXLocalizedStringFromTable()</b>, and duplicates any identical entries.&nbsp; Therefore, avoid calling either of these functions more than once with the same arguments.&nbsp; In particular, each key must be unique (that is, not occur more than once in a string file).</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Editing String Files</b></font>

<p><font face="Times">The format of a string file is fairly simple.&nbsp; Each entry in the file should look like this:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* Comment */</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">&#34;key&#34; = &#34;value&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">For each entry, <b>genstrings</b> automatically generates the relevant fields and gives them the values that you specified for the <i>key</i>, <i>value</i>, and <i>comment</i> arguments in the call to the <b>NXLocalizedString()</b> or <b>NXLocalizedStringFromTable() </b>function.&nbsp; The format of the entries generated by <b>genstrings</b> is affected by the values that you supplied as <i>key</i> and <i>value</i>; specifically:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">If the <i>key</i> argument is a string and the <i>value</i> argument is NULL, the entry initially lacks a <i>value</i> field:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">/* The message the user receives if the given file isn't found. */</font><br>
<img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">&#34;File %s not found.&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">If the <i>key</i> argument is a unique identifier and the <i>value</i> argument is a string, the entry is generated with a <i>value</i> field that contains the string:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">/* The message the user receives if the given file isn't found. */</font><br>
<img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">&#34;FileNotFoundMessage&#34; = &#34;File %s not found.&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">During the subsequent translation phase, for both these sample entries you would need to provide a <i>value</i> field that contains an equivalent version of the English string &quot;File %s not found.&quot;&nbsp;&nbsp; The first entry--localized for French--would look like this:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* The message the user receives if the given file is not found. */</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">&#34;File %s not found.&#34; = &#34;Fichier %s n'existe pas.&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">and the second entry would look like this:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* The message the user receives if the given file is not found. */</font><br>
<img src="../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">&#34;FileNotFoundMessage&#34; = &#34;Fichier %s n'existe pas.&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Note the following important points about string files:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">You must be careful not to make changes to any of the <i>key</i> fields in the string file.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">As shown here, the strings can contain standard <b>printf()</b> format specifications.&nbsp; However, if more than one format specification occurs in a string, they may need to be reordered programmatically to accommodate particular languages.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Remember that a string like &quot;Helvetica&quot;--rather than requiring translation--might need to be replaced by the name of some other more appropriate font.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The strings in your application can be grouped into as many string files as you want.&nbsp; Generally, these files should be organized on the basis of related functionality or likelihood of occurrence.&nbsp; The <i>only</i> reason to break strings up into multiple string files is to reduce the number of entries that need to get parsed, so if your application doesn't contain a large number of strings you should probably use a single string file.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Translating the External Language-Specific Files</b></font>

<p><font face="Times">As your application development nears completion, you'll put all the externalized nib, image, sound, and string files into a <i>source_language</i><b>.lproj</b> subdirectory inside your project directory.&nbsp; You can then give that <i>source_language</i><b>.lproj </b>directory and its contents to a translator, who should be able to give you back a corresponding <b>French.lproj</b>, <b>German.lproj</b>, or <b>Spanish.lproj</b> (or <i>other_language</i><b>.lproj</b>) directory.&nbsp; You'll place each of these &quot;.lproj&quot; directories back in the project directory, and make sure that they get installed in the application file package.</font></td></tr>

</table>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=5></td>

<td><font face="Helvetica" size="+2"><b>Procedures for Localizing an Application</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This section describes the procedures you'll use to make your application localizable.&nbsp; The general sequence of steps is:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">1.</font></td>

<td><font face="Times">Configure your application for localization--that is, identify to ProjectBuilder the files containing localizable information.&nbsp; These might include nib files, TIFF and EPS files, and auxiliary files containing text or sound that needs to be made localizable.</font></td></tr>

<tr valign=top>

<td width=105 height=17></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">2.</font></td>

<td><font face="Times">Make embedded strings localizable.</font></td></tr>

<tr valign=top>

<td width=105 height=17></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">3.</font></td>

<td><font face="Times">Where appropriate, provide for localizd versions of date, time, and currency formats.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Once these steps have been performed, you are ready to perform the final step, which is to make one or more localized versions of your application:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">4.</font></td>

<td><font face="Times">Localize (that is, translate) your application for each particular target language.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The rest of this section describes these topics in more detail.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Making Nib Files Localizable</b></font>

<p><font face="Times">Many language-specific strings are contained in the nib files generated by Interface Builder (for example, menu commands, button titles, and text in panels).&nbsp; To localize the strings in nib files, you must create and install a language-specific version of each nib file for every target language supported by your application.&nbsp; As a first step, select each of your project's nib files in ProjectBuilder and choose the Make Localizable command in the Files menu. This command puts the selected file into the project's <i>source_language</i><b>.lproj</b> subdirectory so that it is available for translation.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Making TIFF and EPS Files Localizable</b></font>

<p><font face="Times">Your application's TIFF and EPS files might contain language-specific text within icons, or even icons which are culture-specific.&nbsp; In this case, they should be made localizable as well.&nbsp; The procedure is similar to that described in the previous section:&nbsp; select each TIFF or EPS file in ProjectBuilder and choose the Make Localizable command in the Files menu.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Making Auxiliary Files Localizable</b></font>

<p><font face="Times">If you have sound files, help files, sample documents, or other files that require localization support, you should write a simple function that finds and loads the file from the appropriate &quot;.lproj&quot; directory.&nbsp; The procedure is similar to that described above:&nbsp; select each file in ProjectBuilder and choose the Make Localizable command in the Files menu.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Preparing Embedded Strings</b></font>

<p><font face="Times">Strings embedded in your application's source code must be externalized, so that equivalent strings in another language may be substituted based upon the user's language preferences.&nbsp; (If you're designing an application from scratch, we recommend that you use the functions discussed in this section from the very beginning, so that you won't need to make any changes to your code later.)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">1.</font></td>

<td><font face="Times">Check your application code for occurrences of embedded strings, and replace each one with a call to <b>NXLocalizedString()</b> or <b>NXLocalizedStringFromTable()</b>.&nbsp; For example, you would replace a statement of the form:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">string = &#34;value&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">with one of the following functions:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">string = NXLocalizedString(&#34;key&#34;, &#34;value&#34;, &#34;comment&#34;);</font><br>
<img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">string = NXLocalizedStringFromTable(&#34;table_name&#34;,&#34;key&#34;,&#34;value&#34;,&#34;comment&#34;);</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">Before using the <b>NXLocalizedString()</b> and <b>NXLocalizedStringFromTable()</b> functions, be sure that you've read and understood the information in the sections &quot;String Tables&quot; and &quot;Function Descriptions&quot;.&quot;&nbsp; It's important that you understand what these two functions do and how they differ from each other.&nbsp; In particular, remember that each <b>NXLocalizedString()</b> and <b>NXLocalizedStringFromTable()</b> statement must occupy no more than one line (due to limitations in the <b>genstrings</b> program), and that each key needs to be unique within the context of its string table.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">2.</font></td>

<td><font face="Times">Once you are sure that the embedded strings in your source code use the <b>NXLocalizedString()</b> and <b>NXLocalizedStringFromTable()</b> functions, run <b>genstrings</b> on your source code in order to generate the primary &quot;app_name.strings&quot; file and any additional string files:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">&gt; cd app_dir/source_language.lproj</font><br>
<img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">&gt; genstrings ../*.[hcm] &gt; app_name.strings</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">The <b>genstrings</b> program outputs to <b>stdout</b> one line for each call made to <b>NXLocalizedString()</b> (which is why you need to redirect <b>stdout</b> to a string file with the same name as the application), and creates in the current directory a file for each table named in a <b>NXLocalizedStringFromTable()</b> call (which is why you need to <b>cd</b> to <i>source_language</i><b>.lproj</b> before issuing this command).&nbsp; If <b>genstrings</b> encounters any problems, it reports them on <b>stderr</b>.</font>

<p><font face="Times">Remember to delete your old string files before running <b>genstrings</b> a second time.&nbsp; If a string file already exists, <b>genstrings</b> will append additional strings to it, so your old strings could still stay around.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Displaying Date, Time, and Currency Formats</b></font>

<p><font face="Times">Most applications don't display date, time, or currency information, and therefore won't require any changes to support localization of such formats.&nbsp; Of the applications in which providing such information is critical, most will provide application-specific ways for the user to choose among various alternative formats, independent of the user's choice of system language.</font>

<p><font face="Times">If you are one of the small number of developers who need a simple way to provide basic support for localized date or time formats, you can use the standard ANSI C functions <b>strftime()</b> and <b>localtime()</b>, which get format information from settings in the user's defaults database.&nbsp; For more information about these functions (and related functions such as <b>localeconv()</b>) and how they interact with the NEXTSTEP defaults mechanism, see the file <b>CLibLocalization.rtf</b> in <b>/NextLibrary/Documentation/NextDev/Concepts</b>.</font>

<p><font face="Times">One thing to be aware of is that the date, time, and currency formats specified in the user's defaults database <i>don't change</i> when the user changes his or her preferred order of languages in Preferences.&nbsp; These defaults <i>do</i> change, however, when the user installs a NeXT-supplied language-specific version of NeXT software and specifies that language as the primary language (rather than simply as an alternate language).&nbsp; Currently this can only be done for French, German Japanese, Spanish, and Swedish, using the official packages.</font>

<p><font face="Times">Since the variables for date, time, and currency formats in the user's defaults database are global variables, your application shouldn't change their values.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Localizing Your Application for a Particular Target Language</b></font>

<p><font face="Times">The following steps can be performed when your application development is complete and the contents of the <i>source_language</i><b>.lproj</b> directory are ready for translation.&nbsp; Perform this sequence of steps (or have them performed by a capable translator) for each target language that you want to make available in your application.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">1.</font></td>

<td><font face="Times">Using ProjectBuilder, create a <i>target_language</i><b>.lproj</b> subdirectory in the same directory as the <i>source_language</i><b>.lproj</b> subdirectory, and copy all the language-specific files from the <i>source_language</i><b>.lproj </b>subdirectory into the <i>target_language</i><b>.lproj</b> subdirectory.</font></td></tr>

<tr valign=top>

<td width=105 height=20></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">2.</font></td>

<td><font face="Times">Open and edit each string file contained in the <i>target_language</i><b>.lproj</b> subdirectory.&nbsp; For each line containing a standalone <i>key</i> string, translate the <i>key</i> string into the target language.&nbsp; For example:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">/* The message the user receives if the given file isn't found. */</font><br>
<img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">&#34;File %s not found.&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">might be edited as follows for a French version:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">/* The message the user receives if the given file isn't found. */</font><br>
<img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">&#34;File %s not found.&#34; = &#34;Fichier %s n'existe pas.&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">If a line in the string file contains a <i>key</i> <b>=</b> <i>value</i> pair rather than just a key:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">/* The message the user receives if the given file isn't found. */</font><br>
<img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">&#34;FileNotFoundString&#34; = &#34;File %s not found.&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">then leave the <i>key</i> string untouched and translate the <i>value</i> string into the target language:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">/* The message the user receives if the given file isn't found. */</font><br>
<img src="../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">&#34;FileNotFoundString&#34; = &#34;Fichier %s n'existe pas.&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">When you're done with each file, remember to save it to the <i>target_language</i><b>.lproj</b> subdirectory.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Remember that strings such as &quot;Helvetica&quot; and &quot;12.0&quot; aren't meant to be translated; however, they may need be replaced with values that are more appropriate for the target language.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">Format strings (%s, %d, etc.) may need to have their arguments reordered programmatically to accommodate particular languages.&nbsp; If you discover such cases during the translation phase, you may need to go back and modify the source code in order to handle them.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">3.</font></td>

<td><font face="Times">Using Interface Builder, open each nib file in the <i>target_language</i><b>.lproj</b> subdirectory.&nbsp; Edit all text strings (in menus, panels, windows, etc.), translating the text into the target language.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">Translating text strings in nib files may require some resizing of panels, windows, and controls as well.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">4.</font></td>

<td><font face="Times">Check the contents of each TIFF and EPS file in the <i>target_language</i><b>.lproj</b> subdirectory.&nbsp; Where appropriate, edit text and images to be consistent with not just the target language, but also the target culture (for example, the image of a mailbox or trash can--even if no text is visible--may need to be changed in order to be recognizable).</font></td></tr>

<tr valign=top>

<td width=105 height=20></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">5.</font></td>

<td><font face="Times">If the <i>target_language</i><b>.lproj</b> subdirectory contains any additional sound files, help files, sample documents, or other text files that require localization support, these files also need to be translated and saved.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Once these steps have been completed, use ProjectBuilder to copy the <i>target_language</i><b>.lproj</b> subdirectory into the project.&nbsp; Then try running <b>make install</b> on your project.&nbsp; Check to make sure that no errors are generated during the compilation or installation process.&nbsp; Try running the installed application in the target language to ensure that everything is working properly.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Summary</b></font>

<p><font face="Times">The procedures described above are intended to cover the commonly encountered situations that might require localization support in an application.&nbsp; In addition to checking for and accommodating these common cases, you should review your application by looking for any other special situations that this document hasn't addressed.&nbsp; In general, if there is any text that might appear on the user's screen, that text should be externalized and placed in the <i>source_language</i><b>.lproj</b> directory so that it can be translated into your application's target languages.&nbsp; If you encounter any other areas that you find require localization support, please let us know so that we can provide that information in a future release of this document.</font></td></tr>

</table>



<p><br><br>

</body>
</html>
