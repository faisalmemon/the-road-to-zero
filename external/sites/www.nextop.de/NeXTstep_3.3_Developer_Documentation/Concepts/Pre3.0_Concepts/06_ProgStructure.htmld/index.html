<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/Concepts/Pre3.0_Concepts/06_ProgStructure.rtfd -->
<!-- Date: Sun Jun 28 19:37:29 1998 -->
<head>
<title>06_ProgStructure</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Release 3.3 Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p><br><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Helvetica" size="+3"><b>6</b></font></td>

<td><font face="Times" size="+3"><i>Program Structure</i></font></td></tr>

</table>

<p><br><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times"><b>Changes made for the current release of NeXTstep affect the information presented in this chapter.&nbsp; For details see:</b></font>

<p><img src="../../Images/sp.gif" width=19 height=1><font face="Times"><b>/NextLibrary/Documentation/NextDev/ReleaseNotes/AppKit.rtf</b></font><br>
<img src="../../Images/sp.gif" width=19 height=1><font face="Times"><b>/NextLibrary/Documentation/NextDev/ReleaseNotes/AllocInitAndNew.rtf</b></font><br>
<img src="../../Images/sp.gif" width=19 height=1><font face="Times"><b>/NextLibrary/Documentation/NextDev/ReleaseNotes/Performance.rtf</b></font>

<p><br><br><br>

<p><font face="Times">The simplest way to program an application for the NeXT computer is to take advantage of the facilities built into the three software kits--the Application Kit, Sound Kit, and Music Kit.&nbsp; The Application Kit provides a basic program structure for applications that draw on the screen and respond to events--for almost all NeXT applications, even those that mainly use the other kits.&nbsp; It implements the NeXT user interface and relieves you of many of the more tedious programming tasks common to most applications.&nbsp; When you use the Application Kit, you need to write only the code that makes your program distinct from a generic application.</font>

<p><font face="Times">Through the Application Kit, your program can:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Open and maintain a connection to the Window Server.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Place windows on the screen.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Draw within the windows.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Process keyboard and mouse events.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Create buttons, menus, and the other graphical objects defined in the user interface.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Display editable text.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Print documents and on-screen displays.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Write data to and retrieve data from the pasteboard.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Manage off-screen bitmaps, including bitmaps for the cursor.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Communicate with cooperating applications.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This chapter introduces the Application Kit and the program structure it defines.&nbsp; Chapter 7, &quot;Program Dynamics,&quot; follows with a more detailed discussion of drawing and event handling within this structure.&nbsp; The Sound Kit and Music Kit are discussed in <i>Sound, Music, and Signal Processing</i>.</font>

<p><font face="Times">The three software kits provide an integrated object-oriented programming environment.&nbsp; They're coded in Objective-C, an object-oriented extension of the C language; programs that make use of the kits must also be written in Objective-C.&nbsp; However, through Interface Builder, you can develop much of your program graphically, on-screen, without writing any Objective-C code.&nbsp; Interface Builder constructs and initializes the user-interface objects for your application and sets up their connections to the rest of the program.</font>

<p><font face="Times">Chapter 8, &quot;Interface Builder,&quot; assumes the program structure that's defined in the Application Kit and described in this and the following chapters.&nbsp; Chapter 9, &quot;User-Interface Objects,&quot; has a more detailed discussion of Kit-defined objects that draw and respond to events; these are objects that you can program using Interface Builder.&nbsp; Chapter 10, &quot;Support Objects and Functions,&quot; then presents the objects, functions, and macros that support the main functionality of your program.</font>

<p><font face="Times">If you're unfamiliar with object-oriented programming and the terminology and syntax of Objective-C, consult Chapter 3, &quot;Object-Oriented Programming and Objective-C.&quot;</font></td></tr>

</table>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=5></td>

<td><font face="Helvetica" size="+2"><b>Writing a Program with the Application Kit</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Every application consists of a network of objects--many defined in the Application Kit, some defined in the application you write.&nbsp; The structure of the network and the kinds of messages that get passed from object to object are the subjects of this and the following chapter.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Class Definitions</b></font>

<p><font face="Times">The Application Kit consists mainly of class definitions.&nbsp; It defines a separate class for each of the canonical control objects in the NeXT user interface.&nbsp; It also defines classes for panels and menus, for objects that permit users to enter and edit text, for an object that can manage the pasteboard for your application, for bitmaps and cursors, and for an object that oversees the entire application.&nbsp; All these classes, and others, are described in detail in this and the following chapters.</font>

<p><font face="Times">Like all Objective-C classes, the classes defined in the Application Kit are linked, through their superclasses, to an <i>inheritance hierarchy</i> that has the Object class at its root.&nbsp; Figure 6-1 shows the classes in the Application Kit inheritance hierarchy.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F1.gif" width=461 height=615></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-1</b></font><font face="Times">.&nbsp; Application Kit Inheritance Hierarchy</font>

<p><br><br>

<p><font face="Times">This diagram shows, for example, that the Panel class has the Window class as its superclass, that the Window class has the Responder class as its superclass, and that the superclass of Responder is Object.</font>

<p><font face="Times">Each class inherits both instance variables (data structures) and methods (procedures) from all the classes above it in the hierarchy.&nbsp; The Panel class inherits from Window, Responder, and Object.&nbsp; This means that an instance of the Panel class can use not only Panel methods, but also methods defined in the Window, Responder, and Object classes.&nbsp; It also means that every Panel object has all the instance variables declared in the three classes it inherits from, in addition to any that might be declared in the Panel class itself.</font>

<p><font face="Times">Since the methods and instance variables that are defined in a class are inherited by its subclasses, a subclass can be viewed as a variant of the classes above it in the hierarchy.&nbsp; Inheritance makes Panel a kind of Window, and Window a kind of Responder.&nbsp; When we speak of a &quot;Window object,&quot; we mean not only objects belonging directly to the Window class, but also any object that belongs to any class that inherits from Window.&nbsp; Panels, OpenPanels, FontPanels, Menus, and PopUpLists are all Windows.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Using Kit-Defined Classes</b></font>

<p><font face="Times">You can make use of Application Kit classes in four ways:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">You can create objects (instances) belonging to the classes defined in the Kit.&nbsp; Your application can include Button, Slider, and Menu instances, for example.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">You can define new subclasses of Application Kit classes, then create instances of the subclasses for your application.&nbsp; Through its superclass, each class you define will inherit methods and instance variables from the Kit. The instance variables and methods you add in the subclass definition serve to adapt generic Kit capabilities to the specific needs of your application.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">You can add new methods to a Kit class by putting them in a category definition that extends the original definition of the class.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">You can define your own objects to act on behalf of objects that inherit from the Application Kit.&nbsp; Kit objects handle most of the work themselves, but can delegate responsibility for some of the messages they receive to other objects.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Instances</b></font>

<p><font face="Times">In many cases, creating an instance of an Application Kit class is all that's needed.&nbsp; Class definitions in the Kit give you a good deal of freedom to adjust an instance to the needs of your application.&nbsp; A Button, for example, can be shaped, titled, associated with a keystroke, and assigned an action of your choosing, simply by initializing its instance variables.&nbsp; (For a Button, you'd usually do this through Interface Builder.)</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Subclasses</b></font>

<p><font face="Times">Since your application will do some things no other application will do, it will probably need to define some objects of its own.&nbsp; In most cases, these objects will be adaptations of objects defined in the Application Kit.&nbsp; For example, the Panel class defines a kind of window that behaves as a panel should according to the user-interface guidelines.&nbsp; If you need a panel with a particular display and a special relationship to the other windows in your application, you can define it as a subclass of Panel.</font>

<p><font face="Times">The main reason for defining subclasses of Kit classes is to design objects that draw and respond to events in ways that are specific to your application.&nbsp; Generally, you'd define subclasses of View.</font>

<p><font face="Times">A View is an object that has an area and a coordinate system for drawing within a window.&nbsp; It can be selected to receive keyboard and mouse events, and can be scrolled and automatically displayed.&nbsp; If you need an object with these features, you'd simply define a subclass of View and implement methods that draw and respond to events as you'd like. You wouldn't have to re-implement the methods that manage the object's coordinate system, display it on the screen, permit it to be scrolled, or select it to receive mouse and keyboard events.&nbsp; The subclass inherits all the methods and instance variables of the View class; you need to implement only the features you want to add or change.</font>

<p><font face="Times">You might also choose to define subclasses of specific kinds of Views.&nbsp; For example, the Button class defines one- and two-state buttons.&nbsp; If you want a button that can display three or more states, you can subclass Button to add the functionality that you need.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Categories</b></font>

<p><font face="Times">In simple cases, where the only modification you need to make to a Kit-defined class is the addition of some methods, you can add them in a category definition rather than in a new subclass.&nbsp; Categories extend the definition of an existing class to encompass new methods.&nbsp; They're discussed under &quot;Adding to a Class&quot; in Chapter 3.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Delegates</b></font>

<p><font face="Times">Some Application Kit objects permit other objects to intervene and control some of their actions.&nbsp; Because the Kit object delegates responsibility for its behavior to the controlling object, the controlling object is known as a <i>delegate</i>. A delegate does only as much as you program it to do (in its class definition).&nbsp; One delegate can serve a number of different client objects.</font>

<p><font face="Times">By centralizing application-specific code in the delegate, you can adapt the behavior of Application Kit objects without defining Kit subclasses.&nbsp; The delegate can be a subclass of an Application Kit class, but usually it's just a subclass of the generic Object class.</font>

<p><font face="Times">The section on &quot;&lt;The Extended Framework&gt;,&quot; later in this chapter, has more information on delegates and the messages they can receive.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Structuring an Application</b></font>

<p><font face="Times">When it's launched, an application creates a set of objects for itself, displays itself on the screen and waits for events from the Window Server.&nbsp; Whenever it receives an event, it initiates a message to the responsible object, then waits for the next event.&nbsp; The object that receives the message will initiate some messages of its own, so several objects are likely to be involved in the application's response to the event.</font>

<p><font face="Times">The response to an event always includes a visible reaction on-screen, if only to let the user know the event was received.&nbsp; Applications draw both to present the user with a display that can prompt for events and to show the results of those events.&nbsp; The user, the application, and the Window Server participate in a continuous cycle of action and response that's illustrated in Figure 6-2 below.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F2.gif" width=377 height=203></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-2</b></font><font face="Times">.&nbsp; The Event Cycle</font>

<p><br><br>

<p><font face="Times">This cycle is driven by the user's actions.&nbsp; From the point of view of an application, it's driven by events.&nbsp; Between events, applications can respond to three other kinds of input:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times"><i>Remote messages</i>, messages received from other applications.&nbsp; For example, an application might receive a message asking it to supply some data in text form to a word processor, or it might get a message from the Workspace Manager requesting it to open another file.&nbsp; Remote messages are handled just like messages initiated within the application itself.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times"><i>Timed entries</i>, procedures that are to be called periodically and have been registered with the <b>DPSAddTimedEntry()</b> function.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Data received at a monitored port or file.&nbsp; For example, an application might monitor changes to a central database (perhaps of messages written to the console).&nbsp; The monitoring procedure is registered using the <b>DPSAddPort()</b> or <b>DPSAddFD()</b> function.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Most everything that an application does is, directly or indirectly, a response to an event, to a remote message (which is itself prompted by an event in another application), to a timed entry (which is usually registered because of an event), or to data received at a monitored port or file (which changes due to user activity elsewhere).</font>

<p><font face="Times">To respond to events and remote messages, every application needs:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">An Application object, to get events from the Window Server</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Window objects, to provide areas on-screen where the application can draw</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">View objects, to draw within the Windows and to handle keyboard and mouse events associated with windows</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">A Listener, to receive remote messages, and a Speaker, to send them</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The Application Kit creates a default Listener and Speaker for every application.&nbsp; You must create the Application object, Windows, and Views for yourself.</font>

<p><font face="Times">The Application object also oversees the application's Windows, and is usually expected to respond to the remote messages received by the Listener.&nbsp; Windows oversee their Views.&nbsp; All the objects are designed to work together in a coherent program structure.</font>

<p><font face="Times">This brief outline of how an application works is explained and expanded throughout the rest of this chapter.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Responding to Kit-Generated Messages</b></font>

<p><font face="Times">As it receives events from the Window Server and reacts to the instructions in your program, the Application Kit initiates a variety of messages.&nbsp; Very often, the message is designed to give the objects in your program the opportunity to do their own work in their own way.&nbsp; To take advantage of this opportunity, you need only implement the appropriate method in a class definition.</font>

<p><font face="Times">The chart below lists some of the methods that you might consider implementing.&nbsp; All these methods, and their place in the Application Kit's program structure, are discussed in detail later in this and the next chapter, and in Chapter 9.&nbsp; The chart is an introduction and for quick reference only.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>If You Want to:</b></font></td>

<td><font face="Helvetica"><b>Write Your Own Version of:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Respond to events and subevents</font></td>

<td><font face="Times">keyDown:</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">keyUp:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">flagsChanged:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">mouseDown:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">mouseUp:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">mouseDragged:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">mouseEntered:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">mouseExited:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">mouseMoved:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">windowMoved:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">windowExposed:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">windowResized:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">applicationDefined:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">powerOff:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Determine which events to receive</font></td>

<td><font face="Times">acceptsFirstResponder</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">acceptsFirstMouse</font></td>

<td></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Reflect change of event-handling status</font></td>

<td><font face="Times">becomeActiveApp</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">resignActiveApp</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">becomeKeyWindow</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">resignKeyWindow</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">becomeMainWindow</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">resignMainWindow</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">becomeFirstResponder</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">resignFirstResponder</font></td>

<td></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Respond to a keyboard alternative</font></td>

<td><font face="Times">performKeyEquivalent:</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">commandKey:</font></td>

<td></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Draw an object on the screen</font></td>

<td><font face="Times">drawSelf::</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Open a file</font></td>

<td><font face="Times">validateFilename</font><br>
<font face="Times">openFile:ok:</font><br>
<font face="Times">appAcceptsAnotherFile</font><br>
<font face="Times">appOpenFile:type:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Archive and unarchive an object</font></td>

<td><font face="Times">read:</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">write:</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">finishUnarchiving</font></td>

<td></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><img src="../../Images/sp.gif" width=183 height=1><font face="Times">awake</font></td>

<td></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Change the cursor</font></td>

<td><font face="Times">resetCursorRects</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">React when the user logs out</font></td>

<td><font face="Times">powerOffIn:andSave:</font><br>
<font face="Times">appPowerOff:</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Control text displays</font></td>

<td><font face="Times">textWillChange:</font><br>
<font face="Times">textDidChange:</font><br>
<font face="Times">textWillEnd:</font><br>
<font face="Times">textDidEnd:endChar:</font><br>
<font face="Times">textWillResize:</font><br>
<font face="Times">textDidResize:oldBounds:invalid:</font><br>
<font face="Times">textWillSetSel:toFont:</font><br>
<font face="Times">textWillConvert:fromFont:toFont:</font><br>
<font face="Times">textWillStartReadingRichText:</font><br>
<font face="Times">textWillReadRichText:stream:atPosition:</font><br>
<font face="Times">textWillFinishReadingRichText:</font><br>
<font face="Times">textDidlRead:paperSize:</font><br>
<font face="Times">textWillWrite:paperSize:</font><br>
<font face="Times">textWillWriteRichText:stream:forRun:</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">atPosition:emitDefaultRichText:</font><br>
<font face="Times">text:isEmpty:</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Control a window</font></td>

<td><font face="Times">windowWillClose:</font><br>
<font face="Times">windowWillReturnFieldEditor:toObject:</font><br>
<font face="Times">windowWillMiniaturize:toMiniwindow:</font><br>
<font face="Times">windowDidMiniaturize:</font><br>
<font face="Times">windowDidDeminiaturize:</font><br>
<font face="Times">windowWillResize:toSize:</font><br>
<font face="Times">windowDidResize:</font><br>
<font face="Times">windowDidExpose:</font><br>
<font face="Times">windowDidMove:</font><br>
<font face="Times">windowDidBecomeKey:</font><br>
<font face="Times">windowDidResignKey:</font><br>
<font face="Times">windowDidBecomeMain:</font><br>
<font face="Times">windowDidResignMain:</font><br>
<font face="Times">windowDidUpdate:</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Manage the application</font></td>

<td><font face="Times">appDidHide:</font><br>
<font face="Times">appDidUnhide:</font><br>
<font face="Times">appDidInit:</font><br>
<font face="Times">appDidBecomeActive:</font><br>
<font face="Times">appDidResignActive:</font><br>
<font face="Times">appDidUpdate:</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Update a menu item</font></td>

<td><font face="Times">A method with a name of your own choosing</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Respond to user actions on a control</font></td>

<td><font face="Times">A method with a name of your own choosing</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Although you may write your own versions of these methods, you never send a message to have an object perform them.&nbsp; The message is initiated by the Application Kit as part of its procedures for handling an event, or in reaction to another message your program sends.</font>

<p><font face="Times">There's no penalty for failing to write your own versions of these methods.&nbsp; In a few cases (<b>textWillEnd:</b>, for example), the message won't be sent unless the receiving object has a method that can respond.&nbsp; In other cases (<b>mouseDown:</b> and <b>drawSelf::</b>, for example), the Kit defines a default version of the method that the receiving object can inherit and use.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">When defining a class, you're free to override any inherited method.&nbsp; However, most methods do what you need them to do, so there's no reason to override them (just as there's no reason to override functions in the standard C library).&nbsp; The difference between most methods and the methods in the list above is that the listed methods are designed to be overridden; most methods are not.</font></td></tr>

</table>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=5></td>

<td><font face="Helvetica" size="+2"><b>Principal Application Kit Classes</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Application Kit objects are designed to work together.&nbsp; Through them, and through your own subclass adaptations of them, your program assumes a framework for dealing with events, drawing on the screen, and managing user-interface objects.</font>

<p><font face="Times">The inheritance hierarchy of Application Kit classes was presented in Figure 6-1 above.&nbsp; As that illustration shows, most Application Kit classes inherit from the Responder class, and almost all Responders also inherit from Window or View.&nbsp; The basic structure of a complete Application Kit program can be outlined by looking at just these three classes and the other Responder subclass, Application.&nbsp; Although other Kit classes--notably Panel, Menu, Listener, and Speaker--play important roles, the fundamental framework of an application is defined by Responder and its three subclasses.</font>

<p><font face="Times">Two other Kit classes, Control and Cell, make a vital enough contribution to program design to also be considered principal classes.&nbsp; The principal Application Kit classes are highlighted in Figure 6-3 on the next page.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F3.gif" width=440 height=615></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-3</b></font><font face="Times">.&nbsp; Principal Application Kit Classes</font>

<p><br><br>

<p><font face="Times">Responder is an abstract superclass; programs use instances of its subclasses rather than of Responder itself.&nbsp; Objects that inherit from Responder can, as its name implies, respond to events.&nbsp; Those that inherit from View can also draw on the screen.&nbsp; Since the mouse requires a graphical object for the cursor to point to, Views are the principal handlers of mouse events.&nbsp; Since typing must be displayed on-screen, Views also handle keyboard events.&nbsp; Most of the objects in your program will likely be Views of one sort or another.</font>

<p><font face="Times">Control is the abstract superclass for View objects that fit the control-action and target-selection paradigms of the user interface.&nbsp; The main attribute that Control imparts to its subclasses is the ability to translate events into application-specific messages for other objects.&nbsp; Each of the controls described in the user interface--buttons, sliders, text fields, and scrollers--is implemented as a separate Control subclass.</font>

<p><font face="Times">The Cell class defines an object that is very much like a View; it can draw and respond to events.&nbsp; But Cells lack the View superstructure that assigns the object an actual location within a window and permits it to receive events.&nbsp; Cells therefore must serve at the pleasure of Views.&nbsp; A View gets events for its Cells and tells them where and when to draw.&nbsp; Cells are a way of dividing a View into semi-autonomous regions, just as Views divide up the content area of a window.&nbsp; Most Control objects use a Cell to handle their drawing tasks.</font>

<p><font face="Times">Each Window object corresponds to a separate window provided by the Window Server.&nbsp; Every program will have at least one Window object, not only to open an area on the screen for the application to draw in, but also to supervise drawing and event handling among the View objects that are displayed within the window.&nbsp; Each Window typically has a number of Views arranged hierarchically inside it.&nbsp; Window's subclass, Panel, defines an object that can fill the role of a panel in the user interface.&nbsp; Panel's main subclass, Menu, defines objects that serve as menus.</font>

<p><font face="Times">Every program must also include one, and only one, Application object to act as its contact with the Window Server. The Application object supervises the entire program, receiving events from the Server and dispatching them to the appropriate Window objects.&nbsp; It manages the Windows in the application much as each Window object manages its Views.</font>

<p><font face="Times">The following sections amplify on this brief overview of these basic Application Kit classes.&nbsp; Other classes are described later in the chapter and in Chapters 9 and 10 as the Kit is examined in more detail.&nbsp; In addition, the <i>NeXTstep Reference</i> manuals describe every public method and instance variable that's defined in all the classes.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Responder</b></font>

<p><font face="Times">Responder is the abstract superclass that most other Application Kit classes inherit from.&nbsp; Those that don't inherit from Responder principally act as support for those that do.&nbsp; The objects that inherit from Responder respond to events; they receive the messages that are initiated by the user's actions on the keyboard and mouse.</font>

<p><font face="Times">Responders participate in a linked list of event-handling objects called a <i>responder chain</i>.&nbsp; If an object in the chain can't handle a message that's sent to it, the message is passed on to its <i>next responder</i>.&nbsp; If the next responder can't handle it either, the message continues to be passed up the chain from object to object in search of a Responder that can.&nbsp; This allows event handling to be consolidated in an object that collects messages originally intended for other Responders.&nbsp; The chain is unidirectional; messages are passed in one direction only.</font>

<p><font face="Times">The Responder class defines the elements essential to the responder chain, a <b>nextResponder</b> instance variable and the methods for passing messages from one object to another.</font>

<p><font face="Times">Only two types of message are passed along the chain.&nbsp; Both types are generated in direct response to the user's actions.&nbsp; They are:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Messages that announce an event, such as messages to perform a <b>keyDown:</b> or <b>mouseExited:</b> method.&nbsp; This type of message is discussed under &quot;Event Messages&quot; in the &quot;Event Handling&quot; section of the next chapter.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Messages that announce a user action on a Control object, such as a Button or a Slider.&nbsp; These messages are discussed under &quot;Action Messages&quot; in the &quot;Event Handling&quot; section of the next chapter.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Although Responder's contribution to event handling is crucial, it's also quite small.&nbsp; Its subclasses--especially Application, View, Window, and Control--add much more specific event-handling capabilities.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>View</b></font>

<p><font face="Times">The View class provides a structure for drawing on the screen and for handling mouse and keyboard events.&nbsp; All the graphical objects defined in the NeXT user interface inherit from View.&nbsp; Views draw scrollers and buttons, display text, and even draw the borders and title bars of windows.&nbsp; The graphical objects you design must also be Views.</font>

<p><font face="Times">The drawing a View object places on the screen can be thought of as a visual representation of the object itself.&nbsp; In many cases, View subclasses are named for the objects they draw.&nbsp; A Button, for example, draws an image of a button that the cursor can point to and the user can click or press.&nbsp; We speak both of the Button object &quot;drawing&quot; and of it &quot;being drawn&quot; on the screen.&nbsp; In a sense, it draws itself.</font>

<p><font face="Times">Although all View objects are also Responders, you can define a View that draws but doesn't respond to events.&nbsp; Any events it happens to receive will be passed to another object through the responder chain.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>The View Hierarchy</b></font>

<p><font face="Times">Every View object is associated with the particular window where it's displayed.&nbsp; All the Views within a window are linked together in a <i>view hierarchy</i>.&nbsp; Each View has another View as its <i>superview</i> and may be the superview for any number of <i>subviews</i>.</font>

<p><font face="Times">The view hierarchy benefits drawing in two ways:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It permits a View object to be constructed out of other Views.&nbsp; For example, a graphical keypad might be a View with separate subviews for each key.&nbsp; A spreadsheet could use a different View for each data field.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It also permits each View object to have its own coordinate system for drawing.&nbsp; Views are positioned within the coordinates of their superviews, so when a View object is moved or its coordinate system is transformed, all its subviews are moved and transformed with it.&nbsp; Since a View draws within its own coordinate system, its drawing instructions can remain constant no matter where it or its superview moves on the screen.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The view hierarchy is not the same as the inheritance hierarchy.&nbsp; The inheritance hierarchy is an arrangement of classes; the view hierarchy is an arrangement of objects.&nbsp; They don't parallel each other.&nbsp; You could create an instance of the Box class that had another instance of Box as its superview, for example, and several ScrollViews and Controls as subviews.</font>

<p><font face="Times">The inheritance hierarchy is fixed at compile time.&nbsp; The view hierarchy is dynamic; it can be rearranged as the program runs.&nbsp; A View can be moved from window to window and be installed as a subview first of one superview then of another.</font>

<p><font face="Times">Three instance variables locate a View object within its view hierarchy:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">window</font></td>

<td><font face="Times">The Window object where the View will appear</font></td></tr>

<tr valign=top>

<td width=131 height=20></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">superview</font></td>

<td><font face="Times">The object that's immediately above the View in the hierarchy</font></td></tr>

<tr valign=top>

<td width=131 height=20></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">subviews</font></td>

<td><font face="Times">A list of all the objects that are immediately below the View in the hierarchy</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">A View's superview and all the Views above the superview in the view hierarchy are sometimes referred to as the View's <i>ancestors</i>.&nbsp; A View's subviews and all the Views below its subviews are known as its <i>descendants</i>.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>The Frame Rectangle</b></font>

<p><font face="Times">The location and dimensions of a View object are provided by the instance variable frame.&nbsp; frame is an NXRect, a structure that defines the essential features of a rectangle, its coordinates and size:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">typedef float&nbsp; NXCoord;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">typedef struct _NXPoint {</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">NXCoord&nbsp;&nbsp;&nbsp; x, y;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">} NXPoint;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">typedef struct _NXSize {</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">NXCoord&nbsp;&nbsp;&nbsp; width, height;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">} NXSize;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">typedef struct _NXRect {</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">NXPoint&nbsp;&nbsp;&nbsp; origin;</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">NXSize&nbsp;&nbsp;&nbsp;&nbsp; size;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">} NXRect;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This structure was discussed in Chapter 4, &quot;Drawing.&quot;</font>

<p><font face="Times">The <b>width</b> and <b>height</b> variables specify the dimensions of the rectangle within the superview's coordinate system; they cannot be negative.&nbsp; The <b>x</b> and <b>y</b> variables locate one corner of the rectangle, also within the superview's coordinates. The width and height are measured from this corner along the positive x- and y-axes, so the corner is the one with the smallest x and y values in the superview's coordinate system.</font>

<p><font face="Times">If the superview's coordinate system has the positive x-axis extending rightward and the positive y-axis extending upward in the usual manner, the <b>x</b> and <b>y</b> variables specify the lower left corner.&nbsp; If the superview's coordinates have been rotated or flipped, the corner may not be at the lower left visually.</font>

<p><font face="Times">NXCoord, NXPoint, and NXSize are defined in the NeXT header file <b>dpsclient/event.h</b>.&nbsp; The NXRect structure itself is defined in <b>appkit/graphics.h</b>; it's used throughout the Application Kit to specify the size and location of rectangles.</font>

<p><font face="Times">A View object doesn't have to draw a rectangle--it could be a circle, for example, a stick figure, or a line of text--but it draws only inside the area specified by its <b>frame</b> instance variable.&nbsp; This area is the View's <i>frame rectangle</i>.&nbsp; A default clipping path is constructed around the edge of the rectangle before the object is displayed.&nbsp; You can specify a more restricted clipping path for the View, but you can't extend it to include any area falling outside its frame rectangle.</font>

<p><font face="Times">The frame rectangle, therefore, defines the boundaries of the View, the tablet on which it can draw.&nbsp; A View object can be thought of as simply a rectangular opening into the window.&nbsp; <b>frame</b> specifies the location and dimensions of this opening.</font>

<p><font face="Times">Figure 6-4 shows the frame rectangles of three hierarchically arranged Views.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F4.gif" width=376 height=315></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-4</b></font><font face="Times">.&nbsp; Frame Rectangles in the View Hierarchy</font>

<p><br><br>

<p><font face="Times">Each subview in Figure 6-4 has a frame rectangle that lies totally within the frame rectangle of its superview.&nbsp; This generally is the case.&nbsp; A View's frame rectangle can be larger than its superview's or extend outside it, but only drawing that's within the View's frame rectangle and within the frame rectangles of all its ancestor Views will be visible on-screen.</font>

<p><font face="Times">Figure 6-5 shows three Views similar to those illustrated in Figure 6-4.&nbsp; In Figure 6-5, however, the middle View lies partially outside its superview's frame rectangle.&nbsp; Although the lowest View lies entirely inside its superview, it also lies partially outside an ancestor View, so only the colored portion of it will be visible.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F5.gif" width=418 height=315></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-5</b></font><font face="Times">.&nbsp; Displaced Frame Rectangles</font>

<p><br><br>

<p><font face="Times">Sometimes, a View contains more material than there's room within a window to display--a View containing the contents of a long document, for example.&nbsp; Such a View can be made the subview of another, much smaller View so that only part of it is visible.&nbsp; With the aid of scrollers, the user can control the larger View's placement within its superview.&nbsp; As the subview moves, different portions of it are scrolled into view.&nbsp; This is illustrated in Figure 6-6.&nbsp; The top View in this illustration would be an instance of the ScrollView class; the middle View would be a ClipView.&nbsp; The largest View, but the one at the bottom of the hierarchy, could be any type of View that you want the user to be able to scroll.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F6.gif" width=423 height=313></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-6</b></font><font face="Times">.&nbsp; Scrolling a View</font>

<p><br><br>

<p><font face="Times">The frame rectangle is first set by an argument to the class method that creates the View.&nbsp; It can then be modified by methods defined in the View class.&nbsp; These methods are described under &quot;Drawing in the View Hierarchy&quot; in the next chapter.</font>

<p><font face="Times">The entire View--that is, the entire frame rectangle--can be rotated around its origin.&nbsp; Rotation doesn't affect the shape of the View; it remains a rectangle even though it has been turned and the sides of its frame are no longer parallel to its superview's x- and y-axes.</font>

<p><font face="Times">Rotation also doesn't affect the values of the <b>frame</b> instance variable; the size of the rectangle remains the same and the corner specified by <b>frame.origin</b> stays at the same point no matter what the orientation of the rectangle's sides.</font>

<p><font face="Times">Figure 6-7 illustrates the same three Views that were shown in Figure 6-4, above.&nbsp; Here, however, the View in the center of the hierarchy has been rotated.&nbsp; Note that its subview rotates with it.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F7.gif" width=376 height=315></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-7</b></font><font face="Times">.&nbsp; View Frame Rotation</font>

<p><br><br>

<p><font face="Times">Although rotating a frame rectangle is possible, it's not encouraged.&nbsp; It's usually better to rotate the drawing within a View, but to leave the View itself aligned with the screen coordinate system.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Drawing Coordinates</b></font>

<p><font face="Times">Each View has its own coordinate system for drawing.&nbsp; Before a View draws, its coordinate system is made the current coordinate system for the application.</font>

<p><font face="Times">As a default, a View's coordinate system is the same as its superview's, except that:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The point recorded in a View's <b>frame</b> instance variable becomes the origin (0.0, 0.0) of its drawing coordinates.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">If a View is rotated, its coordinate system is rotated with it; the x- and y-axes stay parallel to the sides of the View's frame rectangle.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Figure 6-8 illustrates the relationship between a View's default coordinate system and its superview's coordinates. The <b>zooView</b> object in this figure is located at (350.0, 150.0) in its superview's coordinate system.&nbsp; For the drawing that <b>zooView</b> does, this same point is treated as the coordinate origin (0.0, 0.0).&nbsp; In Figure 6-8, <b>zooView</b> begins the tip of the crocodile's tail at (50.0, 200.0) as measured from this origin.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F8.gif" width=395 height=210></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-8</b></font><font face="Times">.&nbsp; Default Coordinates</font>

<p><br><br>

<p><font face="Times">In Figure 6-8, <b>zooView</b>'s frame was rotated about 36 counterclockwise.&nbsp; The default x- and y-axes rotate with the frame, so the picture that <b>zooView</b> draws is aligned with the sides of the frame rectangle.&nbsp; The rotation doesn't affect the values in <b>zooView</b>'s <b>frame</b> instance variable or change the origin of its drawing coordinates.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">Frame rotation is shown here only to make the example complete.&nbsp; In practice, although you might rotate the coordinate system temporarily as you draw, you'd rarely want to rotate the entire frame rectangle.</font>

<p><font face="Times">A View can also adopt a different coordinate system by modifying the system it gets by default.&nbsp; Modifications are made with methods that parallel the standard PostScript transformations:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The coordinate origin can be translated to a point other than <b>frame.origin</b>.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The size of a unit along either the x- or y-axis can be scaled to a dimension other than the one used by the superview.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The coordinate axes can be rotated around the origin so that they're no longer aligned with the sides of the frame rectangle.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">These modifications alter the reference coordinate system that the View uses for drawing, and may affect the appearance of what's drawn, but they don't change the area where the drawing appears--that is, they don't affect the View's frame rectangle.</font>

<p><font face="Times">Besides the default coordinate system and transformations of it, a View can opt for either of two alternative coordinate systems:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It can keep its superview's coordinate system.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It can flip its coordinate system so that the origin is in the upper left corner and the positive y-axis extends downward.&nbsp; Flipped coordinates are especially useful for Views that draw text in the normal manner for English (starting at the upper left of the page and proceeding to the lower right).</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">&quot;Drawing in the View Hierarchy,&quot; in the next chapter, has more detailed information on these options, the methods that can be used to transform the default coordinate system for drawing, and other aspects of View coordinates and displays.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>The Bounds Rectangle</b></font>

<p><font face="Times">The <b>frame</b> instance variable locates and sizes a View within its superview's coordinate system, but is of little use when the View comes to draw within its own coordinate system.&nbsp; To draw efficiently, a View often needs to know where it's located and how large it is within its own coordinates; that is, it needs to have its frame rectangle translated into its own coordinate system.&nbsp; The <b>bounds</b> instance variable provides this information.</font>

<p><font face="Times">A View's <i>bounds rectangle</i> is guaranteed to be the smallest rectangle that completely encloses the View and is expressed in the View's own drawing coordinates.&nbsp; It will usually specify exactly the same area on-screen as the frame rectangle, though stated in a different coordinate system.&nbsp; If a View uses the default coordinate system, <b>bounds</b> will be identical to <b>frame</b>, except that <b>bounds.origin</b> will be (0.0, 0.0).</font>

<p><font face="Times">Views typically use the bounds rectangle to ensure that they don't uselessly attempt to draw images that will never be rendered on the screen.&nbsp; By checking whether the images they wish to draw lie within their bounds, they can avoid sending the Window Server drawing instructions for images that lie outside the View and will consequently be clipped.</font>

<p><font face="Times">Although programs read the <b>bounds</b> instance variable, they never set it.&nbsp; <b>bounds</b> is automatically updated by methods that change the frame rectangle and by methods that alter the View's coordinate system.&nbsp; These methods are described under &quot;Drawing in the View Hierarchy&quot; in the next chapter.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>The Visible Rectangle</b></font>

<p><font face="Times">The drawing that a View does is clipped not only to its own frame rectangle, but also to every ancestor View above it in the view hierarchy.&nbsp; Therefore, the bounds rectangle by itself is a reliable guide only for Views that aren't scrolled and stay entirely within the frame rectangles of all their ancestors.&nbsp; For Views that fail this test, the View class provides a more reliable indicator of where to draw than <b>bounds</b> alone--the <i>visible rectangle</i>.</font>

<p><font face="Times">The visible rectangle is the smallest rectangle guaranteed to cover the visible portion of a View's frame rectangle, but stated--like the bounds rectangle--in the View's own reference coordinate system.&nbsp; If a View lies completely inside all its ancestors, the visible rectangle will be identical to the bounds rectangle.&nbsp; If not, the visible rectangle will cover only a part of the bounds rectangle.</font>

<p><font face="Times">Visibility is reckoned only in terms of the view hierarchy; a View may be &quot;visible&quot; even if it's in an off-screen window, or in an on-screen window obscured by other windows.</font>

<p><font face="Times">In Figure 6-5, &quot;Displaced Frame Rectangles,&quot; above, the visible rectangles for the two smaller Views are shaded.&nbsp; In Figure 6-6, &quot;Scrolling a View,&quot; the visible rectangle for the <b>documentView</b> is the portion of it that shows through the <b>clippingView</b>.</font>

<p><font face="Times">Views don't cache the visible rectangle; it's calculated when needed from the bounds rectangles of the View and from the frame rectangles of all the Views above it in the view hierarchy.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Displaying a View</b></font>

<p><font face="Times">Like Responder, View acts mainly as an abstract superclass; you'd generally create instances of its subclasses, not of the View class itself.&nbsp; You certainly wouldn't create an instance of View for an object you'd want to see displayed; the View class provides the general mechanism, methods, and instance variables for displaying an object on the screen, but its instances lack methods that can actually do the drawing.</font>

<p><font face="Times">To the general structure provided by View, a subclass must add a <b>drawSelf::</b> method with specific drawing instructions in the PostScript language.&nbsp; When a View object receives a display message like this,</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[aView display];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">it's brought into focus--its coordinate system is made the application's current coordinate system--and it receives a message to perform its <b>drawSelf::</b> method.&nbsp; The display method repeats these steps recursively for each of the View's subviews, so all the Views below <b>aView</b> in the view hierarchy are displayed.&nbsp; Views always draw in their own coordinate systems, and subviews are always displayed after (that is, on top of) their superviews.</font>

<p><font face="Times">Figure 6-9 below shows the order in which Views draw.&nbsp; When View A receives a display message, it draws itself and passes the message on to its subviews, B, E, and F.&nbsp; View B is the first of the three to draw, and its subviews, C and D, draw after it and before E.&nbsp; Each branch of the view hierarchy completes drawing before the next branch begins.&nbsp; In this diagram, Views draw in alphabetical order.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F9.gif" width=308 height=230></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-9</b></font><font face="Times">.&nbsp; A View Hierarchy</font>

<p><br><br>

<p><font face="Times">See &quot;Drawing in the View Hierarchy,&quot; in the next chapter, for more information on the mechanism for displaying Views.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Associating Events with Views</b></font>

<p><font face="Times">Users choose a View on-screen by pointing to it (positioning the cursor over its frame rectangle) and pressing the mouse button.&nbsp; This action results in a mouse-down event that records the window where the cursor is located and the cursor's coordinates.&nbsp; The Application Kit uses this information to find the View and ask it to respond to the event (and to any mouse-dragged and mouse-up events that follow the mouse-down).</font>

<p><font face="Times">Mouse events are associated with Views by working down the view hierarchy, and from the last subview to draw to the first.&nbsp; If, for example, the user presses the mouse button while the cursor is inside View A of the hierarchy shown in Figure 6-9 above, the Application Kit would check to see whether it's also inside one of A's subviews, beginning with subview F.&nbsp; If the cursor isn't inside F, the Kit checks subview E, then B.&nbsp; If it is inside F, the Kit checks F's subview, G.&nbsp; The result is that the last View to draw, the one on top, is the first to get a chance to respond to the mouse-down event.</font>

<p><font face="Times">Keyboard events are associated with a View in the key window that the user selects with a mouse-down event.&nbsp; If the selected View can display user-editable text or graphics, it becomes the Window's <i>first responder</i>.&nbsp; The first responder is given the first opportunity to handle keyboard events and menu commands like Copy, Paste, and Select All that participate in the target-selection paradigm.&nbsp; Every Window can have a first responder, but only the key window's first responder gets keyboard events.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>View Subclasses</b></font>

<p><font face="Times">The objects defined by View subclasses fall into three major groups:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Views that display data and enable the user to change and manipulate it.&nbsp; The Text object is such a View; it displays user-editable text.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Views that capture instructions from the user and pass them on to other objects.&nbsp; The subclasses of Control--Button, Slider, Scroller, TextField, Matrix, and Form--define such objects.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Views that are used in conjunction with other Views, either to enhance or to regulate the display.&nbsp; A Box frames the drawing done by other Views.&nbsp; The frame rectangle of a ClipView defines the area in which a larger subview can be displayed and scrolled; ScrollView adds scrollers to control the display within a ClipView.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Views that belong to the first group are the ultimate consumers of user events; they display the results of the user's actions.</font>

<p><font face="Times">Views that belong to the second group act as intermediaries for actions that ultimately are intended to affect other objects.&nbsp; Because of their importance to program structure, these Views are discussed in a little more detail in the section on the Control class below.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Control</b></font>

<p><font face="Times">Responder and its immediate subclasses (View, Window, and Application) define the principal event-handling structure for an application.&nbsp; But events alone don't give an application much information about the user's intentions. Because events are closely tied to the computer hardware (keyboard and mouse), there can be but a handful of different event types.&nbsp; Applications therefore need to provide software objects that users can manipulate to give more precise instructions to the application.&nbsp; The Control class is an abstract superclass for objects that play this role. Controls are Views that receive mouse and keyboard events and translate them into application-specific messages for other objects.</font>

<p><font face="Times">A Control's job is to interpret the user's mouse and keyboard actions and ask another object to respond to them. Graphically, Controls provide the user with a display that can be manipulated with the mouse and keyboard--a button that can be pressed, a slider with a knob that can be dragged, or a text field where data can be entered.&nbsp; Functionally, they convert the mouse and keyboard events they receive into <i>action messages</i> for other objects.&nbsp; The object that receives an action message from a Control is its <i>target</i>.</font>

<p><font face="Times">Both the action message and the target can be set by the application, so it's possible to adapt instances of a single Control subclass to many uses.&nbsp; One Button might translate the mouse events it receives into a <b>start:</b> message; another Button might translate its mouse events into <b>repeat:</b> or <b>stop:</b> messages.&nbsp; There's a limited set of events, but a virtually unlimited number of control actions.</font>

<p><font face="Times">Since a Menu makes use of a Control object (a Matrix) to contain its list of commands, the message the Menu sends when the user chooses a command is also an action message.&nbsp; Each command has its own action message and can have its own target.</font>

<p><font face="Times">Action messages take a single argument, the <b>id</b> of the Control that sends the message.&nbsp; If a target needs more information to accurately respond to an action message, it can send a message back to the Control requesting the information it needs.&nbsp; For example, if a target receives a <b>changeFilename:</b> message from a TextField, it can send a <b>stringValue</b> message back to the TextField to find the file name the user typed in.</font>

<p><font face="Times">It's your application's responsibility not only to set each Control's target and action message, but also to make sure that the targets can respond.&nbsp; In some cases, objects defined in the Kit can be made the target of a Control.&nbsp; The Text object, for example, can respond to <b>copy:</b>, <b>paste:</b>, and <b>selectAll:</b> messages, among others.&nbsp; In most cases, however, you'll need to define the target object and implement the methods that will respond to the action messages it receives.</font>

<p><font face="Times">In either case, the Controls themselves can be taken directly from the Kit.&nbsp; The Kit defines six off-the-shelf Control objects that you can use without subclassing--Button, Slider, TextField, Scroller, Matrix, and Form.&nbsp; You can, of course, also define your own Control subclasses.</font>

<p><font face="Times">Action messages should be viewed as application-specific extensions of events.&nbsp; The role of action messages in event handling is discussed under &quot;Action Messages&quot; in the next chapter.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Cell</b></font>

<p><font face="Times">A Cell is an object that can draw within a View and handle events that are passed to it from the View.&nbsp; Whereas a View receives display messages and events that are distributed down the view hierarchy, a Cell draws and receives events from a View.</font>

<p><font face="Times">A View can record its internal characteristics--what it looks like, how it should respond to the user's action, and so on--in one or more Cell objects.&nbsp; The View itself keeps track of its external characteristics--its size and where it's located in the view hierarchy, for example--as well as of any properties that need to be coordinated among Cells.</font>

<p><font face="Times">Cells are neither Responders nor Views, so they don't initiate drawing or event handling.&nbsp; They may know how to display and highlight a View, or a portion of a View, but can act only on the View's initiative.&nbsp; They may know how to respond to mouse events, but they must get the initial mouse-down event from a View.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Text and Icons</b></font>

<p><font face="Times">As defined in the Application Kit, instances of the Cell class know how to do two simple drawing tasks:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Draw a short segment of text within a prescribed rectangle, and</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Draw a bitmap image, an icon, at a specified location.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">If a View needs a text label, it can let a Cell draw it.&nbsp; If it needs the application icon displayed within a panel, a Cell is an efficient way to render it.&nbsp; To set a Cell instance to display an icon, you pass it the name of a Bitmap object.&nbsp; To have the Cell display text, you assign it a character string.</font>

<p><font face="Times">For more elaborate drawing tasks, you may need to define View-specific Cell subclasses.&nbsp; Instead of placing drawing code in a View method, <b>drawSelf::</b>, it's isolated in the Cell's <b>drawSelf:inView:</b> and <b>drawInside:inView:</b> methods.&nbsp; In addition to drawing methods, you can endow a Cell subclass with View-specific event-handling methods.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>ActionCells</b></font>

<p><font face="Times">In the Application Kit, most Controls are built around Cells in just this way.&nbsp; A Cell subclass, ActionCell, has instance variables and methods designed specifically for the Control task of translating user events into action messages.&nbsp; For example, the ActionCell class, rather than Control, declares instance variables to record the selector that will be used in an action message and the target object of the message.&nbsp; An ActionCell simply provides that information to its Control when asked; the Control dispatches the action message in response to the events it receives.</font>

<p><font face="Times">There's an ActionCell subclass corresponding to most of the basic Control types, as shown in the chart below:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Control Subclass</b></font></td>

<td><font face="Helvetica"><b>ActionCell Subclass</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">Button</font></td>

<td><font face="Times">ButtonCell</font></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">Form</font></td>

<td><font face="Times">FormCell</font></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">Slider</font></td>

<td><font face="Times">SliderCell</font></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">TextField</font></td>

<td><font face="Times">TextFieldCell</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Some Controls display a single Cell--a Button contains one ButtonCell, a Slider one SliderCell, and a TextField one TextFieldCell.</font>

<p><font face="Times">Other Controls display and manage a group of Cells.&nbsp; A Form can display any number of FormCells.&nbsp; A Matrix can be filled with ButtonCells, SliderCells, TextFieldCells, or any other type of Cell.&nbsp; A Matrix of ButtonCells is, in effect, a coordinated set of buttons, each with its own target and action.&nbsp; A Matrix loaded with MenuCells is used to implement Menus.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Window</b></font>

<p><font face="Times">Each window in an application is managed by its own Window object.&nbsp; Conversely, every Window object corresponds to a separate window maintained by the Window Server.&nbsp; When you create an instance of the Window class (or of any Window subclass), the Window Server produces the window the instance will manage.&nbsp; The window is identified by a window number, the Window by its object <b>id</b>.</font>

<p><font face="Times">To conserve memory and reduce startup time, you can delay creating a window for a Window object until it's placed on-screen; you can also arrange to destroy the window when it's removed from the screen.&nbsp; So it's possible for a Window object to be temporarily without a window.&nbsp; Nevertheless, for the object to fulfill its function, it must at some time be associated with an on-screen or off-screen window.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">Throughout this manual, Window objects are referred to with an uppercase &quot;W&quot;, and windows created by the Window Server are referred to with a lowercase &quot;w&quot;.&nbsp; The distinction should be clear:&nbsp; A window can be on-screen or off-screen, images appear in it, it's affected by PostScript operators like <b>windowdeviceround</b>, and so on.&nbsp; A Window has instance variables, it organizes a group of Views, handles events received from the Window Server, and so on. However, since applications affect a window by sending messages to a Window object, uppercase &quot;Window&quot; often covers both the object and the window it manages.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Frame and Content Rectangles</b></font>

<p><font face="Times">A Window is defined by either of two rectangles, a <i>frame rectangle</i> that surrounds the entire window area, including its border, title bar, and resize bar, or a <i>content rectangle</i> that encloses just the window's content area.&nbsp; Both rectangles are specified in the screen coordinate system.</font>

<p><font face="Times">The content rectangle is typically used when creating a new Window, and sometimes when resizing it.&nbsp; Values from the frame rectangle are used when relocating a Window.</font>

<p><font face="Times">Like a View, a Window keeps track of its frame rectangle with a <b>frame</b> instance variable.&nbsp; But a Window's frame rectangle differs from a View's in some important ways:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Methods can't change the location or size of a Window simply by altering its frame rectangle.&nbsp; To move or resize a window, you must send instructions to the Window Server.&nbsp; Use the methods described under &quot;Managing Windows&quot; later in this chapter.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Users can move and resize windows without the application's intervention.&nbsp; The application is informed of these user actions through messages that they generate.&nbsp; See &quot;Event Messages&quot; in the next chapter for more on these messages.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Windows can't be rotated.&nbsp; The sides of their frame rectangles remain aligned with the x- and y-axes of the screen coordinate system.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Windows don't draw, so they don't need a bounds rectangle or a special coordinate system for drawing.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Managing the View Hierarchy</b></font>

<p><font face="Times">In addition to managing one of the Window Server's windows, a Window object manages a hierarchy of Views.&nbsp; It has an important part to play both in distributing events among the objects in its view hierarchy and in regulating coordinate transformations among the Views.</font>

<p><br><br>

<p><font face="Helvetica"><b>Frame and Content Views</b></font>

<p><font face="Times">Every Window has a view hierarchy with at least two Views:&nbsp; a <i>frame view</i> and a <i>content view</i>.</font>

<p><font face="Times">The frame view fills the frame rectangle and draws the Window's border, title bar, and resize bar.&nbsp; It's at the root of the Window's view hierarchy; its superview is <b>nil</b>.&nbsp; A Window has a frame view even if it has no border or title bar.</font>

<p><font face="Times">The frame view is a private object created by the Window.&nbsp; Applications should refrain from altering it, changing its position in the view hierarchy, or assigning it subviews.&nbsp; Your application won't draw in the border or title bar, and has no need to handle mouse events outside the content area.&nbsp; For all practical purposes, you can consider the frame view to be <i>above</i> the view hierarchy rather than in it.</font>

<p><font face="Times">The content view is the frame view's only public subview.&nbsp; It fills the entire area of the content rectangle (the area enclosed by the border, title bar, and resize bar).&nbsp; Every Window creates a default content view for itself.&nbsp; It's not a private object; you can replace it with your own View.&nbsp; The Window records its content view in an instance variable, <b>contentView</b>.&nbsp; A method of the same name returns the content view's <b>id</b>:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp;&nbsp; curView;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">curView = [myWindow contentView];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Although the content view has a superview, your application should treat it as if it were at the root of the view hierarchy.&nbsp; For an application, it serves as the principal link connecting the view hierarchy to the Window.&nbsp; To put a View in a Window, install it as a subview of the content view (or as a subview of a View that's already been installed). You can also replace the default content view with your own.</font>

<p><br><br>

<p><font face="Helvetica"><b>Coordinate Systems</b></font>

<p><font face="Times">When a Window is created (or awakened after being unarchived), a Display PostScript graphic state object is created for it.&nbsp; Applications identify the graphics state by a user object, a unique integer:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">int&nbsp; myGState;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">myGState = [myWindow gState];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The graphics state object has two important properties for Views that draw within the Window:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It identifies the window as the output &quot;device&quot; where their drawing will be rendered.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It records the window's base coordinate system.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The base coordinate system is the reference point for defining the individual coordinate systems of the Window's Views.&nbsp; The frame view draws the Window's border, title bar, and resize bar directly in the base coordinate system. Unless the other Views are assigned graphic state objects of their own, they draw in coordinate systems that are transformations of the base coordinate system.</font>

<p><font face="Times">The value returned by <b>gState</b> can be used as an argument to functions like <b>PScomposite()</b> and <b>PSdissolve()</b>, but you generally don't need to refer to it.&nbsp; The Application Kit takes care of setting the correct graphics state.</font>

<p><br><br>

<p><font face="Helvetica"><b>Events</b></font>

<p><font face="Times">Every Window object keeps an event mask that determines which events the Window Server can associate with the window it manages.&nbsp; Keyboard and mouse events associated with a window are first sent to the Window object.&nbsp; The Window then distributes them to its Views.</font>

<p><font face="Times">The View that the user selects to receive keyboard events is known as the <i>first responder</i>.&nbsp; Each Window maintains a <b>firstResponder</b> instance variable for the object that should handle the next keyboard event it receives.&nbsp; It constantly updates the instance variable in response to the user's actions with the mouse; whenever it gets a mouse-down event, it finds the subview where the cursor is located, sends it the event, and tries to make it the <b>firstResponder</b> for subsequent events.&nbsp; (See &quot;The First Responder&quot; under &quot;Event Handling&quot; in the next chapter for more information.)</font>

<p><font face="Times">A Window object handles kit-defined subevents--like window-moved and window-exposed--itself; it doesn't distribute them to its Views.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Window Subclasses</b></font>

<p><font face="Times">Window has a single subclass, Panel.&nbsp; But the Panel class has several subclasses.&nbsp; Most, such as PrintPanel, FontPanel, and SavePanel, define specific panels that are common to many applications.&nbsp; One is a generic Menu class for all the menus of an application.</font>

<p><font face="Times">Panels are Windows with a special purpose:&nbsp; They hold Views that control other objects associated with other windows of the application.&nbsp; The Views in a Panel are typically Controls of one sort or another; you can think of a Panel as simply a Window container for a cluster of Controls.&nbsp; A Menu has just one Control, a Matrix of MenuCells.</font>

<p><font face="Times">The Panel class gives objects that inherit from it the behavior expected of panels in the user interface:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">A Panel can't become the main window, though by default it can become the key window.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">In general, the only Panels that are visible on-screen are the ones that belong to the application the user is currently working in.&nbsp; By default, the Application Kit hides Panels whenever an application deactivates, unless the Panel is an attention panel.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">When a Panel is closed, it's removed from the screen list but isn't destroyed.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">A Panel passes Command key-down events to the objects in its view hierarchy so that those with keyboard alternatives can respond.&nbsp; See &quot;Keyboard Alternatives&quot; in the next chapter for details.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">A Menu is a Panel that displays a single list of commands for the user to choose from.&nbsp; It adds three main features to those defined in the Panel class:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">A Menu can never become the key window (though it can still respond to keyboard alternatives).</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Menus are assigned a tier in the screen list that keeps them in front of all other windows (except attention panels and lists).</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Menus participate in a system of submenus.&nbsp; Any Menu can be made a submenu of another Menu simply by assigning it to a command in the other Menu.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Menu has one subclass, PopUpList, whose instances serve as either pop-up or pull-down lists.</font>

<p><font face="Times">The user's actions on the Controls in a Panel or Menu generate messages for other objects.&nbsp; These messages are discussed under &quot;Action Messages&quot; in the &quot;Event Handling&quot; section of the next chapter.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Application</b></font>

<p><font face="Times">Every program must have an Application object to supervise its connection to the Window Server, keep track of its Windows, and get its events.&nbsp; It should be the first object created in your program, before any Windows or Views.&nbsp; As one of its first acts, a new Application object connects the application to the Window Server and initializes its run-time environment.</font>

<p><font face="Times">The Application object you create for your program is assigned to a global variable, NXApp.&nbsp; This makes it well-known to the other objects in the application so they can send it messages and avail themselves of its services.</font>

<p><font face="Times">The Application object has four main tasks:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It receives events from the Window Server and distributes them to other objects.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It manages all the application's Windows.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It serves as the default delegate for the application's Listener.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It keeps global information that's shared by other objects.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The Application object (or its delegate) can also hold application-specific code that defines at least part of what the application is about.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Receiving Events</b></font>

<p><font face="Times">Soon after an application is launched, NXApp begins getting events from the Window Server and dispatching them to other objects for action.&nbsp; It continues to get events and dispatch them until the application terminates.&nbsp; NXApp is the only Kit object with the ability to receive events from the Server, and the only one with an overview of the whole application.</font>

<p><font face="Times">The section on &quot;Event Handling&quot; in the next chapter has a complete discussion of the Application object's role in responding to events.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Window Management</b></font>

<p><font face="Times">The Application object keeps an instance variable, <b>windowList</b>, which holds the <b>id</b>s of all the Windows associated with the application.&nbsp; The window list lets NXApp:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Distribute events to the proper Windows.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Distribute Command key-down events to all on-screen and off-screen Windows (including Menus and Panels) that might have Controls with keyboard alternatives.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Make sure that drawing appears in the right window.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Hide and unhide all the application's windows.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Send messages that update Window displays.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Find most of the objects in the application, through each Window's view hierarchy and the instance variables of the Views.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Window management tasks are shared by Window objects and NXApp.&nbsp; The methods defined in both classes are discussed together in a later section of this chapter, &quot;Managing Windows.&quot;</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Listener's Delegate</b></font>

<p><font face="Times">Each application has a Speaker object to send remote messages to other applications and a Listener to receive them.&nbsp; A certain number of the remote messages an application receives come from the Workspace Manager:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">When the user chooses a file in a directory window, the Workspace Manager may send the responsible application an <b>openFile:ok:</b> messages to have it open the file.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">When the user turns the power off or logs out, the Workspace Manager broadcasts the news by sending a <b>powerOffIn:andSave:</b> message to every running application.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">When the user double-clicks a freestanding or docked icon, the application receives an <b>unhide</b> message.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">When the user unmounts a disk, applications are informed with an <b>unmounting:ok:</b> message.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">When the Listener receives these messages from the Workspace Manager, it passes them on to its delegate, which is by default the Application object.&nbsp; The Application object has methods to respond to each of the messages listed above. However, in some cases--such as opening files--it requires help from methods that you need to implement.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Global Services</b></font>

<p><font face="Times">Because of its central position in a program, the Application object is able to provide other objects with a variety of services.&nbsp; Among other things, NXApp can:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Activate the application.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Get events for other objects.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Terminate the application process.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">A principal service is to maintain global information for the application and return it when asked:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">NXApp can say whether the application is the current active application, and whether it's currently hidden:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">BOOL&nbsp; activeStatus, offScreen;</font>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">activeStatus = [NXApp isActive];</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">offScreen = [NXApp isHidden];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It can supply information about the application's PostScript execution context:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">DPSContext&nbsp; myContext;</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">myContext = [NXApp context];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It can return the port where other applications can send it messages:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">port_t&nbsp; socket;</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">socket = [NXApp replyPort];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">NXApp can identify the Window that holds the freestanding or docked icon that the Workspace Manager created for the application:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">myIconWindow = [NXApp appIcon];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">Your application can draw in this Window, but the Workspace Manager owns it.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It provides the application with a Pasteboard object that it can use to support cut, copy, and paste operations:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">myPasteboard = [NXApp pasteboard];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">NXApp registers and returns the application's main menu:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">[NXApp setMainMenu:theMenu];</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">myMenu = [NXApp mainMenu];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It can also register and return global Listener and Speaker objects for the application:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">[NXApp setAppListener:theListener];</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">[NXApp setAppSpeaker:theSpeaker];</font>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">myListener = [NXApp appListener];</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">mySpeaker = [NXApp appSpeaker];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">The Listener and Speaker enable an application to communicate with the Workspace Manager and other applications.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Other services of the Application object are described in later sections of this chapter and in the specification sheet for the Application class in <i>NeXTstep Reference, Volume 1</i>.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Application-Specific Code</b></font>

<p><font face="Times">Because of its central role in an application, NXApp may seem like a good place to put code that's central to your application.&nbsp; You can do this by defining an Application subclass and adding the instance variables and methods you need.&nbsp; An example is shown below.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">@interface MyApplication : Application</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">id&nbsp; actor;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- setActor:anObject;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- actor;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">@end</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">@implementation MyApplication</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- setActor:anObject</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">actor = anObject;</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">return(self);</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- actor</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">return(actor);</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">@end</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This subclass definition does very little.&nbsp; It simply adds the instance variable <b>actor</b> and provides the methods <b>actor</b> and <b>setActor:</b> so that other objects can read and change its value.&nbsp; In all other respects, an instance of the MyApplication class is identical to an instance of the Application class.</font>

<p><font face="Times">Instead of defining an Application subclass, you can centralize your code in another object and make it the Application object's delegate:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; myObject;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">myObject = [MyClass new];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[NXApp setDelegate:myObject];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The delegate will act on behalf of NXApp.</font>

<p><font face="Times">Either way, there are good reasons for putting application-specific code in the Application object (or its delegate). Some of them are listed below.</font>

<p><br><br>

<p><font face="Helvetica"><b>Overseeing Other Objects</b></font>

<p><font face="Times">The Application object oversees the application's Windows.&nbsp; And, as the last few items listed in the section on &quot;Global Services&quot; above illustrate, it maintains program globals for a number of other objects.</font>

<p><font face="Times">As you add objects to your application and program its algorithms, you may be tempted to expand the services of the Application object to include overseeing your objects as well.&nbsp; This can be as simple as adding an instance variable and the methods to set and return its value, as shown above in the example of the MyApplication class.</font>

<p><br><br>

<p><font face="Helvetica"><b>Action Messages</b></font>

<p><font face="Times">When an action message from a Control is destined for a target selected by the user, the Application Kit first checks whether the selected receiver can actually respond to the message.&nbsp; If it can't, the Kit tries to find an alternative receiver.&nbsp; NXApp is the last object given a chance to respond.&nbsp; It's therefore a good place to put methods that define the application's default responses to action messages.&nbsp; See &quot;Action Messages&quot; in the next chapter for more on how these messages are dispatched.</font>

<p><br><br>

<p><font face="Helvetica"><b>Remote Messages</b></font>

<p><font face="Times">By default, NXApp is the object that's expected to respond to remote messages from other applications.&nbsp; You can set up your application so that other objects receive remote messages, but the Application object has code to deal, at least in part, with common cases, such as user requests to open another file relayed through the Workspace Manager.</font>

<p><br><br>

<p><font face="Helvetica"><b>Application-Defined Events</b></font>

<p><font face="Times">If your application makes use of application-defined events, the method that responds to them should be implemented in the Application object (or its delegate).</font></td></tr>

</table>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=5></td>

<td><font face="Helvetica" size="+2"><b>Program Framework</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">A complete application is formed from a variety of objects working together.&nbsp; Each object has its own part (and sometimes several parts) to play.&nbsp; When the user acts and the application receives an event, the Application object generates a message to another object.&nbsp; That object does its part and most likely generates additional messages to still other objects.&nbsp; Those objects may generate their own messages, and so on until the application is ready for another event.</font>

<p><font face="Times">To work together like this, objects must somehow be linked together; each one must know (or be able to find) the appropriate receivers for the messages it sends.&nbsp; Objects usually store this information in instance variables that are initialized when the program starts up and may be altered as it runs.&nbsp; The instance variables define the roles that objects can play within the application; when initialized, they define the framework of the application.</font>

<p><font face="Times">The Application Kit provides a program structure for the applications that use it.&nbsp; It provides, in fact, for three levels of structure, ranging from a core framework of tightly linked objects, to objects in defined roles that are more loosely connected, to ways of freely connecting objects in any configuration you choose.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>The Core Framework</b></font>

<p><font face="Times">Responder and its subclasses define a number of instance variables that point to other objects.&nbsp; They were mentioned in the previous discussion of the principal Application Kit classes and are listed again below for ease of reference.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Class</b></font></td>

<td><font face="Helvetica"><b>Instance Variables</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">Responder</font></td>

<td><font face="Times">nextResponder</font></td></tr>

<tr valign=top>

<td width=131 height=20></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">View</font></td>

<td><font face="Times">superview</font><br>
<font face="Times">subviews</font><br>
<font face="Times">window</font></td></tr>

<tr valign=top>

<td width=131 height=20></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">Window</font></td>

<td><font face="Times">contentView</font></td></tr>

<tr valign=top>

<td width=131 height=20></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">Application</font></td>

<td><font face="Times">windowList</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">When these instance variables are initialized, objects are linked into a working program structure.&nbsp; The framework they define is a network of Responders; they all link Responders to other Responders.</font>

<p><font face="Times">In some cases, an instance variable is initialized when the object it points to is created; in other cases it's initialized when a View is assigned a place in a Window's view hierarchy.&nbsp; Rarely is an instance variable set explicitly; because the connections between the principal event-handling objects of an application are crucial, the Application Kit tries to set them itself as a by-product of other decisions you make.</font>

<p><font face="Times">Figure 6-10 and Figure 6-11 below diagram the connections that are maintained by the core instance variables.&nbsp; Figure 6-10 shows how the Application object, NXApp, is connected to the Windows of the application and how each Window is connected to its view hierarchy.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F10.gif" width=498 height=242></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-10</b></font><font face="Times">.&nbsp; Connections to Windows</font>

<p><br><br>

<p><font face="Times">Figure 6-11 shows how objects are connected within a Window's view hierarchy.&nbsp; The particular Window in this example, <b>myWindow</b>, has four Views; <b>myContents</b> is the content view and it has two subviews, <b>frontView</b> and <b>backView</b>.&nbsp; <b>backView</b> also has a subview, <b>longView</b>.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F11.gif" width=488 height=309></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-11</b></font><font face="Times">.&nbsp; Connections in the View Hierarchy</font>

<p><br><br>

<p><font face="Times">The sections below discuss each instance variable illustrated in Figure 6-10 and Figure 6-11.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>windowList</b></font>

<p><font face="Times">When a new Window object is created, it's added to NXApp's list of Windows.&nbsp; The list lets NXApp keep track of all the Windows in the application and, through the Windows, all the Views in every view hierarchy.</font>

<p><font face="Times">The <b>windowList</b> instance variable lists Windows in the order the application creates them (not their order on-screen). It's a List object that's returned by the <b>windowList</b> method:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; myWindows;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">myWindows = [NXApp windowList];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Windows (and other objects) keep track of the Application object by its global name, NXApp; they don't need to cache a pointer to it.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>contentView</b></font>

<p><font face="Times">Windows have more than one pointer into their view hierarchies.&nbsp; The most public pointer, and the one that's most important to application programs, is <b>contentView</b>.&nbsp; Every Window creates a default <b>contentView</b> for itself, since it must have one to function correctly.&nbsp; You can install your own with the <b>setContentView:</b> method:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; oldView;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">oldView = [myWindow setContentView:aView];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This method resizes <b>aView</b> so that it fits the Window's content rectangle and makes it a subview of the View that draws the Window's border and title bar.&nbsp; It detaches the former <b>contentView</b> from the Window's view hierarchy and returns it so that you can free it or reuse it somewhere else.</font>

<p><font face="Times">The Window returns its current content view when asked:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; curView;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">curView = [myWindow contentView];</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>superview and subviews</b></font>

<p><font face="Times">The <b>addSubview:</b> method links objects into the view hierarchy:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[wideView addSubview:myView];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This message makes <b>myView</b> a subview of <b>wideView</b>; both <b>wideView</b>'s <b>subviews</b> list and <b>myView</b>'s <b>superview </b>instance variable are adjusted accordingly.&nbsp; If <b>myView</b> was already the subview of another View, <b>addSubview:</b> would first remove it from the <b>subviews</b> list of its former superview before adding it to the end of <b>wideView</b>'s <b>subviews</b> list.</font>

<p><font face="Times">Because Views are displayed in the order that they appear within the <b>subviews</b> list, it's possible for one subview to draw on top of another subview.&nbsp; (Events are associated with subviews in the opposite order, so the View on top will get the event.)</font>

<p><font face="Times">When you assign a View to a superview, you can specify its position in the <b>subviews</b> list by using the <b>addSubview::relativeTo:</b> method instead of <b>addSubview:</b>.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[wideView addSubview:yourView :NX_BELOW relativeTo:myView];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This message puts <b>yourView</b> just ahead of <b>myView</b> in <b>wideView</b>'s list of subviews, where it will draw immediately below (prior to) <b>myView</b>.&nbsp; If <b>yourView</b> and <b>myView</b> overlap, <b>myView</b> will be on top.&nbsp; It's also possible, with the NX_ABOVE constant, to specify drawing positions above another View.</font>

<p><font face="Times">If the final argument to <b>addSubview::relativeTo:</b> is <b>nil</b>, NX_BELOW places the View in the very first position in the list, and NX_ABOVE places it in the very last position.</font>

<p><font face="Times">The <b>replaceSubview:with:</b> method removes a View from the <b>subviews</b> list and puts another View in its place.&nbsp; Here <b>myView</b> replaces <b>yourView</b>:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[wideView replaceSubview:yourView with:myView];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">There's no default assignment of superview; you must explicitly set it with the <b>addSubview:</b>, <b>addSubview::relativeTo:</b>, or <b>replaceSubview:with:</b> method.</font>

<p><font face="Times">The <b>removeFromSuperview</b> method unlinks a View from the view hierarchy; it's deleted from the <b>subviews</b> list of its superview and its own <b>superview</b> instance variable is set to <b>nil</b>, but it isn't freed.&nbsp; Here <b>yourView</b> is removed from the view hierarchy:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[yourView removeFromSuperview];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The <b>superview</b> method returns a View's superview, and <b>subviews</b> returns its list of subviews, an instance of the List class:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; parent;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">parent = [myView superview];</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; children;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">children = [myView subviews];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The <b>isDescendantOf:</b> method returns whether the receiver is on a direct path below another View in the view hierarchy:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">BOOL&nbsp; isHeir;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">isHeir = [myView isDescendantOf:anotherView];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">You can also test the relationship between two Views by finding their closest common ancestor:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; link;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">link = [myView findAncestorSharedWith:yourView];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This method may return the <b>id</b> of either the receiver or the specified View, if one is the ancestor of the other.&nbsp; If the two Views aren't connected to the same Window (the same view hierarchy), it returns <b>nil</b>.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>window</b></font>

<p><font face="Times">When a View object is positioned within a view hierarchy, its <b>window</b> instance variable is automatically initialized to the Window that owns the hierarchy, as are the <b>window</b> instance variables of any descendant Views it may have.</font>

<p><font face="Times">When <b>myView</b> is made a subview of <b>wideView</b> in the example below (repeated from the section above), its <b>window </b>instance variable is updated to match <b>wideView</b>'s.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[wideView addSubview:myView];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The following four methods all have this effect:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=131></td>

<td><font face="Times">setContentView:</font><br>
<font face="Times">addSubview:</font><br>
<font face="Times">addSubview::relativeTo:</font><br>
<font face="Times">replaceSubview:with:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">A <b>removeFromSuperview</b> message makes the affected View's <b>window</b> instance variable <b>nil</b>.&nbsp; The <b>window</b> instance variables of all its descendant Views are similarly made <b>nil</b>.&nbsp; This also holds true for the Views that are removed from the view hierarchy by <b>setContentView:</b> or <b>replaceSubview:with:</b> messages.</font>

<p><font face="Times">Every View can identify its Window:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; oriel;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">oriel = [myView window];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The <b>window</b> instance variable gives a View access to information about the drawing environment that's kept by the window.&nbsp; For example, a View can ask the Window for the window number or send the content view a message:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">int&nbsp; handle;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">handle = [window windowNum];</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[[window contentView] display];</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>nextResponder</b></font>

<p><font face="Times">Every Window, View, and Application object inherits a <b>nextResponder</b> instance variable from the Responder class. When a View is assigned a superview, its <b>nextResponder</b> is initialized with its superview's <b>id</b>.&nbsp; In the <b>addSubview: </b>example above, <b>wideView</b> was made <b>myView</b>'s next responder.</font>

<p><font face="Times">Within a Window, the responder chain mirrors the view hierarchy up to the content view.&nbsp; The <b>setContentView: </b>method makes the Window the new content view's next responder.&nbsp; The Window's next responder is <b>nil</b>.</font>

<p><font face="Times">The methods that remove a View from the view hierarchy set its <b>nextResponder</b> instance variable to <b>nil</b>.</font>

<p><font face="Times">It's best to keep the responder chain parallel to the view hierarchy, as <b>addSubview:</b>, <b>addSubview::relativeTo:</b>, and <b>replaceSubview:with:</b> do.&nbsp; But, if you need to, the <b>setNextResponder:</b> method lets you override default next responder assignments.&nbsp; Here it adds <b>lastResponder</b> to the end of <b>myWindow</b>'s responder chain:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow setNextResponder:lastResponder];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The <b>nextResponder</b> method returns an object's current next responder:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">next = [myView nextResponder];</font>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Outlets</b></font>

<p><font face="Times">Every application must have an Application object, at least two or three Windows, and some Views to display within the Windows.&nbsp; So every application will have the core framework of Responders discussed above.&nbsp; This framework is self-contained; instance variables like <b>windowList</b> and <b>superview</b> store references to other core objects.</font>

<p><font face="Times">Almost every application will need to define its own set of objects to encapsulate behavior that's specific to the application.&nbsp; Some objects will be Responders--Views of a custom design, special types of Panels, an Application subclass.&nbsp; As such, they assume roles within the core framework.</font>

<p><font face="Times">Most applications will also need to define objects that aren't Responders, or define relationships between objects that aren't covered by the core instance variables.&nbsp; An application's network of objects can be extended beyond the core framework through what Interface Builder terms &quot;outlets&quot;--instance variables that point to other objects.&nbsp; The Application Kit provides some outlets that you can initialize, and you can provide others to accommodate the objects you define for your application.</font>

<p><font face="Times">In many ways, outlets are similar to core instance variables like <b>superview</b> and <b>windowList</b>; they define receivers for messages that are generated in response to events and remote messages.&nbsp; But outlets mainly differ from the instance variables that define the core framework:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Outlets are set explicitly, not as a by-product of some other action.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">They can be <b>nil</b>; applications usually provide default behavior when an outlet hasn't been initialized.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">An outlet can belong to any class.&nbsp; They can be Responders, but don't have to be.&nbsp; They're often objects that are defined specifically to hold the inner algorithms of the application, as opposed to the code concerned with the user interface.&nbsp; As such, they're usually subclasses of the generic Object class.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The Application Kit defines two outlet instance variables that can extend a connection to objects outside the core:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Controls send their action messages to a <b>target</b>.</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Some objects let a <b>delegate</b> take over some of their responsibilities.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The sections that follow discuss the role of these two instance variables in a program's structure.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Delegates</b></font>

<p><font face="Times">A delegate acts for another object.&nbsp; Instead of defining a subclass to add functionality to a class, the methods and instance variables that would have gone into the subclass are placed in a class definition for an independent object. That object is then assigned to be the delegate of one or more client objects.</font>

<p><font face="Times">There are no default delegates.&nbsp; You must define the delegate's class to give it the functionality your application requires, create an instance of the class, and assign it to a client with the <b>setDelegate:</b> method.&nbsp; Here <b>setDelegate: </b>makes <b>myProxy</b> NXApp's delegate:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[NXApp setDelegate:myProxy];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times"><b>delegate</b> returns the receiver's delegate:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; theBoss;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">theBoss = [NXApp delegate];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">These Application Kit classes define <b>setDelegate:</b> and <b>delegate</b> methods:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=131></td>

<td><font face="Times">Application</font><br>
<font face="Times">Window</font><br>
<font face="Times">Text</font><br>
<font face="Times">Listener</font><br>
<font face="Times">Speaker</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The delegate that's assigned to a Window or to the Application object can eliminate the need to define a Window or Application subclass; it can take over most functions you'd be tempted to add to the class.&nbsp; Panels, Menus, and PopUpLists inherit the ability to have a delegate from the Window class.</font>

<p><font face="Times">Although other Responders have delegates, Views (with the exception of Text objects) don't.&nbsp; Applications generally need to define View subclasses to add specific drawing and event-handling behavior to the generic class.&nbsp; The subclass can contain any application-specific code you need to write; a delegate would be extra baggage.</font>

<p><font face="Times">As implemented in the Application Kit, the Text object has enough functionality and options to serve almost all applications; few will need to define a Text subclass.&nbsp; It has a delegate only to give the application control over the user's text input and editing, and over the user's attempts to resize the display.</font>

<p><font face="Times">The delegates defined for Responders (in the Application, Window, and Text classes) extend the event-handling capabilities of those objects.&nbsp; The delegates defined in the Speaker and Listener classes extend the application's ability to send and respond to remote messages.&nbsp; At startup, before processing the first event, the Application object makes sure that a Listener and Speaker are in place and sets itself, NXApp, to be their delegate.&nbsp; The Listener normally entrusts its delegate with the remote messages it receives.&nbsp; But since NXApp can have its own delegate, the Listener defers to NXApp's delegate whenever possible.&nbsp; You can therefore implement the methods that respond to remote messages in an Application subclass or in the class you define for the Application object's delegate.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Delegated Messages</b></font>

<p><font face="Times">Because a delegate is an object you design, it can do anything you choose for it to do.&nbsp; You could, for example, have it hold the basic algorithms for your application and make it the target for a set of Controls.</font>

<p><font face="Times">In its role as a delegate, it can receive a variety of messages both from the client objects it serves and from other Kit objects that get the delegate's <b>id</b> from the client.&nbsp; The Application Kit initiates some messages to delegates as part of the normal process of responding to events and remote messages.&nbsp; Messages are sent only if the delegate implements a method that can respond.&nbsp; In general, the messages sent by Kit objects fall into four categories:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Messages that notify the delegate of some action the client object took or is about to take.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Untargeted action messages that the client object could potentially have responded to.&nbsp; Application and Window delegates are the only ones that can receive action messages from Controls.&nbsp; See &quot;Action Messages&quot; under &quot;Event Handling&quot; in the next chapter for a description of how these messages are distributed to delegates (and other objects).</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Remote messages from other applications, as relayed through the Listener.&nbsp; By default, NXApp is expected to respond to remote messages.&nbsp; Its delegate can intervene and take over that function.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Messages that announce application-defined events and subevents of the system-defined event.&nbsp; It's the Application object's responsibility to respond to these events, and its delegate is given a chance to handle the task.&nbsp; See &quot;Event Handling&quot; in the next chapter for details.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Notification messages are easily recognized by the structure of the methods they ask the delegate to perform:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times"><i>class</i> { <b>Will</b> | <b>Did</b> } <i>Action</i> <b>:</b> . . .</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The method name begins with an indication of the client object's class--&quot;app,&quot; &quot;window,&quot; or &quot;text.&quot;&nbsp; This is followed by &quot;Will&quot; or &quot;Did&quot;, depending on whether the message notifies the delegate prior to the client taking action or only after the client has acted.&nbsp; Next is an indication of the action and a colon introducing the method's first argument, the <b>id </b>of the object sending the message.&nbsp; A notification message is always sent by the client object itself, so the sender belongs to the class identified by the first word of the method name.&nbsp; Other keywords and arguments may be added at the end.</font>

<p><font face="Times">Prior notifications (those with &quot;Will&quot;) generally give the delegate a chance to approve or disapprove of the impending action, or to modify it in some way.&nbsp; For example, a Window sends its delegate <b>windowWillResize:toSize:</b> messages as the user drags an outline of the window to a new location.&nbsp; The message gives the delegate a chance to constrain the size of the window.</font>

<p><font face="Times">Notifications after the fact (those with &quot;Did&quot;) allow the delegate to coordinate other activities with the actions of its client.&nbsp; For example, a Window delegate receives <b>windowDidBecomeKey:</b> messages from a client Window after the Window becomes the key window.&nbsp; The Application object sends its delegate an <b>appDidInit:</b> message after the application has been initialized and is ready to receive its first event.&nbsp; This gives the delegate a chance to do any final initialization that may be necessary.</font>

<p><font face="Times">Windows, Text objects, and the Application object can send their delegates notification messages dealing with a wide variety of topics.&nbsp; Each of these messages is described later in this chapter, in Chapter 7, or in Chapter 9 under the appropriate topic.&nbsp; The full set of notification methods are listed below for ease of reference:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Helvetica"><b>Application</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=131></td>

<td><font face="Times">appDidInit:</font><br>
<font face="Times">appDidBecomeActive:</font><br>
<font face="Times">appDidResignActive:</font><br>
<font face="Times">appDidHide:</font><br>
<font face="Times">appDidUnhide:</font><br>
<font face="Times">appDidUpdate:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Helvetica"><b>Window</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=131></td>

<td><font face="Times">windowWillClose:</font><br>
<font face="Times">windowWillResize:toSize:</font><br>
<font face="Times">windowWillReturnFieldEditor:toObject:</font><br>
<font face="Times">windowWillMiniaturize:toMiniwindow:</font><br>
<font face="Times">windowDidResize:</font><br>
<font face="Times">windowDidMiniaturize:</font><br>
<font face="Times">windowDidDeminiaturize:</font><br>
<font face="Times">windowDidExpose:</font><br>
<font face="Times">windowDidMove:</font><br>
<font face="Times">windowDidBecomeKey:</font><br>
<font face="Times">windowDidResignKey:</font><br>
<font face="Times">windowDidBecomeMain:</font><br>
<font face="Times">windowDidResignMain:</font><br>
<font face="Times">windowDidUpdate:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Helvetica"><b>Text</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=131></td>

<td><font face="Times">textWillResize:</font><br>
<font face="Times">textWillChange:</font><br>
<font face="Times">textWillEnd:</font><br>
<font face="Times">textWillSetSel:toFont:</font><br>
<font face="Times">textWillConvert:fromFont:toFont:</font><br>
<font face="Times">textDidResize:oldBounds:invalid:</font><br>
<font face="Times">textDidChange:</font><br>
<font face="Times">textDidEnd:endChar:</font><br>
<font face="Times">textWillStartReadingRichText:</font><br>
<font face="Times">textWillReadRichText:stream:atPosition:</font><br>
<font face="Times">textWillFinishReadingRichText:</font><br>
<font face="Times">textDidRead:paperSize:</font><br>
<font face="Times">textWillWrite:paperSize:</font><br>
<font face="Times">textWillWriteRichText:stream:forRun:atPosition:emitDefaultRichText:</font><br>
<font face="Times">text:isEmpty:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The last method in this list lacks a &quot;Will&quot; or &quot;Did.&quot;&nbsp; It's the exception that proves the rule.</font>

<p><font face="Times">Because a delegate can belong to any class, the Application Kit checks before sending it a message to be sure that it has implemented a method that can respond.&nbsp; You can implement just the methods that you need.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Targets</b></font>

<p><font face="Times">Targets receive action messages that are generated as the result of user actions on a control.&nbsp; The action message gives application-specific meaning to the events the control receives.</font>

<p><font face="Times">Like a delegate, a target must implement methods to respond to the messages it's sent.&nbsp; But unlike a delegate, which receives notification messages chosen from a limited and Kit-defined set, a target receives action messages that are set by the programmer.</font>

<p><font face="Times">Because you can set both the target and the method it's to perform, the Application Kit assumes that the target has implemented a method to respond to the action message it's sent.&nbsp; The Kit doesn't check to make sure the target can respond before sending the message.</font>

<p><font face="Times">See &quot;Action Messages&quot; in the next chapter for information on the structure of these messages and the pattern of distribution when no explicit target is set.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Defining an Outlet</b></font>

<p><font face="Times">The instance variables defined in the Application Kit--<b>target</b>, <b>superview</b>, <b>contentView</b>, and so on--specify certain roles that objects can play in an application.</font>

<p><font face="Times">You can define other roles simply by adding outlet instance variables in a subclass definition.&nbsp; You could, for example, define an object that would act as the delegate for a number of Windows and provide the object with an outlet instance variable for each Window.&nbsp; Or you could define a View subclass with an instance variable that pointed to an object that had a special relationship to the View, in essence a View delegate.</font>

<p><font face="Times">Object-oriented programming makes adding to the program structure in this way fairly easy.&nbsp; Interface Builder makes it even easier.&nbsp; As you build your application, it lets you define outlets for the messages your objects will send.&nbsp; Interface Builder provides each outlet with a method to set its value; you can define a corresponding method to return its current value.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Named Objects</b></font>

<p><font face="Times">There's an alternative to instance variables as a way of defining the relationships between objects.&nbsp; With Application Kit functions, you can assign an object a name, then later use the name to retrieve its <b>id</b> when you want to send it a message.&nbsp; So that more than one object can have the same name, objects are also assigned an owner.&nbsp; The name is a character string; the owner is another object, which can be <b>nil</b>.</font>

<p><font face="Times"><b>NXGetNamedObject()</b> returns the <b>id</b> when passed a name and owner:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; myGame;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">myGame = NXGetNamedObject(&#34;gameBoard&#34;, NXApp);</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times"><b>NXGetNamedObject()</b> returns <b>nil</b> if it can't find the object for any reason.&nbsp; A simple misspelling of the name can cause a <b>nil</b> return.</font>

<p><font face="Times">Instead of a single name, <b>NXGetNamedObject()</b> can also be passed a series of names concatenated together and separated by underscores as illustrated below:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; myObject;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">myObject = NXGetNamedObject(&#34;aaa_bbbb_cc_ddd&#34;, NXApp);</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The owner (NXApp in the example above) should own the object named first in the list (&quot;aaa&quot; above).&nbsp; The object named first should be the owner of the object identified by the second name.&nbsp; That object should own the object identified by the third name, and so on.&nbsp; <b>NXGetNamedObject()</b> returns the object identified by the last name (&quot;ddd&quot; in the example above).</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">An object name should not include an underscore.&nbsp; If it does, <b>NXGetNamedObject()</b> will treat it as a separator dividing one name from another, rather than as part of the name.</font>

<p><font face="Times">You can name an object and specify an owner for it with <b>NXNameObject()</b>.&nbsp; This example assigns a name and owner to <b>self</b>:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXNameObject(&#34;bartholomewCubbins&#34;, self, NXApp);</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Interface Builder assigns default names to objects, but it permits you to edit or replace the names that are assigned. Interface Builder also assigns owners.&nbsp; Subviews of the Window's content view are considered to be owned by the Window; other Views are owned by their superviews.&nbsp; The Window's owner is determined at run time, when the objects are loaded into memory by <b>loadNibFile:owner:</b> and <b>loadNibSection:owner:</b>.&nbsp; The method's second argument names the owner of all Windows in the Interface Builder archive file.</font>

<p><font face="Times"><b>NXUnnameObject()</b> breaks the association between a name and an object:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXUnnameObject(&#34;bartholomewCubbins&#34;, self);</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">If you pass an object <b>id</b> to <b>NXGetObjectName()</b>, it returns a name that can be inserted into the series passed to <b>NXGetNamedObject()</b>:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">char&nbsp; *myName;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">myName = NXGetObjectName(self);</font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=5></td>

<td><font face="Helvetica" size="+2"><b>Managing Windows</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Windows are managed through individual Window objects and through the Application object, which keeps a list of all the Windows in the application.&nbsp; This section describes methods defined in both classes.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Setting Up a Window</b></font>

<p><font face="Times">The principal class method that creates a new Window, <b>newContent:style:backing:buttonMask:defer:</b>, labels five arguments.&nbsp; They ask for information about the location and size of the Window, its style and type of buffering, what title bar buttons it should have, and whether the Window Server should defer creating a window for the object until one is needed.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; myWindow;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXRect&nbsp; winRect;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXSetRect(&amp;winRect, 100.0, 200.0, 400.0, 700.0);</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">myWindow = [Window newContent:&amp;winRect</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">style:NX_TITLEDWINDOWSTYLE</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">backing:NX_BUFFERED</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">buttonMask:(NX_MINIATURIZEBUTTONMASK |</font><br>
<img src="../../Images/sp.gif" width=376 height=1><font face="Courier" size="-1">NX_CLOSEBUTTONMASK)</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">defer:NO];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The <b>NXSetRect()</b> function initializes an NXRect structure.&nbsp; Here it locates <b>winRect</b> at (100.0, 200.0) and assigns it a width of 400.0 and a height of 700.0.&nbsp; This rectangle is then used to position the window, as explained in the following table:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Argument</b></font></td>

<td><font face="Helvetica"><b>Permitted Values</b></font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">content</font></td>

<td><font face="Times">A pointer to an NXRect structure that specifies the size and location of the window's content area in screen coordinates.&nbsp; The border, title bar, and resize bar are drawn around the area specified.&nbsp; All values in the structure are floating-point numbers (NXCoords), but since a window must be aligned on pixel boundaries, the values shouldn't have any fractional parts.&nbsp; If they do, they'll be rounded down to the nearest whole integer.</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">style</font></td>

<td><font face="Times">The style of the Window's border and title bar.&nbsp; Window styles are discussed in Chapter 2, &quot;The NeXT User Interface.&quot;&nbsp; These constants are provided to specify a Window's style:</font></td></tr>

<tr valign=top>

<td width=124 height=34></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_PLAINSTYLE</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_TITLEDSTYLE</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_SIZEBARSTYLE</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_MENUSTYLE</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_MINIWINDOWSTYLE</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_MINIWORLDSTYLE</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_TOKENSTYLE</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">In general, Windows created by an application specify one of the first three styles in this list, principally NX_TITLEDSTYLE or NX_SIZEBARSTYLE.&nbsp; The other constants are mainly for the internal use of the Application Kit.&nbsp; (See the discussion of style in Chapter 2.)</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">backing</font></td>

<td><font face="Times">The buffering type for the window.&nbsp; The choices are:</font></td></tr>

<tr valign=top>

<td width=124 height=34></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_RETAINED</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_NONRETAINED</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_BUFFERED</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">button mask</font></td>

<td><font face="Times">The title bar buttons for this window.&nbsp; They can be specified by combinations of these masks:</font></td></tr>

<tr valign=top>

<td width=124 height=34></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_CLOSEBUTTONMASK</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_RESIZEBUTTONMASK</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_MINIATURIZEBUTTONMASK</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">NX_ALLBUTTONS combines all three masks into a single constant.</font></td></tr>

<tr valign=top>

<td width=124 height=17></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap></td>

<td><font face="Times">Although there is no &quot;resize button,&quot; NX_RESIZEBUTTONMASK is what makes the resize bar work.&nbsp; It should always be specified for resizable windows (those with NX_SIZEBARSTYLE).&nbsp; Without it, the resize bar is just a pretty appendage at the bottom of a window.</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">defer</font></td>

<td><font face="Times">A boolean flag.&nbsp; If it's YES, the Application Kit won't ask the Window Server to produce a window for the Window object until the application is ready to place the window on-screen.&nbsp; If the flag is NO, a window is created immediately for the object.&nbsp; All windows are created off-screen and must be placed on-screen with the <b>orderWindow:relativeTo:</b>, <b>makeKeyAndOrderFront:</b> or <b>orderFront:</b> method. These methods are discussed under &quot;Reordering a Window&quot; later in this section. &quot;Deferred and One-Shot Windows&quot; below has more on when it's appropriate to pass YES as an argument here.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Once the window's style, buffering type, and title bar buttons have been set, they can't be changed.&nbsp; There are methods that return the style and button mask:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">int&nbsp; myStyle, myButtons;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">myStyle = [myWindow style];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">myButtons = [myWindow buttonMask];</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>The Miniwindow</b></font>

<p><font face="Times">The Application Kit provides a miniwindow counterpart for each window the user miniaturizes (the miniwindow isn't created until it's needed).&nbsp; The Kit takes care of the mechanics of miniaturization through Window's miniaturize: and deminiaturize: methods.&nbsp; Messages to perform these methods are generated in response to user actions--clicking the miniaturize button and double-clicking the miniwindow.</font>

<p><font face="Times">The application's responsibility is limited to determining what image should be displayed within the miniwindow.&nbsp; On the MegaPixel Display, there's room for a 48-pixel by 48-pixel icon below the miniwindow's title bar.&nbsp; According to the user-interface guidelines in Chapter 2, if the window holds a document, this should be the same icon as the one the Workspace Manager displays for the document in a directory window.&nbsp; If not, it should be the same as the application icon.</font>

<p><font face="Times">You can set the icon using Window's <b>setMiniwindowIcon:</b> method.&nbsp; The following message has the miniwindow counterpart for <b>myWindow</b> display the default application icon:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow setMiniwindowIcon:&#34;defaultappicon&#34;];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">In addition to &quot;defaultappicon,&quot; you can pass <b>setMiniwindowIcon:</b> the name you've assigned to a Bitmap object or the names of icons stored as sections in the __ICON or __TIFF segments of the application executable.&nbsp; A Bitmap will be created for the icon when and if it's needed for the miniwindow.&nbsp; (See &quot;Environmental Information&quot; later in this chapter for more on the __ICON and __TIFF segments.)</font>

<p><font face="Times">The <b>miniwindowIcon</b> method returns the name of the icon used in the receiver's miniwindow:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">const char&nbsp; *mininame;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">mininame = [myWindow miniwindowIcon];</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>The Title</b></font>

<p><font face="Times">If the window has a title bar, the <b>setTitle</b>: method can be used to give it a title or modify the current one; title returns the current title:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow setTitle:&#34;Product Names&#34;];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">aString = [myWindow title];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">When a title is set, it's displayed immediately, regardless of whether the display mechanism is temporarily disabled. (See the next chapter for information on the display mechanism.)</font>

<p><font face="Times">The Application Kit doesn't provide a default title; a window remains untitled unless you assign one with the <b>setTitle: </b>method.&nbsp; The same title is used for both the window and its miniwindow counterpart.&nbsp; Because there's less room in a miniwindow, it may display only the initial part of the title that's set.</font>

<p><font face="Times">Titles that are too long for the space between the title bar buttons are cropped to fit.&nbsp; To be sure that a window is wide enough for its title, use the <b>minFrameWidth:forStyle:buttonMask:</b> class method to get the minimum required width:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">float&nbsp; howWide;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">howWide = [Window minFrameWidth:&#34;A Long Window Title&#34;</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">forStyle:NX_TITLEDSTYLE</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">buttonMask:NX_CLOSEBUTTONMASK];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Note that this method returns the width of the frame rectangle, not the content rectangle.&nbsp; Because of the border, the frame rectangle of a titled or resizable window is 2.0 units wider than its content rectangle.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Changing the Close Button</b></font>

<p><font face="Times">If a window displays an editable document, the application should alter the appearance of the window's close button to reflect whether or not the user has made to changes to the document that haven't been saved.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow setDocEdited:YES];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The message above has <b>myWindow</b> display the close button that indicates unsaved changes, if it isn't already displaying it.&nbsp; The same message with NO as the argument would have <b>myWindow</b> display the standard close button.</font>

<p><font face="Times">The <b>isDocEdited</b> method returns the last value set by <b>setDocEdited:</b>.&nbsp; NO is the default value.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">BOOL&nbsp; lastSet;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">lastSet = [myWindow isDocEdited];</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Background Color</b></font>

<p><font face="Times">A window can be assigned a background color with the <b>setBackgroundGray:</b> method:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow setBackgroundGray:NX_WHITE];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The default background color is light gray (NX_LTGRAY).&nbsp; <b>backgroundGray</b> returns the current background color:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">float&nbsp; shade;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">shade = [myWindow backgroundGray];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Whenever the Window is displayed, its content area is filled with the background color before any of its Views draw, but only if its content view hasn't been registered as an opaque View.&nbsp; Since an opaque content view paints every pixel within the content area, the background color wouldn't show through anyway.&nbsp; (See &quot;Displaying Background Views,&quot; in the next chapter, for information on opaque Views.)</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Deferred and One-Shot Windows</b></font>

<p><font face="Times">Each Window object is associated with a window provided by the Window Server.&nbsp; The Window Server usually provides the window when the Window object is created.&nbsp; However, when you create a Window, you have the option of not producing a window for it right away.&nbsp; If you pass YES as the last argument to <b>newContent:style:backing:buttonMask:defer:</b>, the Window object will be created but it won't be associated with a window until one of three methods puts it on-screen:&nbsp; <b>orderFront:</b>, <b>makeKeyAndOrderFront:</b>, or <b>orderWindow:relativeTo:</b>.&nbsp; Any of these methods will:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Make the Window Server produce a window for the Window object.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Send the Window a <b>display</b> message so that all its Views are displayed into its backup buffer.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Place the window on-screen.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">(The <b>orderFront:</b> and <b>orderWindow:relativeTo:</b> methods are discussed more specifically under &quot;Reordering a Window&quot; below.&nbsp; <b>makeKeyAndOrderFront:</b> combines <b>makeKeyWindow</b> and <b>orderFront:</b> messages into a single method.)</font>

<p><font face="Times">Deferring the creation of a Window object's window makes sense in two situations:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">If a window might never be used, deferring it saves the memory that would otherwise be allocated to it.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">If the application is large, deferring some of its windows will reduce the time required to launch it.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Once a window is associated with a Window object, the association usually lasts until the Window object is freed. Freeing the object also frees its window.&nbsp; However, you can arrange for the window to be freed whenever it's taken out of the screen list, by sending the object a <b>setOneShot:</b> message:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow setOneShot:YES];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">A new window will be produced for the Window object each time it's returned to the screen.</font>

<p><font face="Times"><b>isOneShot</b> returns the value set by the last <b>setOneShot:</b> message:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">BOOL&nbsp; willFree;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">willFree = [myWindow isOneShot];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Windows that the user might never bring to the screen, or might put on-screen just once, are prime candidates for being deferred and made one-shot.&nbsp; The information panel, rarely used attention panels, and specialized submenus fit this category.</font>

<p><font face="Times">By deferring the creation of the Window object's window until it's needed and then freeing it when it's no longer needed, you can combine the benefits of buffering when the window is on-screen with the benefits of a nonretained window when it's not.</font>

<p><font face="Times">You should never attempt to draw within a Window that isn't associated with one of the Window Server's windows. The display methods discussed under &quot;Drawing in the View Hierarchy&quot; in the next chapter check to be sure that a window exists for a Window object before displaying any of its Views.&nbsp; Dynamic drawing methods are performed only while the window is visible, so there's little reason to check.&nbsp; However, if you write any independent code that can draw in an off-screen window, you need to be certain that a window exists before attempting to draw.&nbsp; If the <b>windowNum</b> method doesn't return an integer greater than 0, there is no window to draw in.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Hiding Panels</b></font>

<p><font face="Times">By default, when the active application deactivates, the Application Kit hides its panels.&nbsp; However, you can choose to override this default and leave a panel on-screen even when its application isn't active:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myPanel setHideOnDeactivate:NO];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The <b>doesHideOnDeactivate</b> returns the value set by the last <b>setHideOnDeactivate:</b> message:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">BOOL&nbsp; willHide;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">willHide = [myPanel doesHideOnDeactivate];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Chapter 2 gives guidelines for when it's permitted to leave a panel for a deactivated application on-screen.&nbsp; It should be a rare occurrence.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Window Status</b></font>

<p><font face="Times">Although users generally select the key window and main window, there's a method that lets the application do it:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow makeKeyWindow];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This method is most often used to designate the initial key window when the application first starts up.&nbsp; When a standard window is made the key window, it also becomes the main window.&nbsp; (The <b>makeKeyWindow</b> method can be performed in conjunction with <b>orderFront:</b> by a single message to <b>makeKeyAndOrderFront:</b>.)</font>

<p><font face="Times">The <b>isKeyWindow</b> and <b>isMainWindow</b> methods return the status of the receiving object:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">BOOL&nbsp; nowKey, nowMain;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">nowKey = [myWindow isKeyWindow];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">nowMain = [myWindow isMainWidnow];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The Application object can identify the current key window and main window:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; keyWin, mainWin;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">keyWin = [NXApp keyWindow];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">mainWin = [NXApp mainWindow];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">These methods return <b>nil</b> if the key window or main window isn't in the current application.</font>

<p><font face="Times">For more detailed information on the methods that determine and reflect window status, see &quot;The Key Window and Main Window&quot; in the next chapter.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Physical Management</b></font>

<p><font face="Times">There are three ways that an application can manipulate the window associated with a Window object.&nbsp; It can:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Move the window,</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Resize it, and</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Reorder it in (or out of) the screen list.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">These operations are accomplished through messages to the Window object, which, in turn, generates instructions for the Window Server.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Moving a Window</b></font>

<p><font face="Times">The <b>moveTo::</b> method repositions a window within the screen coordinate system:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow moveTo:x :y];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Its arguments, (<i>x</i>, <i>y</i>), give the new location of the lower left corner of the Window's frame rectangle in screen coordinates.&nbsp; Figure 6-12, below, illustrates the effect of the <b>moveTo::</b> method.&nbsp; Note that when the window moves, its coordinate system and all its contents move with it.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F12.gif" width=354 height=186></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-12</b></font><font face="Times">.&nbsp; <b>moveTo::</b></font>

<p><br><br>

<p><font face="Times">Another method, <b>moveTopLeftTo::</b>, can be used to reposition a window by its top left corner:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow moveTopLeftTo:x :y];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times"><b>moveTopLeftTo::</b> is the same as <b>moveTo::</b>, except that it positions the top left, rather than the lower left, corner of the window.&nbsp; If the height of the window's frame rectangle were subtracted from the y coordinate, a <b>moveTo:: </b>message could be used with the same effect as <b>moveTopLeftTo::</b>.</font>

<p><font face="Times">These two methods move the window from its starting location to its destination in a single step; the window isn't drawn in any intermediate positions.&nbsp; Note that unlike the class methods that create a Window, they position the window's frame rectangle, not its content rectangle.</font>

<p><font face="Times">The <b>moveTo::</b> and <b>moveTopLeftTo::</b> methods don't generate window-moved subevents (of the kit-defined event). Since the new location of the window is evident from the method's two arguments, none is needed.&nbsp; Window-moved subevents are generated when the user moves a window, not when the application does.&nbsp; The subevent serves as the application's only notice that something has happened.</font>

<p><font face="Times">Typically, users move a window by dragging it by its title bar, but you can also let users drag a window by a point within its content area.&nbsp; The <b>dragFrom::eventNum:</b> method specifies the point and requests the Window Server to move the window in response to the user's action.&nbsp; A <b>dragFrom::eventNum:</b> message should be sent only after receiving the mouse-down event that initiates dragging.&nbsp; Its first two arguments give the current location of the cursor within the window's base coordinate system, and can be taken from the event record of the mouse-down event.&nbsp; The third argument is the event number of the mouse-down event, also taken from its event record.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow dragFrom:eventPtr-&gt;location.x :eventPtr-&gt;location.y</font><br>
<img src="../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">eventNum:eventPtr-&gt;data.mouse.eventNum];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The Window Server moves the window so that the cursor stays at the same location within the window.&nbsp; When the user releases the mouse button, it generates a window-moved subevent to notify the application.&nbsp; The user's mouse-dragged events are trapped by the Window Server; they're not sent to the application.</font>

<p><font face="Times">The <b>center</b> method positions a window so that it's centered in the top two-thirds of the screen.&nbsp; That's where attention panels should come up so that users can't miss or ignore them.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myPanel center];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This method adjusts the position of the window, if necessary, to keep its title bar on-screen.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Resizing a Window</b></font>

<p><font face="Times">The <b>placeWindow:</b> method resizes and repositions a window within the screen coordinate system.&nbsp; Its argument is a pointer to an NXRect structure with the new location and dimensions of the window's frame rectangle:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXRect&nbsp; newRect;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXSetRect(&amp;newRect, 300.0, 500.0, 700.0, 600.0);</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow placeWindow:&amp;newRect];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">As illustrated in Figure 6-13 below, the window both moves to a new location and assumes a new shape.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><img src="F0.gif" width=296 height=233></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Figure 6-13</b></font><font face="Times">.&nbsp; <b>placeWindow:</b></font>

<p><br><br>

<p><font face="Times">However, <b>placeWindow:</b> is an expensive way to move a window when compared to <b>moveTo::</b> and <b>moveTopLeftTo::</b>.&nbsp; The latter two methods rely on the Window Server to shift the window's display and coordinate system to a new location, but <b>placeWindow:</b> must reinitialize the window's coordinate system and clipping path and redisplay all the Views within the window after it has moved.&nbsp; For this reason, <b>placeWindow:</b> should be used only to resize a window, not to move it.</font>

<p><font face="Times">To make what's going on clear to the user, it's best not to mix resizing with moving.&nbsp; To avoid the appearance of moving a window when you resize it, keep a corner or side of the window constant, or resize the window by expanding it outward (or collapsing it inward) on all sides at once.</font>

<p><font face="Times">Figure 6-13 above disregards this advice.&nbsp; It appears to move the window because, in a sense, its top and right sides are expanded outward while its bottom and left sides are collapsed inward.</font>

<p><font face="Times"><b>sizeWindow::</b>, an alternative to <b>placeWindow:</b>, keeps the lower left corner of the window constant while adjusting its width and height.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow sizeWindow:width :height];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Its arguments specify the new width and height of the window's content rectangle (not its frame rectangle) in screen coordinates.</font>

<p><font face="Times">Because the new size of the window is apparent from the arguments to <b>placeWindow:</b> and <b>sizeWindow::</b>, neither method generates a window-resized subevent (of the kit-defined event).</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Reordering a Window</b></font>

<p><font face="Times">The <b>orderWindow:relativeTo:</b> method alters the position of a window in the Window Server's screen list.&nbsp; The first argument specifies whether the receiving Window is to be placed above another window in the list, placed below another window, or left entirely off the list.&nbsp; The choices are:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=131></td>

<td><font face="Times">NX_ABOVE</font><br>
<font face="Times">NX_BELOW</font><br>
<font face="Times">NX_OUT</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The second argument is a window number that identifies the window the receiving object is to be ordered above or below, or 0 if the receiver is to be ordered above or below all other windows in its tier.&nbsp; If the first argument is NX_OUT, the second argument is ignored.&nbsp; This message takes <b>myWindow</b> out of the screen list:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow orderWindow:NX_OUT relativeTo:0];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The <b>orderWindow:relativeTo:</b> method won't let you order a window into another tier.&nbsp; If the second argument names a window in a higher or lower tier, the receiving Window will be reordered so that it's as close to that window as possible, but it won't be ordered out of its own tier.</font>

<p><font face="Times">It's generally not very useful for an application window to be ordered behind the workspace window (the window that provides the dark gray background on-screen), since users wouldn't be able to find it there.&nbsp; Therefore, the message below puts the receiving Window at the back of its tier but keeps it just in front of the workspace window.&nbsp; You can think of the workspace window as being in a tier of its own.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow orderWindow:NX_BELOW relativeTo:0];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The Window class defines three methods as shortcuts for common reordering cases.&nbsp; Each method takes a single argument, an <b>id</b>, so that it can be used in action messages.&nbsp; The method itself doesn't make use of the argument.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow orderOut:nil];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow orderFront:nil];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow orderBack:nil];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The <b>orderOut:</b> method removes the receiving Window from the screen list; it has the same effect as the first <b>orderWindow:relativeTo:</b> example shown above.&nbsp; The <b>orderFront:</b> method puts the receiving Window at the front of its tier in the screen list.&nbsp; <b>orderBack:</b> puts a window at the back of its tier, but in front of the workspace window; it's a shorthand for the second <b>orderWindow:relativeTo:</b> example shown above.</font>

<p><font face="Times">A fourth method, <b>makeKeyAndOrderFront:</b>, combines two operations that often go together--making a Window the key window (as <b>makeKeyWindow</b> does) and putting it at the front of its tier (as <b>orderFront:</b> does).&nbsp; The user interface requires a window to come forward when it becomes the key window.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow makeKeyAndOrderFront:nil]</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">When the key window (or main window) is taken out of the screen list, it loses its key window (or main window) status.&nbsp; The Application Kit tries to make another window in the active application the new key window (and main window).&nbsp; However, simply reordering windows within the screen list or putting a window that was previously out of the list in, has no affect on any window's status.&nbsp; Moving another window in front of the key window doesn't change the key window.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Getting Information about a Window</b></font>

<p><font face="Times">NXApp and Window objects provide information about the application's Windows in response to messages sent by other objects.</font>

<p><font face="Times">Many of these messages were illustrated earlier in this chapter.&nbsp; For information about properties that are set when a Window is established, see &quot;Setting Up a Window&quot; above.&nbsp; For information on methods that report a Window's status as the key window or main window, see &quot;Window Status&quot; earlier in this section and &quot;Selecting an Application, Window, and View&quot; in the next chapter.&nbsp; Methods that provide other information are described below.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Frame and Content Rectangles</b></font>

<p><font face="Times">The <b>getFrame:</b> method takes a pointer to a rectangle (<b>NXRect *</b>), which it initializes with the location and size of the Window in screen coordinates.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXRect&nbsp; myFrame;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[myWindow getFrame:&amp;myFrame];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times"><b>getFrame:</b> provides the Window's frame rectangle.&nbsp; Given the frame rectangle, the <b>getContentRect:forFrameRect:style:</b> class method can find the content rectangle:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NXRect&nbsp; myContent;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[Window getContentRect:&amp;myContent</font><br>
<img src="../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">forFrameRect:&amp;myFrame</font><br>
<img src="../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">style:NX_TITLEDSTYLE];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Given the content rectangle, <b>getFrameRect:forContentRect:</b> can find the frame rectangle:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[Window getFrameRect:&amp;myFrame</font><br>
<img src="../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">forContentRect:&amp;myContent</font><br>
<img src="../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">style:NX_TITLEDSTYLE];</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Window Numbers</b></font>

<p><font face="Times">The <b>windowNum</b> method returns the receiver's window number:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">int&nbsp; which;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">which = [myWindow windowNum];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">If the receiving Window object isn't currently associated with a window, this method returns</font> <img src="../../Images/c2D.gif" width=8 height=4><font face="Times">1.</font>

<p><font face="Times">The Application object can find the <b>id</b> of the Window object associated with a window when given its window number:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; theWindow;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">theWindow = [NXApp findWindow:theNum];</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Screen List Information</b></font>

<p><font face="Times">A Window can return whether it's currently in the screen list:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">BOOL&nbsp; inList;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">inList = [myWindow isVisible];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The isVisible method returns YES even if the window is completely covered by other windows.&nbsp; This method merely tests whether the window is somewhere in the screen list.</font>

<p><font face="Times">The Application object can identify of the frontmost window in the list.&nbsp; It will generally be a menu or an attention panel:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; topWin;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">topWin = [NXApp frontWindow];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">NXApp can also provide the ordering of all the application's windows in the screen list:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">int&nbsp; *listPtr, howMany;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[NXApp getScreenList:&amp;listPtr count:&amp;howMany];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times"><b>getScreenList:count:</b> produces an array that lists all the on-screen windows belonging to the application, ordered as they are in the screen list (the front window first).&nbsp; It returns, by reference, a pointer to the array and the number of windows listed.&nbsp; The array is a list of window numbers, not <b>id</b>s.&nbsp; To find the <b>id</b> of a Window, pass the window number as the argument in a <b>findWindow:</b> message:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; theWin;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">theWin = [NXApp findWindow:*(listPtr+3)];</font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=5></td>

<td><font face="Helvetica" size="+2"><b>Environmental Information</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Applications run in an environment that's determined in part by the hardware, in part by the Mach operating system, the Window Server, and the Application Kit, and in part by choices made by the user.&nbsp; The Kit defines methods and functions that supply the environmental information an application might require:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The <b>getScreenSize:</b> method, defined in the Application class, supplies the size of the screen where the application's windows are displayed:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">NXSize&nbsp; theScreen;</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">[NXApp getScreenSize:&amp;theScreen];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">You should use this method rather than assume a fixed screen size.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The <b>hostName</b> method provides the name of the machine where the application is running:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">const char&nbsp; *where;</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">where = [NXApp hostName];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Application's <b>appName</b> method provides the name of the application:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">const char&nbsp; *me;</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">me = [NXApp appName];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">The name is the one assigned while compiling the program, as explained under &quot;Segments&quot; below, or if no name was assigned, the name passed in the <b>argv</b> array.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The name of the current user is returned by the <b>NXUserName()</b> function:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">const char&nbsp; *who;</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">who = NXUserName();</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The user's home directory is returned by <b>NXHomeDirectory()</b>:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">const char&nbsp; *domicile;</font><br>
<img src="../../Images/sp.gif" width=143 height=1><font face="Courier" size="-1">domicile = NXHomeDirectory();</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">When the Workspace Manager launches an application, it sets the application's current working directory to the user's home directory.&nbsp; The standard UNIX function <b>getwd()</b> returns the current working directory, and <b>chdir()</b> changes it.</font>

<p><font face="Times">If you change the current working directory so that it's on a device--an optical disk--that the user wants to unmount, the Application Kit may change it back to the user's home directory (or to the root directory if for some reason there is no home directory).&nbsp; The Kit makes the change in response to an <b>unmounting:ok:</b> remote message from the Workspace Manager.&nbsp; Since remote messages are received between events, you can be sure that the current working directory will remain constant during the response to an event.&nbsp; But you may need to check before each new event to be sure that it hasn't been changed &quot;behind your back&quot; between events.</font>

<p><font face="Times">You can avoid behind-the-back changes by implementing an <b>appUnmounting:</b> method in the Application object's delegate.&nbsp; Your method will then need to handle those cases in which the user wants to unmount the disk where the current working directory is located.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Command-Line Arguments</b></font>

<p><font face="Times">Information entered on the command line when launching a C (or Objective-C) program is passed to the <b>main() </b>function as a pair of conventional arguments, <b>argc</b> and <b>argv</b>.&nbsp; (<b>argv</b> points to an array of character strings containing the command-line arguments, and <b>argc</b> counts the number of strings in the array.)</font>

<p><font face="Times">To make command-line arguments available from any point within an application, including from within a class definition, the loader writes them to a well-defined location and the Application Kit provides these global variables to refer to them:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">int&nbsp;&nbsp;&nbsp;&nbsp; NXArgc;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">char&nbsp; **NXArgv;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">It's therefore unnecessary for the <b>main()</b> function to deal with command-line arguments itself.</font>

<p><font face="Times">When the Workspace Manager launches an application, there's no command line where users can specify program options and parameter values.&nbsp; Rather than choose options on the command line, users make choices once the application is launched and activated.&nbsp; An application can record these choices in the defaults database for use the next time the application is launched.&nbsp; It might, for example, remember where the user placed various panels, or which font was preferred.</font>

<p><font face="Times">Nevertheless, the Workspace Manager uses command-line arguments to pass useful information to the applications it launches.&nbsp; If, during testing, you launch your application from a Terminal window, you can also use the command line to pass it test values for various program parameters.</font>

<p><font face="Times">Information passed on the command line as pairs of argument strings in the format</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">-<i>parameter value</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">can be read by the functions that prepare a table of default parameter values for an application.&nbsp; The first string begins with a hyphen and names a parameter; the following string assigns the parameter a value.&nbsp; After this information is recorded, the arguments are stripped from the NXArgv array and NXArgc is adjusted accordingly.</font>

<p><font face="Times">Values assigned on the command line in this way override values taken from the user's defaults database.&nbsp; (See &quot;The Defaults System&quot; in Chapter 10 for more information on how command-line arguments contribute to the system of default parameters.)</font>

<p><font face="Times">Arguments that you can pass on the command line when debugging your application include these:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Parameter</b></font></td>

<td><font face="Helvetica"><b>Value</b></font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">NXShowPS</font></td>

<td><font face="Times">If not NULL, all PostScript code sent to the Window Server, and all values returned from the PostScript interpreter to the application, will be written (in ASCII rather than binary form) to the standard error stream.</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">NXShowAllWindows</font></td>

<td><font face="Times">If not NULL, all windows will be placed on-screen, including those that normally stay off-screen--such as windows that store images that are composited to other, on-screen windows.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The arguments passed by the Workspace Manager are read and stripped from NXArgv when the Application class is initialized, just before the <b>new</b> message is sent.&nbsp; They define these public parameters:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Parameter</b></font></td>

<td><font face="Helvetica"><b>Value</b></font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">NXOpen</font></td>

<td><font face="Times">The full pathname of the file the application is to open.</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">NXOpenTemp</font></td>

<td><font face="Times">The full pathname of a temporary file the application is to open.&nbsp; Temporary files should be deleted before the application quits.</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">NXHost</font></td>

<td><font face="Times">The name of the host machine.&nbsp; The Workspace Manager provides this information only when it's run remotely (on a different machine).</font></td></tr>

<tr valign=top>

<td width=124 height=10></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">NXAutoLaunch</font></td>

<td><font face="Times">A value other than 0 if the application was launched by the Workspace Manager at login, and undefined otherwise.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">When an application is launched by the Workspace Manager, NXArgv[0] is guaranteed to contain the full pathname of the application's executable file.&nbsp; By stripping the last element from the pathname, an application can obtain the path for the file package where auxiliary files essential to the application are located.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Segments</b></font>

<p><font face="Times">The Mach object file format, the default format for the NeXT computer, allows you to create segments in the executable file and store whatever information you need there.&nbsp; The software kits take advantage of this facility to keep various kinds of information--archived objects, sound files, icons, and other images--in close association with the code that requires it.</font>

<p><font face="Times">Some segments are created by the compiler and can't be altered or added to:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">__TEXT</font></td>

<td><font face="Times">The text of the program's executable instructions</font></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">__DATA</font></td>

<td><font face="Times">Initialized and uninitialized data</font></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">__OBJC</font></td>

<td><font face="Times">Data structures required by the run-time system.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Other segments can be created with the <b>-segcreate</b> option to the link editor:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">cc ... -segcreate ANIMATION paneOne image1.tiff</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This example creates the ANIMATION segment and copies the <b>image1.tiff</b> file into it as a section named &quot;paneOne.&quot; If the ANIMATION segment had already been created, the <b>-segcreate</b> directive would simply have added another section to it.&nbsp; Usually sections keep the same name as the file.</font>

<p><font face="Times">Some segments have well-established names:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">__NIB</font></td>

<td><font face="Times">Archived objects that were created using Interface Builder.</font></td></tr>

<tr valign=top>

<td width=131 height=20></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">__SND</font></td>

<td><font face="Times">Sound files required by the program.</font></td></tr>

<tr valign=top>

<td width=131 height=20></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">__ICON</font></td>

<td><font face="Times">Files in Tag Image File Format (TIFF) that specify the icons that the Workspace Manager should</font></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">display for the</font></td>

<td><font face="Times">application and its files.</font></td></tr>

<tr valign=top>

<td width=131 height=20></td></tr>

<tr valign=top>

<td width=131></td>

<td nowrap><font face="Times">__TIFF</font></td>

<td><font face="Times">Other TIFF images used in the program.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">You can add sections to these segments as required by your application.&nbsp; The information you store there can be read by methods and functions defined in the software kits.&nbsp; For example, the <b>findBitmapFor:</b> method will create a Bitmap object from a section of the __TIFF or __ICON segment.</font>

<p><font face="Times">The first section of the __ICON segment isn't an icon; it's a header, appropriately named &quot;__header.&quot;&nbsp; It specifies how the Workspace Manager is to use the icons stored in the segment.&nbsp; Each line in the header describes a different icon--a different section within the segment.&nbsp; A line contains four pieces of information, separated by tabs:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">1.</font></td>

<td><font face="Times">The letter &quot;F&quot; (or &quot;f&quot;) if the icon should be displayed for just one file, or the the letter &quot;S&quot; (or &quot;s&quot;) if the icon should be displayed for all files bearing a certain extension (or &quot;suffix&quot;).</font></td></tr>

<tr valign=top>

<td width=105 height=20></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">2.</font></td>

<td><font face="Times">The name of the file, or the characters in the extension (without the period).</font></td></tr>

<tr valign=top>

<td width=105 height=20></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">3.</font></td>

<td><font face="Times">The name of the application.&nbsp; This is the name that the Application object's <b>appName</b> method will return.</font></td></tr>

<tr valign=top>

<td width=105 height=20></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">4.</font></td>

<td><font face="Times">The name of the section.&nbsp; The section containing the application icon--the one that will be displayed for the application executable--should be named &quot;app&quot; (and no section should be named &quot;__tiff&quot; or &quot;__TIFF&quot;).</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The following is an example of a header section:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">F&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Crossword&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Crossword&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; app</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pzl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Crossword&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; puzzle.tiff</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pdrome&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Crossword&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; palindrome.tiff</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; agm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Crossword&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; anagram.tiff</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This header corresponds to linker instructions such as these:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">-segcreate __ICON __header Crossword.iconheader</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">-segcreate __ICON app crossword.tiff</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">-segcreate __ICON puzzle.tiff puzzle.tiff</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">-segcreate __ICON palindrome.tiff palindrome.tiff</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">-segcreate __ICON anagram.tiff anagram.tiff</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">Segment names are usually all uppercase letters; section names are lowercase or mixed case.&nbsp; The double underscore prefixes are used only to prevent potential clashes with other names.</font></td></tr>

</table>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=5></td>

<td><font face="Helvetica" size="+2"><b>Application Kit Conventions</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The Application Kit imposes a small number of constraints on the Objective-C code you write.&nbsp; None of them constrain what you can do, only how you can go about doing it.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Reading and Writing Instance Variables</b></font>

<p><font face="Times">Because an object's instance variables are private to the object, Application Kit classes provide methods that can be used to modify them and read their values.&nbsp; For example, the <b>setFloatValue:</b> method assigns a value to a SliderCell object, and <b>floatValue</b> returns its current value as a floating-point number:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">float&nbsp; myVal;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">myVal = [mySliderCell floatValue];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[mySliderCell setFloatValue:212.0];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">An object has direct access to all its instance variables, so it can read them without sending a message.&nbsp; A SliderCell subclass could look directly at its <b>value</b> instance variable:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">if ( value &gt;= 0.0 )</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">[self doSomething];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Although they can be read directly, inherited instance variables should be set only through the methods provided.&nbsp; This is because these methods often do more than simply set the instance variable; they have side effects that the Application Kit counts on.&nbsp; For example, the <b>setFloatValue:</b> method makes sure <b>value</b> stays within maximum and minimum bounds.&nbsp; Similarly, the methods that change a View object's <b>frame</b> and <b>superview</b> instance variables automatically update other instance variables.&nbsp; To function accurately, the Application Kit requires that these correspondences be maintained.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Writing Methods That Create Instances</b></font>

<p><font face="Times">In the Application Kit, class methods that create a new instance generally begin with the word &quot;new.&quot;&nbsp; This is usually followed by one or more labeled arguments.&nbsp; For example, three different methods can create an instance of the Button class:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">myButton = [Button new];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">yourButton = [Button newFrame:&amp;rect];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">ourButton = [Button newFrame:&amp;rect</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">title:&#34;Panic&#34;</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">tag:-1</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">target:anObject</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">action:@selector(relax:)</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">key:'p'</font><br>
<img src="../../Images/sp.gif" width=292 height=1><font face="Courier" size="-1">enabled:YES];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The arguments to these methods serve to initialize the new object (they're explained in Chapter 9).&nbsp; The more arguments a method has, the more freedom it gives you to determine the character of the object at the outset.</font>

<p><font face="Times">Regardless of the number of arguments, each method is guaranteed to return a working, fully initialized object, even if some of its instance variables are initialized to 0.&nbsp; To make good on this guarantee, two things are required:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Each method must be linked, directly or indirectly, to the <b>new</b> method defined in the Object class.&nbsp; Object's <b>new </b>method is the one that allocates memory for the new object's instance variables.</font></td></tr>

<tr valign=top>

<td width=105 height=10></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Each method must initialize the new object.&nbsp; Methods with more arguments let you do much of the initialization yourself; methods with fewer arguments must supply default values of their own.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">In the Application Kit, methods with fewer arguments work by passing default values to the method with the greatest number of arguments.&nbsp; For its part, the method with the greatest number of arguments maintains the class link to Object's <b>new</b> method.&nbsp; Through a message to <b>super</b>, it performs a class method defined somewhere farther up the inheritance hierarchy; that class method sends its own message to <b>super</b> to perform a method it inherits, and so on. This chain of messages eventually leads back to the <b>new</b> method in the Object class.</font>

<p><font face="Times">Suppose, for example, that a Kit class defines three instance-creating methods, <b>new</b>, <b>newArg:</b>, and <b>newArg:arg:</b>.&nbsp; The <b>new</b> method would have the receiving class object perform the <b>newArg:arg:</b> method:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">+ new</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">return( [self newArg:0 arg:&#34;default&#34;] );</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The <b>newArg:</b> method would do the same:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">+ newArg:(int)anInt</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">return( [self newArg:anInt arg:&#34;default&#34;] );</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">The <b>newArg:arg:</b> method, the one with the most arguments, would perform an inherited method:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">+ newArg:(int)anInt arg:(char *)aString</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">self = [super newArg:anInt];</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">[self setMyString:aString];</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">return self;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">These conventions matter when you create an instance of a class or define a subclass.&nbsp; The method with the most arguments is the most efficient and direct way to create an instance; the other methods can lead to initializing and reinitializing the object, first with default values, then with values more appropriate to your application.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Defining a Subclass</b></font>

<p><font face="Times">When you define a subclass of an Application Kit class, it isn't absolutely required that you write your own methods to create instances for it; inherited class methods will create objects belonging to a subclass as well as to the class where they're defined.&nbsp; But you may need your own class methods to initialize objects of the subclass differently so that their instance variables have reasonable values for your program.</font>

<p><font face="Times">If you do define your own instance-creating methods for a Kit subclass, it's important that they follow the Kit conventions.&nbsp; Suppose, for example, that you decide to override the <b>newArg:arg:</b> method illustrated above.&nbsp; If you have your version perform the version of <b>new</b> it inherits,</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">+ newArg:(int)anInt arg:(char *)aString</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">self = [super new];</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">. . .</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">your method will perform the <b>new</b> method and the <b>new</b> method will perform yours, in a never-ending loop.&nbsp; In its message to <b>super</b>, a subclass method should always perform the superclass method with the most arguments.</font>

<p><font face="Times">The convention is simply this:&nbsp; To ensure that Object's <b>new</b> method is performed, one instance-creating method in each class is linked to an instance-creating method defined in a class farther up the inheritance hierarchy.&nbsp; Within each class, it's the method with the greatest number of arguments that maintains this link.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Covering Inherited Methods</b></font>

<p><font face="Times">When you define a subclass, you should guarantee that all the instance-creating methods it inherits produce reasonable objects for the subclass.&nbsp; This may mean overriding the inherited methods to cover them with your own versions.</font>

<p><font face="Times">Two of the example methods illustrated above cover inherited methods:&nbsp; <b>new</b> covers the <b>new</b> method defined in the Object class, and <b>newArg:</b> covers the <b>newArg:</b> method used in <b>newArg:arg:</b>'s message to <b>super</b>.</font>

<p><font face="Times">Covering inherited instance-creating methods makes the class you define more portable to other applications.&nbsp; If you leave an inherited method uncovered, someone else may use it to produce incorrectly initialized instances of your class.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Returning self</b></font>

<p><font face="Times">As illustrated in the preceding section, class methods that create a new instance return the instances they create.</font>

<p><font face="Times">Instance methods, like C functions, can return a variety of different values--<b>int</b>s, <b>float</b>s, pointers to structures, and so on.&nbsp; Those that don't have meaningful return values of their own return <b>self</b> (the object that receives the message). This permits messages to be chained together, avoiding the need for temporary variables for the receiver.&nbsp; This single line of code,</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[[[ButtonCell newTextCell] setTitle:&#34;Keep&#34;] setType:NX_SWITCH];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">can substitute for these four:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; theCell;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">theCell = [ButtonCell newTextCell];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[theCell setTitle:&#34;Keep&#34;];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">[theCell setType:NX_SWITCH];</font>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Tags</b></font>

<p><font face="Times">Since object <b>id</b>s are determined only at run time, it's sometimes convenient to assign objects integer tags that can be used to identify them at compile time.&nbsp; Views and Cells are prime candidates for tag identifiers, since an application is likely to have many of them.&nbsp; In the Application Kit, the Control and Text subclasses of View define a <b>tag</b> instance variable for their instances, as does the ActionCell class.</font>

<p><font face="Times">The <b>tag</b> method returns the receiver's tag:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">int&nbsp; which;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">which = [myView tag];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">All Views can respond to a <b>tag</b> message.&nbsp; If a subclass doesn't implement its own method, it inherits the version defined in View, which always returns</font> <img src="../../Images/c2D.gif" width=8 height=4><font face="Times">1.</font>

<p><font face="Times">You'd use the <b>tag</b> method when you know the <b>id</b> of an object, but not its tag.&nbsp; It's also possible to find a View's <b>id</b> from its tag.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">id&nbsp; theView;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">theView = [self findViewWithTag:41];</font>



<p><br><br><br><br><br><br><br>

</body>
</html>
