<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/DevTools/08_MallocDebug/MallocDebug.rtfd -->
<!-- Date: Sun Jun 28 19:50:56 1998 -->
<head>
<title>MallocDebug</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+3" color="#FF00FF"><b>8</b></font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+3"><i>The MallocDebug Application</i></font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F0.gif" width=65 height=65></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The Malloc Debugger&nbsp; measures the dynamic memory usage of applications.&nbsp; You can use it to measure all allocated memory in an application, or to measure the memory allocated since a given point in time.&nbsp; The Malloc Debugger also provides a garbage detector that you can use to detect memory leaks.</font>

<p><font face="Times">The Malloc Debugger actually consists of two components:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">A library containing a version of <b>malloc</b> that gathers statistics on memory use</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The MallocDebug application, which you use to examine those statistics</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Preparing Your Application</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Before using the Malloc Debugger, you must first link your application with a library containing a special version of <b>malloc</b> that can communicate with the MallocDebug application.&nbsp; To do this, link with the library <b>/usr/lib/libMallocDebug.a</b> using the linker option <b>-lMallocDebug</b>.&nbsp; The <b>-lMallocDebug</b> option must be placed before the <b>-lsys_s</b> option to ensure that <b>malloc</b> is overridden properly.&nbsp; If your application is built with Interface Builder, you can simply add <b>/usr/lib/libMallocDebug.a</b> to the &quot;Other libs&quot; section of the Project Inspector.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Using MallocDebug</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F1.gif" width=298 height=428></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">To use the Malloc Debugger, you must first select an application to monitor.&nbsp; Choose the Open command in the Application menu to bring up the Select panel.&nbsp; Only <i>currently running</i> applications that have been configured for use with MallocDebug appear in the panel.&nbsp; Once you select an application by double-clicking its icon, MallocDebug opens an application panel for the selected application.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F2.gif" width=468 height=510></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The name of the application and the process number appear in the title bar of the application panel.&nbsp; Initially, the panel is empty.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F3.gif" width=81 height=25></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Click the All button to display a list of all currently allocated nodes in your application.&nbsp; These nodes have been allocated by one of the standard C allocation functions (<b>malloc</b>, <b>realloc</b>, <b>calloc</b>, or <b>valloc</b>) or a NEXTSTEP zone allocation function (<b>NXZoneMalloc</b>, <b>NXZoneRealloc</b>, <b>NXZoneCalloc</b>).&nbsp; As shown in above, each row displays the zone in which the node was allocated, the address and the size of the node, and the function or method that allocated the node.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F4.gif" width=104 height=64></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">You can sort the nodes by caller, by time of allocation, or by zone.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Identifying Damaged Nodes</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">MallocDebug detects nodes that have been written to incorrectly.&nbsp; If your application has written past the end of a node, a right arrow (&gt;) appears by the node.&nbsp; Similarly, if your application has written before the start of a node, a left arrow (&lt;) appears by the node.&nbsp; Many of these errors are caused by giving <b>malloc</b>() the result of <b>strlen(</b>s<b>)</b> as the argument for a string instead of <b>strlen(</b>s<b>) + 1</b>.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">Damaged nodes are always listed first, regardless of the sorting mode.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Finding Memory Leaks</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">MallocDebug contains a conservative garbage detector, which is useful in finding memory leaks.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F5.gif" width=81 height=25></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">When you click the Leaks button, MallocDebug searches through your program's memory for pointers to each node.&nbsp; Any node that can't be referenced is displayed as a memory leak.</font>

<p><font face="Times">Since the garbage detector doesn't know which words in memory are pointers, it's possible that an integer has the same value as a pointer to a given node.&nbsp; In this case, the node doesn't show up as a leak even though it really is (this is why the garbage detector is called conservative).&nbsp; In practice, this problem is very rare.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">The garbage detector only searches for references to the beginning of each node.&nbsp; If your program doesn't retain a pointer to the start of a node, but instead retains a pointer into the middle of it, that node will show up as a leak even though it really isn't one.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Measuring Memory Usage</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">You can use MallocDebug to determine the memory usage of a given portion of your program.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F6.gif" width=81 height=25></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">To begin measuring, click the Mark button.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F7.gif" width=81 height=25></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">After exercising a portion of your program, click the New button to see the nodes allocated since the mark.&nbsp; MallocDebug always shows you the nodes that are still currently allocated, so you will see only those nodes allocated since the mark that haven't been freed.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>MallocDebug Command Reference</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">This section describes the application-specific menus and commands available in MallocDebug.&nbsp; For descriptions of standard menus and commands, see the <i>User's Guide</i>.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Commands in the Main Menu</b></font>

<p><font face="Times">MallocDebug's main menu contains the standard Info, Edit, Windows, Services, Hide, and Quit commands.&nbsp; The Application command displays the Application menu described in the following section.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Commands in the Application Menu</b></font>

<p><font face="Times">The Application menu contains the following commands for opening and closing applications:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Command</b></font></td>

<td><font face="Helvetica"><b>Effect</b></font></td></tr>

<tr valign=top>

<td width=124 height=4></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Open</font></td>

<td><font face="Times">Displays the Select panel, from which you select and open a running application.&nbsp; See &quot;Using MallocDebug&quot; for a description of this panel.</font></td></tr>

<tr valign=top>

<td width=124 height=12></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Close</font></td>

<td><font face="Times">Closes the Application panel for the selected application.&nbsp; The debugged application remains running.</font></td></tr>

</table>



<p>

</body>
</html>
