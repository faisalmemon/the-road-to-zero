<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/DevTools/18_CustomPalette/CustomPalette.rtfd -->
<!-- Date: Sun Jun 28 19:51:47 1998 -->
<head>
<title>CustomPalette</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+3" color="#FF00FF"><b>18</b></font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+3"><i>Building a Custom Palette</i></font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">As you've seen, Interface Builder gives you convenient access to objects defined in the Application Kit:&nbsp; You can drag objects directly from the Palettes window into your application.&nbsp; Through <i>custom palettes</i>, Interface Builder lets you extend this pattern of access to classes of your own design.</font>

<p><font face="Times">A custom palette is a display that can be added to Interface Builder's Palettes window.&nbsp; Each custom palette is represented by its own button at the top of the Palettes window.&nbsp; When the button is clicked, the palette's object or objects appear in the lower portion of the window.&nbsp; Custom palettes can contain subclasses of:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Class</b></font></td>

<td><font face="Helvetica"><b>Comment</b></font></td></tr>

<tr valign=top>

<td width=124 height=4></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">View</font></td>

<td><font face="Times">Must be dragged into a window</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Object</font></td>

<td><font face="Times">Must be dragged to the File window</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Window</font></td>

<td><font face="Times">Can be dragged and dropped anywhere</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">MenuCell</font></td>

<td><font face="Times">Must be dragged into a menu</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">You can manipulate these objects just as you would the objects on the standard palettes.&nbsp; They can be dragged into the application under construction, resized and relocated through direct mouse actions (if they are View or Window objects), and inspected using the Inspector panel.&nbsp; When Interface Builder is put in test mode, objects from custom palettes are fully functional.&nbsp; For example, View objects draw themselves and react to mouse events just as they would in a real application. (This is in contrast to CustomViews, as described in more detail later in this project.)</font>

<p><font face="Times">Custom palettes let you tailor your development environment to suit your needs.&nbsp; They also provide a convenient way to distribute classes to other developers.&nbsp; It's important to note, however, that only classes that meet the following criteria are good candidates for custom palettes.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The class should be designed for reusability.&nbsp; That is, it should be easily adapted for use in a wide range of applications.&nbsp; An object that must be the delegate of the Application object, for example, will be difficult to accommodate in many applications.</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The class should define objects that are useful in a variety of applications.&nbsp; There's little advantage in creating a custom palette for an object that will be used infrequently.</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The class should be thoroughly debugged.&nbsp; The best approach to creating a custom palette for a new class is to first debug the class by building test applications and then, when it's debugged, build the custom palette.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">This project first describes how to create a simple custom palette and then shows you how to add an inspector for the custom object that the palette contains.&nbsp; Before starting, let's look at how custom palettes fit into the overall structure of Interface Builder.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Custom Palettes and Interface Builder</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The previous projects have demonstrated that you build a NEXTSTEP application by designing its interface, defining your own classes as needed, connecting the components, and then compiling the application.&nbsp; This creates an application that consists of executable code and archived data.&nbsp; At run time, some objects are instantiated directly (such as the Application object) and others are unarchived from nib files.</font>

<p><font face="Times">Interface Builder is no different in the way it is constructed.&nbsp; For example, the first time you click the Scrolling Views button in the Palettes window, Interface Builder loads a bundle containing executable code and archived data for the appropriate objects and displays these objects in the Palettes window.&nbsp; (For information on bundles, see the class specification for NXBundle, a common class.)</font>

<p><font face="Times">Adding a new palette to the Palettes window, then, involves creating a type of bundle that Interface Builder can load into itself at run time.&nbsp; This bundle is called a <i>palette file</i> and has a &quot;.palette&quot; extension.&nbsp; Palette files contain archived versions of the objects to be displayed in the Palette window and compiled code to support these objects.&nbsp; A palette file can also contain archived data and object modules for the Inspector associated with a custom palette object.</font>

<p><font face="Times">Custom palettes are loaded into Interface Builder dynamically.&nbsp; That is, when a user chooses the Load Palette command from the Tools menu and specifies a palette file, Interface Builder opens the palette file, loads the object modules it contains and then unarchives the objects that will appear in the Palette window.&nbsp; Thereafter, the classes of these custom objects are known to Interface Builder:&nbsp; Their names appear in the proper places in the Classes window, their outlets and actions appear in the Connections Inspector, and Interface Builder can create new objects of these classes as needed.&nbsp; Using Interface Builder's Preferences panel you can have one or more custom palettes loaded automatically whenever Interface Builder is launched.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>The Custom Object's Design</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The palette we'll create in this project contains a single custom object, a ProgressView.&nbsp; A ProgressView reflects the progress of a long-running operation by filling with dark gray an ever increasing proportion of its horizontal extent:</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F0.gif" width=210 height=82></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica"><b>Figure 18-1</b></font><font face="Times">.&nbsp; ProgressView, Box, and TextField Objects</font>

<p><br><br>

<p><font face="Times">You could use such an object to inform the user of the status of a long-running calculation, file operation, or other process.&nbsp; A ProgressView responds to an <b>increment:</b> message by increasing the length of the gray bar a predetermined amount.&nbsp; We'll take a closer look at the implementation of the ProgressView class after creating the interface for the custom palette.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Creating the Interface</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The primary component of a custom palette project is a nib file.&nbsp; This file contains the archived object (or objects) that will appear in the palette and a TIFF image that will be used for the button at the top of the Palettes window.</font>

<p><font face="Times">To begin the palette project, start Project Builder and, from the Project menu, choose New.&nbsp; In the panel that appears, drag to Palette in the Project Type pop-up list.&nbsp; Give the project the name &quot;ProgressPalette&quot; and save it in your home directory.&nbsp; The Project window for this project appears.</font>

<p><font face="Times">If you browse the Files display of the Project window, you'll find that Project Builder has added these files:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>File</b></font></td>

<td><font face="Helvetica"><b>Description</b></font></td></tr>

<tr valign=top>

<td width=124 height=4></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">ProgressPalette.[hm]</font></td>

<td><font face="Times">Subclass of IBPalette (which is declared in <b>/NextDeveloper/Headers/Apps</b>).&nbsp; For palettes that contain only View objects, nothing must be done to these files.&nbsp; For other types of palettes, one or more methods must be implemented.</font></td></tr>

<tr valign=top>

<td width=124 height=12></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">ProgressPalette.nib</font></td>

<td><font face="Times">Interface archive for the palette project.&nbsp; You'll use Interface Builder to modify this template file by adding the objects that will be part of your palette.</font></td></tr>

<tr valign=top>

<td width=124 height=12></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">palette.table</font></td>

<td><font face="Times">Loading instructions for Interface Builder.&nbsp; This file becomes part of the palette file package.&nbsp; It tells Interface Builder which icon to display for the palette and which classes to add to the Classes display of the File window, among other things.</font></td></tr>

<tr valign=top>

<td width=124 height=12></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Makefile</font></td>

<td><font face="Times">Standard makefile for palette projects.&nbsp; Project Builder maintains this file; you shouldn't change its contents directly.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Double-click the <b>ProgressPalette.nib</b> entry.&nbsp; Interface Builder starts and displays the contents of this template file:&nbsp; a File's Owner object, the first responder, and a window titled &quot;Palette View&quot;.&nbsp; Using Interface Builder's Inspector window, you can verify that the File's Owner object in the File window is an object of the ProgressPalette class.&nbsp; If you switch to the Connections display, you'll see that the <b>originalWindow</b> outlet, which the File's Owner inherits from its parent class, is already attached to the panel.&nbsp; When Interface Builder loads a palette file, it uses this connection to find the View objects that it must extract from the nib file and position within the Palette window.</font>

<p><font face="Times">The next step is to put a ProgressView object in this panel; however, at this point the ProgressView class is unknown to Interface Builder.&nbsp; Interface Builder provides a generic View, the CustomView object, for these situations.&nbsp; A CustomView object records the location, width, height, and class of a View of your own design.&nbsp; At run time, when objects are unarchived from the nib file, an object of the class you specified is created in place of the CustomView.&nbsp; The View that's created is positioned and resized to match the position and dimensions of the CustomView in the nib file, and its <b>drawSelf::</b> method is invoked to cause it to display itself.</font>

<p><font face="Times">Drag a CustomView (from the Basic Views palette) into the panel and resize it to look like this:</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F1.gif" width=268 height=182></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica"><b>Figure 18-2</b></font><font face="Times">.&nbsp; Building the Custom Palette</font>

<p><br><br>

<p><font face="Times">Now add a label to this CustomView by dragging a TextField titled &quot;Title&quot; from the Palette window into the panel.&nbsp; Change the TextField to read &quot;0%&quot; and use the Font panel to decrease the font size.&nbsp; Make a second label by copying and pasting the one you've just created and then change the title to read &quot;100%&quot;.&nbsp; Position these titles at opposite ends of the CustomView.&nbsp; Finally, create a box around the CustomView and the titles by selecting the three objects and choosing the Group command from the Layout menu.&nbsp; Change the title of the box to read &quot;ProgressView&quot;.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Defining the ProgressView Class</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The next step is to reassign the class of the CustomView to the as-yet-unwritten ProgressView class.&nbsp; To do this, you must first use the Classes display of the File window to define the ProgressView class.</font>

<p><font face="Times">Switch to the Classes display and select View in the class hierarchy.&nbsp; Create a subclass of View by dragging to Subclass in the Operations pull-down list.&nbsp; A new class titled &quot;MyView&quot; appears in the hierarchy.&nbsp; Using the Class inspector, change the name of this class to &quot;ProgressView&quot; and press Return.</font>

<p><font face="Times">A ProgressView responds to a single action method:&nbsp; <b>increment:</b>.&nbsp; Using the Class inspector, add this method to those listed under the Actions button.</font>

<p><font face="Times">Now, let's create template source files for the ProgressView class.&nbsp; Drag to Unparse in the Operations pull-down list in the File window.&nbsp; In the first panel that appears, confirm that you want to create <b>ProgressView.h</b> and <b>ProgressView.m</b>.&nbsp; In the second panel, confirm that you want these files added to the project.&nbsp; We'll fill in these template files later.</font>

<p><font face="Times">Finally, reassign the class of the CustomView in the panel.&nbsp; Select the CustomView.&nbsp; Note that the CustomView is grouped within a Box object (that is, it's within the Box's view hierarchy).&nbsp; Clicking the box selects the Box object.&nbsp; To move the focus of selection to the objects inside the box, double-click within the box.&nbsp; Now select the CustomView by clicking it.&nbsp; Using the Attributes display of the CustomView Inspector, locate ProgressView in the list of classes it contains.&nbsp; Click this entry, and the label in the CustomView changes to &quot;ProgressView&quot;.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Providing An Image for the Palette's Button</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The ProgressView custom palette needs an image for its button in the Palettes window.&nbsp; You can either use the IconBuilder application (in <b>/NextDeveloper/Apps</b>) to create a new one, or you can use <b>ProgressPalette.tiff</b>, which you'll find in <b>/NextLibrary/Documentation/NextDev/Examples/IBTutorial/Images</b>.&nbsp; (If you create your own image, make sure it's no larger than 48 by 48 pixels and that its background is transparent.)</font>

<p><font face="Times">Drag the image's file icon from the Workspace Manager File Viewer into Project Builder's Project window.&nbsp; As you drag the icon into the window, a suitcase opens to accept it.&nbsp; When you release the icon, the image is added under Images in the Files display. Now save the project.&nbsp; When the project is saved, Interface Builder is alerted to any changes it contains.&nbsp; Now if you look in the Images display of Interface Builder's File window, you'll see the new image.</font>

<p><font face="Times">The custom palette's interface is complete.&nbsp; The next step is to write the class definition files for the ProgressView class. Before continuing to the next step, save the nib file you've created.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Writing the ProgressView Class Files</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The files that Interface Builder has created for the ProgressView class contain only template code for the <b>increment:</b> action method.&nbsp; You'll have to finish this method's implementation and add the other methods described in this section.&nbsp; (If you're reading an electronic version of this tutorial, you can simply copy the code listed below and paste it into the appropriate ProgressView source file in your project.)</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>ProgressView.h</b></font>

<p><font face="Times">This file declares the interface to the ProgressView class.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#import &lt;appkit/appkit.h&gt;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>#define DEFAULTSTEPSIZE 5</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>#define MAXSIZE 100</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">@interface ProgressView:View</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>int total, count, stepSize;</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>float ratio;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- initFrame:(const NXRect *)frameRect;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- drawSelf:(const NXRect *)rects :(int)rectCount;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- setStepSize:(int)value;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- (int)stepSize;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- setRatio:(float)newRatio;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- increment:sender;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- read:(NXTypedStream*)stream;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- write:(NXTypedStream*)stream;</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">@end</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The file starts by importing the standard header file for the Application Kit.&nbsp; Then, two constants are defined. DEFAULTSTEPSIZE is the value that's added to a running total each time an <b>increment:</b> message is received.&nbsp; MAXSIZE is the maximum length of the bar.</font>

<p><font face="Times">Next, the ProgressView class declares four instance variables:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Variable</b></font></td>

<td><font face="Helvetica"><b>Description</b></font></td></tr>

<tr valign=top>

<td width=124 height=4></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">total</font></td>

<td><font face="Times">Total length of bar; MAXSIZE in this example</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">count</font></td>

<td><font face="Times">Running total; incremented by each <b>increment:</b> message</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">stepSize</font></td>

<td><font face="Times">Amount to add to <b>count</b> upon receiving an <b>increment:</b> message</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">ratio</font></td>

<td><font face="Times">Proportional length of dark gray portion of bar (<b>count</b>/<b>total</b>)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Finally, ProgressView's methods are declared.&nbsp; These methods are discussed in the next section.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>ProgressView.m</b></font>

<p><font face="Times">This file contains the implementation of the methods declared in <b>ProgressView.h</b>.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#import &#34;ProgressView.h&#34;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">@implementation ProgressView</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- initFrame:(const NXRect *)frameRect</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>{</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>[super initFrame:frameRect];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>total = MAXSIZE;</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>stepSize = DEFAULTSTEPSIZE;</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>return self;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>}</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- drawSelf:(const NXRect *)rects :(int)rectCount</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>{</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>PSsetgray(NX_LTGRAY);</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>NXRectFill(&amp;bounds);</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>if (ratio &gt; 0) {</b></font><br>
<img src="../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1"><b>NXRect r = bounds;</b></font><br>
<img src="../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1"><b>r.size.width = bounds.size.width * ratio;</b></font><br>
<img src="../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1"><b>PSsetgray(NX_DKGRAY);</b></font><br>
<img src="../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1"><b>NXRectFill(&amp;r);</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>}</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>PSsetgray(NX_BLACK);</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>NXFrameRect(&amp;bounds);</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>return self;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>}</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- setStepSize:(int)value</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>{</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>stepSize = value;</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>return self;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>}</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- (int)stepSize</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>{</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>return stepSize;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>}</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- setRatio:(float)newRatio</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>{</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>if (newRatio &gt; 1.0) newRatio = 1.0;</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>if (ratio != newRatio) {</b></font><br>
<img src="../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1"><b>ratio = newRatio;</b></font><br>
<img src="../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1"><b>[self display];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>}</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>return self;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>}</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- increment:sender</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>count += stepSize;</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>[self setRatio:(float)count/(float)total];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">return self;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- read:(NXTypedStream*)stream</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>{</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>[super read:stream];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>NXReadTypes(stream, &#34;ii&#34;, &amp;total, &amp;stepSize);</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>return self;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>}</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- write:(NXTypedStream*)stream</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>{</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>[super write:stream];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>NXWriteTypes(stream, &#34;ii&#34;, &amp;total, &amp;stepSize);</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>return self;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>}</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>@end</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times"><b>ProgressView.m</b> starts by importing <b>ProgressView.h</b> for the interface to its own class.&nbsp; The rest of the file contains the implementation of ProgressView's methods:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Method</b></font></td>

<td><font face="Helvetica"><b>Description</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=123></td>

<td nowrap><font face="Times">initFrame:</font></td>

<td><font face="Times">Initializes a newly allocated ProgressView by setting the values of its <b>total</b> and <b>stepSize</b> variables.&nbsp; Its <b>count</b> and <b>ratio</b> instance variables are automatically initialized to 0.</font></td></tr>

<tr valign=top>

<td width=123 height=12></td></tr>

<tr valign=top>

<td width=123></td>

<td nowrap><font face="Times">drawSelf::</font></td>

<td><font face="Times">Draws the ProgressView by first filling its entire bounds rectangle with light gray, determining which portion of the bounds should be filled with dark gray and painting that portion, and finally drawing a black border around the entire ProgressView.</font></td></tr>

<tr valign=top>

<td width=123 height=12></td></tr>

<tr valign=top>

<td width=123></td>

<td nowrap><font face="Times">setStepSize:</font></td>

<td><font face="Times">Sets the amount to be added to <b>count</b> when the ProgressView receives an <b>increment:</b> message.&nbsp; (This method will be used in the next project.)</font></td></tr>

<tr valign=top>

<td width=123 height=12></td></tr>

<tr valign=top>

<td width=123></td>

<td nowrap><font face="Times">stepSize:</font></td>

<td><font face="Times">Returns the amount to be added to <b>count</b> when the ProgressView receives an <b>increment:</b> message.&nbsp; (This method will be used in the next project.)</font></td></tr>

<tr valign=top>

<td width=123 height=12></td></tr>

<tr valign=top>

<td width=123></td>

<td nowrap><font face="Times">setRatio:</font></td>

<td><font face="Times">Sets the <b>ratio</b> variable and then redisplays the ProgressView (thus causing the <b>drawSelf::</b> method to be invoked).</font></td></tr>

<tr valign=top>

<td width=123 height=12></td></tr>

<tr valign=top>

<td width=123></td>

<td nowrap><font face="Times">increment:</font></td>

<td><font face="Times">Increases the value of the <b>count</b> variable by adding <b>stepSize</b> to it.&nbsp; This method then invokes the <b>setRatio: </b>method, using the ratio of <b>count</b> to <b>total</b> as the argument.</font></td></tr>

<tr valign=top>

<td width=123 height=12></td></tr>

<tr valign=top>

<td width=123></td>

<td nowrap><font face="Times">read:</font></td>

<td><font face="Times">Reads the archived values of the <b>total</b> and <b>stepSize</b> variables from a typed stream.</font></td></tr>

<tr valign=top>

<td width=123 height=12></td></tr>

<tr valign=top>

<td width=123></td>

<td nowrap><font face="Times">write:</font></td>

<td><font face="Times">Writes the values of the <b>total</b> and <b>stepSize</b> variables to a typed stream.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">At a minimum, a custom palette object must be able to draw, archive, and unarchive itself; thus, the <b>drawSelf::</b>, <b>write:</b>, and <b>read:</b> methods above.&nbsp; The other methods are peculiar to the ProgressView class and aren't required by all custom palette objects.</font>

<p><font face="Times">The <b>drawSelf::</b> method is invoked when the palette is first loaded, to draw the ProgressView in the Palettes window.&nbsp; It's also invoked when you put Interface Builder in test mode and there's a ProgressView object in your application's window.&nbsp; Of course, when an application that contains a ProgressView is run, <b>drawSelf::</b> is invoked whenever the ProgressView needs to draw itself, such as after it receives an <b>increment:</b> message.</font>

<p><font face="Times">The <b>read:</b> and <b>write:</b> methods are needed so that the ProgressView can be archived.&nbsp; When you create the custom palette, the ProgressView object must archive itself into the palette file.&nbsp; When the custom palette is loaded into Interface Builder, the ProgressView is unarchived from the palette file.</font>

<p><font face="Times">The process of unarchiving involves allocating enough memory for the object and then sending it a <b>read:</b> message so that it can initialize its variables from the values stored in the archive.&nbsp; In unarchiving, the <b>initFrame:</b> method, which would normally establish the values of the <b>total</b> and <b>stepSize</b> variables, isn't invoked.&nbsp; Thus, the <b>read:</b> method must establish those values.&nbsp; The matching <b>write:</b> method records the values of <b>total</b> and <b>stepSize</b> in the archive file when the palette is created.&nbsp; Without these methods, a newly unarchived ProgressView would have 0 as the values of <b>total</b> and <b>stepSize</b>.&nbsp; Whenever you create a class that you intend to use in a custom palette, remember to implement <b>read:</b> and <b>write:</b> methods to archive the variables whose values you want to store along with the object.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Updating the palette.table File</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Before you can compile the palette project, you must update the <b>palette.table</b> file.&nbsp; Interface Builder consults this table when it loads a palette file.&nbsp; It uses the information from the table to identify and instantiate the nib file's owner, to display the proper image for the button in the Palette window, and to insert class names within the Classes display of the File window, among other things.</font>

<p><font face="Times">Locate <b>palette.table</b> under Other Resources in Project Builder's Project window.&nbsp; Double-click the entry to reveal the file's contents:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">Class = ProgressPalette;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* (a subclass of IBPalette) */</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NibFile = ProgressPalette;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* (a nib file name) */</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* Icon =;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (a tiff/eps file name) */</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* ExportClasses = ();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (a list of class names) */</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* ExportImages = ();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (a list of icon names) */</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* ExportSounds = ();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (a list of sound names) */</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The first two lines identify the names of the class of the nib file's owner and of the nib file itself.&nbsp; The remaining lines can be used to identify other elements of the palette file.&nbsp; For this project, you need to specify the name of the image to be used for the Palette window button and to specify the name of the class, ProgressView, that should be added to the Classes browser.&nbsp; Make the changes that appear in bold below:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">Class = ProgressPalette;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* (a subclass of IBPalette) */</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NibFile = ProgressPalette;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* (a nib file name) */</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">Icon = ProgressPalette;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /* (a tiff/eps file name) */</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">ExportClasses = (ProgressView);&nbsp; /* (a list of class names) */</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* ExportImages = ();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (a list of icon names) */</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* ExportSounds = ();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (a list of sound names) */</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">After you've made these changes, save and close <b>palette.table</b>.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Compiling and Loading the Palette</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">You're now ready to compile the custom palette.&nbsp; Switch to Project Builder's Builder display and click the Build button.&nbsp; When the process is finished, a file with the name <b>ProgressPalette.palette</b> is added to the project directory.</font>

<p><font face="Times">To load the custom palette, choose Interface Builder's Load Palette command from its Tools menu.&nbsp; In the Open panel that appears, select that palette file and click OK.&nbsp; After a moment, Interface Builder's Palette window is updated to show the new palette.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F2.gif" width=274 height=276></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica"><b>Figure 18-3</b></font><font face="Times">.&nbsp; ProgressView Custom Palette</font>

<p><br><br>

<p><font face="Times">Notice that a horizontal scroller appears to give you access to palette buttons that no longer fit within the Palettes window.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Testing the Palette</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Now that a ProgressView is available from within Interface Builder, it's easy to test its operation.&nbsp; Close the palette project by closing the Project window for the ProgressPalette project.&nbsp; Now, start a new project by choosing New in Project Builder's Project menu.&nbsp; In the panel that appears, name the project &quot;Test&quot; and make sure the Project Type button reads &quot;Application&quot;. Finally, open the nib file.</font>

<p><font face="Times">In Interface Builder, drag a ProgressView object from the Palettes window into the application's window.&nbsp; To test the ProgressView's operation, you have to send it <b>increment:</b> action messages.&nbsp; Add a button to the window and change its title to &quot;Increment&quot;.&nbsp; Control-drag a connection from the button to the ProgressView.&nbsp; (Make sure the connection is made to the ProgressView and not to the Box that surrounds it--check the Connections list in the Connections Inspector to confirm the identity of the destination object.)&nbsp; Using the Connections Inspector, specify that the Button sends an <b>increment:</b> message to the ProgressView.</font>

<p><font face="Times">Finally, test the ProgressView by putting Interface Builder in test mode and clicking the Increment button.&nbsp; The gray bar should step across the ProgressView with each click.&nbsp; If nothing happens, quit the test mode, recheck the connection between the button and the ProgressView, and try again.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Using Custom Palette Objects in Other Applications</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Building an application using a custom palette object is in most respects identical to building one using the standard objects that are available within Interface Builder; the few differences are described here.</font>

<p><font face="Times">You've demonstrated that the ProgressView custom object works within Interface Builder's test mode.&nbsp; However, if you compile the new application and attempt to run it, this error appears in the Workspace Manager Console window:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">&gt; objc: class `ProgressView' not linked into application</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">&gt; An uncaught exception was raised</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">&gt; Typed streams library error: class error for 'ProgressView': class not loaded</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The problem is that although the application's nib file contains an archived ProgressView object, the ProgressView class hasn't been linked into the application.&nbsp; Thus, none of the ProgressView's methods can be invoked.</font>

<p><font face="Times">There are several ways to ensure that the ProgressView class is linked into an application.&nbsp; The easiest is to add the ProgressView class files (<b>ProgressView.h</b> and <b>ProgressView.m</b>) to the list of class files in Project Builder's Files window.&nbsp; For your own applications, this is a reasonable solution.&nbsp; If, however, you don't want to distribute source code along with the custom palettes you develop, you can either distribute object files (in this case, <b>ProgressView.o</b>) or a library containing object modules for your custom classes.&nbsp; The object files or library can be added to the appropriate list in Project Builder.</font>

<p><font face="Times">Another consideration when developing applications using custom palettes concerns the editing of nib files.&nbsp; If you create a nib file that contains a custom palette object, that interface file can be opened only by a similarly configured Interface Builder application.&nbsp; In other words, if the nib file contains a ProgressView, then you will have to load the ProgressView palette before you'll be able to open the nib file.&nbsp; As normally configured, Interface Builder won't have access to the class information for the custom object.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Adding a ProgressView Inspector</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">A palette file can provide Attribute, Connection, Size, and Help inspectors for the custom objects it contains.&nbsp; (Custom Connection and Help inspectors are rarely needed, however.)&nbsp;&nbsp;&nbsp; For example, when a user attempts to display the Attributes inspector associated with the custom object (say, by selecting the object and choosing Inspector from the Tools menu), Interface Builder loads the inspector and uses it as the Attributes display of the Inspector window.&nbsp; For example, an Attributes Inspector for the ProgressView class might look like this:</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F3.gif" width=274 height=424></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica"><b>Figure 18-4</b></font><font face="Times">.&nbsp; ProgressView Inspector</font>

<p><br><br>

<p><font face="Times">An Attributes Inspector typically lets a user set an object's characteristics that can't be set through direct mouse manipulation. For example, the ProgressView Inspector pictured above lets the user adjust a ProgressView's <b>stepSize</b> variable, thus determining the amount the dark gray bar advances across the ProgressView with each <b>increment:</b> message.</font>

<p><font face="Times">Inspectors can have OK and Revert buttons, although they aren't required.&nbsp; If the user adjusts the controls in an inspector and then clicks Revert, the changes are discarded and the previous values are reestablished; if the user clicks OK, the new values are sent to the object that's being inspected.</font>

<p><font face="Times">Interface Builder identifies the appropriate inspector to display for a selected object by sending the object one of these messages, depending on the setting of the pop-up list in the Inspector window:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">getInspectorClassName</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">getConnectInspectorClassName</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">getSizeInspectorClassName</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">getHelpInspectorClassName</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The <b>getInspectorClassName</b> message is sent to determine the name of the class of the Attributes inspector.&nbsp; For example, the ProgressView class could implement this method this way:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- (const char *)getInspectorClassName</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">return &#34;ProgressViewInspector&#34;;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Since each custom object can identify its inspector, a custom palette file can contain multiple classes of objects, each with its own inspector.</font>

<p><font face="Times">Another benefit of this system of identifying an object's inspector is that inspectors are inherited.&nbsp; Interface Builder provides inspectors for each of the classes represented in the Palettes window.&nbsp; If you create a subclass of one of these classes and don't implement the <b>inspectorName:</b> method, Interface Builder will display the superclass's inspector whenever the custom object is inspected.</font>

<p><font face="Times">For debugging purposes, it's often better to create the inspector for an object only after the object itself has been debugged and placed in a custom palette.&nbsp; This is the approach we take in this project.&nbsp; Now that ProgressView objects are available through a custom palette, we'll create a simple inspector for the ProgressView class.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Designing the ProgressView Inspector</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Creating an inspector for a custom palette object is much like creating the custom palette itself.&nbsp; You start by assembling an interface for the custom object inspector.&nbsp; The owner of this nib file is an object you define that translates actions taken on this interface into messages to send to the object that's being inspected.&nbsp; The class files for the owner object and the inspector's nib file are added to the palette project and compiled into the palette file along with the custom palette object.&nbsp; Let's start by assembling the inspector's user interface.</font>

<p><font face="Times">Interface Builder provides a New Inspector command for our purposes.&nbsp; Choose the New Module command in the Document menu and, in the menu that appears, choose New Inspector.&nbsp; A new File window and a panel titled &quot;Inspector&quot; appear.</font>

<p><font face="Times">Now, let's add some objects to the panel.&nbsp; Drag a horizontal slider into the panel and then add labels for each end (as in Figure 18-4 above).&nbsp; Edit the left label to read &quot;0&quot; and the right one &quot;10&quot;.&nbsp; Calibrate the slider to these values by using the Slider Inspector to set its minimum value to 0 and the maximum value to 10.&nbsp; Set the current value to 5 and press Return.</font>

<p><font face="Times">Add an editable text field above the center of the slider.&nbsp; This text field will read out the slider's current setting.&nbsp; Resize the text field to accommodate two-digit numbers and then edit its contents to read &quot;5&quot;.&nbsp; Using the Alignment group of buttons in the TextField Inspector, specify that the TextField's display is right aligned:</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F4.gif" width=101 height=57></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica"><b>Figure 18-5</b></font><font face="Times">.&nbsp; Setting the Alignment of the TextField</font>

<p><br><br>

<p><font face="Times">Finally, select all the objects in the panel and choose the Group command from the Layout menu (a submenu of the Format menu) to surround them in a box.&nbsp; Edit the box's title to read &quot;Step Size&quot;.</font>

<p><font face="Times">The interface to the ProgressView inspector is complete.&nbsp; Save the interface in a file called <b>ProgressViewInspector.nib</b>--the Open panel will suggest saving the nib file in the proper language directory of the ProgressPalette project--and, when the attention panel appears, confirm that you want the file added to the project.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Designing the ProgressViewInspector Class</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The interface that you just created will act on a selected object through the intervention of a ProgressViewInspector object, which we will now define.</font>

<p><font face="Times">Inspectors inherit from Interface Builder's IBInspector class, a subclass of Object.&nbsp; (See <b>/NextDeveloper/Headers/apps/InterfaceBuilder.h</b> for the class interface to the IBInspector class.)&nbsp; The IBInspector class has these important outlets:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Outlet</b></font></td>

<td><font face="Helvetica"><b>Description</b></font></td></tr>

<tr valign=top>

<td width=124 height=4></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">object</font></td>

<td><font face="Times"><b>id</b> of the object that's being inspected</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">window</font></td>

<td><font face="Times"><b>id</b> of the Panel that contains the inspector's user interface</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">okButton</font></td>

<td><font face="Times"><b>id</b> of the OK button, if present</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">revertButton</font></td>

<td><font face="Times"><b>id</b> of the Revert button, if present</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The IBInspector class adopts the IBInspectors protocol, which declares these methods:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Method</b></font></td>

<td><font face="Helvetica"><b>Description</b></font></td></tr>

<tr valign=top>

<td width=124 height=4></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">ok:</font></td>

<td><font face="Times">Sets the inspected object to reflect the user's choices in the Inspector panel.</font></td></tr>

<tr valign=top>

<td width=124 height=12></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">revert:</font></td>

<td><font face="Times">Cancels any pending changes to the inspected object.&nbsp; This method is also invoked when the Inspector is first instantiated.</font></td></tr>

<tr valign=top>

<td width=124 height=12></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">wantsButtons:</font></td>

<td><font face="Times">Invoked by Interface Builder to determine if OK and Revert buttons should be displayed for this inspector.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Let's create a subclass of IBInspector for our inspector.&nbsp; The IBInspector class is listed under Object in Interface Builder's Classes browser.&nbsp; Select this entry and drag to Subclass in the Operations pull-down list.&nbsp; In the Class inspector, rename this new class &quot;ProgressViewInspector&quot;.&nbsp; Note that the Class Inspector reports that the ProgressViewInspector class inherits the <b>window</b> outlet and <b>ok:</b> and <b>revert:</b> methods of its superclass.&nbsp; A ProgressViewInspector needs two more outlets, which it will use to communicate with the slider and text field in its user interface.&nbsp; Add these outlets and name them <b>theSlider</b> and <b>theTextField</b>.</font>

<p><font face="Times">Now, create template source files for the ProgressViewInspector class.&nbsp; Drag to Unparse in the Operations pull-down list of the Classes display.&nbsp; In the first panel that appears, confirm that you want to create <b>ProgressViewInspector.h</b> and <b>ProgressViewInspector.m</b>.&nbsp; In the second panel, confirm that you want to add these files to the project.&nbsp; We'll fill in these template files later.</font>

<p><font face="Times">Next, reassign the class of the File's Owner object to the ProgressViewInspector class.&nbsp; Select the File's Owner object in the Objects display of the File window.&nbsp; In the File's Owner Inspector panel, select ProgressViewInspector.&nbsp; Finally, save the nib file.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Connecting the Objects</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The File's Owner, a ProgressViewInspector, must be connected to its user interface objects.&nbsp; Control-drag a connection from the File's Owner to the Slider and connect the two using the <b>theSlider</b> outlet.&nbsp; Similarly, connect the File's Owner to the TextField using the <b>theTextField</b> outlet.&nbsp; Notice that Interface Builder has already connected the File's Owner and the inspector panel using the <b>window</b> outlet.&nbsp; All inspectors are connected to their user interfaces through this outlet.</font>

<p><font face="Times">The Slider and the TextField must also be connected to the File's Owner so that actions taken on these controls are reflected in the object being inspected.&nbsp; Control-drag a connection from the Slider to the File's Owner, and using the Connections inspector, make the File's Owner the target of an <b>ok:</b> message from the Slider.&nbsp; Similarly, make the TextField send an <b>ok:</b> message to its target, the File's Owner.</font>

<p><font face="Times">These are the only connections you need to make.&nbsp; When the inspector is being used in Interface Builder, its <b>object</b> outlet will be set automatically to the <b>id</b> of the object that's currently being inspected.&nbsp; When the user clicks OK or Revert in an inspector that has these buttons, Interface Builder will send the appropriate message to the ProgressViewInspector object.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Editing the ProgressViewInspector Class Files</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The next step is to fill in the template class files that Interface Builder has added to the project.&nbsp; The finished files are listed here.&nbsp; (If you're reading this on-line, you can copy the listings into the template files in your project.)&nbsp; A description of the files follows each listing.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>ProgressViewInspector.h</b></font>

<p><font face="Times">This file declares the interface to the ProgressViewInspector class.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#import &lt;apps/InterfaceBuilder.h&gt;</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">@interface ProgressViewInspector:IBInspector &lt;IBInspectors&gt;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">id&nbsp;&nbsp;&nbsp; theSlider;</font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">id&nbsp;&nbsp;&nbsp; theTextField;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- init;</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">@end</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The file starts by importing <b>InterfaceBuilder.h</b>, which contains the declaration of the IBInspector class, ProgressViewInspector's superclass.&nbsp; Note that the ProgressViewInspector class adopts the IBInspectors protocol, which declares the <b>ok</b>:, <b>revert:</b> and <b>wantsButtons:</b> methods.</font>

<p><font face="Times">This interface file then declares two instance variables, <b>theSlider</b> and <b>theTextField</b>.&nbsp; These variables correspond to the two outlets that you added using Interface Builder's Class Inspector.&nbsp; Finally, the file declares the <b>init</b> method, which is described in the next section.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>ProgressViewInspector.m</b></font>

<p><font face="Times">This file contains the implementation of the methods declared in <b>ProgressViewInspector.h</b>.</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#import &#34;ProgressViewInspector.h&#34;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>#import &#34;ProgressView.h&#34;</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">@implementation ProgressViewInspector</font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- init</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>{</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>char buf[MAXPATHLEN + 1];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>id bundle;</b></font>

<p><img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>[super init];</b></font>

<p><img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>bundle = [NXBundle bundleForClass:[ProgressView class]];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>[bundle getPath:buf</b></font><br>
<img src="../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1"><b>forResource:&#34;ProgressViewInspector&#34;</b></font><br>
<img src="../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1"><b>ofType:&#34;nib&#34;];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>[NXApp loadNibFile:buf</b></font><br>
<img src="../../Images/sp.gif" width=201 height=1><font face="Courier" size="-1"><b>owner:self</b></font><br>
<img src="../../Images/sp.gif" width=201 height=1><font face="Courier" size="-1"><b>withNames:NO</b></font><br>
<img src="../../Images/sp.gif" width=201 height=1><font face="Courier" size="-1"><b>fromZone:[self zone]];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>return self;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>}</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- ok:sender</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>{</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>if (sender == theSlider) {</b></font><br>
<img src="../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1"><b>[object setStepSize:[theSlider intValue]];</b></font><br>
<img src="../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1"><b>[theTextField setIntValue:[theSlider intValue]];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>}</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>else if (sender == theTextField) {</b></font><br>
<img src="../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1"><b>[object setStepSize:[theTextField intValue]];</b></font><br>
<img src="../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1"><b>[theSlider setIntValue:[theTextField intValue]];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>}</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>return [super ok:sender];</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>}</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- revert:sender</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>{</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>int step;</b></font>

<p><img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>step = [object stepSize];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>[theSlider setIntValue:step];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>[theTextField setIntValue:step];</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>return [super revert:sender];</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>}</b></font>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>- (BOOL)wantsButtons</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>{</b></font><br>
<img src="../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1"><b>return NO;</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><b>}</b></font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">@end</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The <b>init</b> method initializes a newly allocated ProgressViewInspector.&nbsp; As in all <b>init...</b> methods, the chain of initializations is maintained through a message to the superclass (IBInspector) to initialize itself.</font>

<p><font face="Times">Next, the inspector's user interface is loaded from the appropriate nib file; however, since the palette file could be located anywhere, you have to enlist the services of an NXBundle object to find the proper directories to search.&nbsp; The NXBundle object is initialized on the directory that provided the code for the ProgressViewInspector class.&nbsp; Given the user's language preferences, the nib file will be sought in one of its subdirectories (for example, <b>English.lproj</b>, <b>French.lproj</b>, etc.).&nbsp; In contrast, if you were to try to load the nib file by sending a <b>loadNibFile:...</b> message, Interface Builder's file package would be searched for the nib file.&nbsp; (See the NXBundle class specification for more information.)</font>

<p><font face="Times">When the nib file is loaded, the inspector's <b>theSlider</b> and <b>theTextField</b> outlets are automatically initialized to the <b>id</b>'s of the appropriate objects from the nib file.&nbsp; (In addition, the ProgressViewInspector's <b>object</b> outlet is set to the <b>id</b> of the ProgressView that the user has selected.)</font>

<p><font face="Times">The <b>ok:</b> and <b>revert:</b> methods synchronize the values in the inspector panel with each other and with the object being inspected. When a user acts on the slider, for example, an <b>ok:</b> message is sent to the ProgressViewInspector.&nbsp; The inspected object's step size is set to the value of the Slider object, and then the TextField's value is made to match that of the Slider.</font>

<p><font face="Times">The <b>revert:</b> method asks the selected ProgressView for its current step size and then sends messages to the Slider and TextField to reflect this value.&nbsp; The implementation of each method ends by invoking the IBInspector class's implementation of the identical method:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">return [super ok:sender];</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">return [super revert:sender];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">In the <b>ok:</b> and <b>revert:</b> methods of inspector classes you write, remember to invoke the IBInspector class's <b>ok:</b> and <b>revert: </b>methods, as demonstrated here.&nbsp; This is required for the correct operation of inspectors.</font>

<p><font face="Times">Besides being sent when the user clicks Revert, a <b>revert:</b> message is sent to the ProgressViewInspector whenever the user selects a ProgressView and the inspector is open. This lets the inspector update its controls so that they reflect the state of the inspected object.</font>

<p><font face="Times">Interface Builder sends a <b>wantsButtons:</b> message to the ProgressViewInspector to determine if OK and Revert buttons should appear in the Inspector panel.&nbsp; Most Inspectors won't need these buttons; rather, a user's actions in the panel will immediately and visibly change the state of the inspected object, as in this example.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Modifying the ProgressView Class Files</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">As mentioned earlier, Interface Builder identifies the inspector for a selected object by sending the object an <b>inspectorName </b>message.&nbsp; Since you've created an inspector for ProgressView objects, it's time to add this method to the ProgressView class files.</font>

<p><font face="Times">In <b>ProgressView.h</b>, add this declaration:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- (const char *)getInspectorClassName;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">In <b>ProgressView.m</b>, add the implementation of the inspectorName method:</font></td></tr>

</table>

<p><img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- (const char *)getInspectorClassName</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../Images/sp.gif" width=159 height=1><font face="Courier" size="-1">return &#34;ProgressViewInspector&#34;;</font><br>
<img src="../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>Compiling and Testing the Inspector</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">After saving the class and nib files, use Project Builder's Build command to compile the project.&nbsp; When the process is finished, you can load the new palette file, <b>ProgressPalette.palette</b>.&nbsp; (Remember that only one version of a given palette can be loaded at a time.&nbsp; If you already have an older version of the ProgressView palette loaded, you'll have to restart Interface Builder in order to load the new version.)</font>

<p><font face="Times">Once the custom palette is loaded, test its operation by creating a new application that contains a ProgressView and a button, as illustrated here:</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=107></td>

<td><img src="F5.gif" width=270 height=167></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica"><b>Figure 18-6</b></font><font face="Times">.&nbsp; Testing the ProgressView Inspector</font>

<p><br><br>

<p><font face="Times">Use the ProgressView Inspector to set the step size, and then put the application in test mode to test the ProgressView's operation.</font>

<p><font face="Times">If the inspector doesn't appear when you attempt to inspect a ProgressView, recheck the connections in the ProgressViewInspector nib file.&nbsp; (Especially check that the <b>window</b> outlet is connected to the panel that contains the inspector's user interface).</font></td></tr>

</table>



<p>

</body>
</html>
