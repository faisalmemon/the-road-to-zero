<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/OperatingSystem/Part2_WritingLKSs/_ApB_ROM/ROM.rtf -->
<!-- Date: Sun Jun 28 20:10:45 1998 -->
<head>
<title>ROM</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+3" color="#FF00FF"><b>B</b></font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+3"><i>The ROM Monitor and NMI Mini-Monitor</i></font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Most of the commands in the ROM monitor and NMI mini-monitor are discussed in the <i>NeXTSTEP Network and System Administration</i> manual; some other useful commands are covered in Chapter 9 of this book, &quot;Building, Loading, and Debugging Loadable Kernel Servers.&quot;&nbsp; However, a few commands are of interest to only a few hardware or device-driver developers. These rarely used commands are described in this appendix.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>ROM Monitor Commands</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Most ROM monitor commands display the current value of a register or parameter, and prompt for a new value with a question mark.&nbsp; To enter a new value, type the value and press the Return key.&nbsp; To leave the current value unchanged and skip to the next one (if any), just press the Return key.&nbsp; Type a period to exit the command and leave the current value unchanged.</font>

<p><font face="Times">Numeric values are usually in hexadecimal (base 16) notation if they represent a memory address or data value.&nbsp; The <b>R</b> (radix) command can be used to change the input base/radix.</font>

<p><font face="Times">The values of register bit fields are displayed symbolically between angle brackets <b>&lt; &gt;</b> in addition to the numeric value (for example, &quot;2700&lt;trace=0,s,ipl=7&gt;&quot;).&nbsp; For more information on 68040 registers, see Motorola's <i>MC68040 User's Manual</i>.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Open Address Register</b></font>

<p><font face="Times">The command</font>

<p><img src="../../../Images/sp.gif" width=18 height=1><font face="Times"><b>a</b> [<i>n</i>]</font>

<p><font face="Times">accesses the contents of address registers a0 through a7 of the 680x0 processor.</font>

<p><font face="Times">Example:</font></td></tr>

</table>

<p><img src="../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NeXT&gt; <b>a</b></font>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=125></td>

<td><font face="Courier" size="-1">a0: 00001234? <b>5678</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Change a0 from 0x1234 to 0x5678.</font><br>
<font face="Courier" size="-1">a1: 00000000?</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Don't change a1.</font><br>
<font face="Courier" size="-1">a2: 00000001? <b>.</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Type a period to exit.</font></td></tr>

</table>

<p><img src="../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NeXT&gt; <b>a0</b></font>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=125></td>

<td><font face="Courier" size="-1">a0: 00001234? <b>5678</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Change a0 from 0x1234 to 0x5678</font><font face="Times" size="-1">.</font><br>
<font face="Courier" size="-1">NeXT&gt;</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica" size="+1"><b>Open Data Register</b></font>

<p><font face="Times">The command</font>

<p><img src="../../../Images/sp.gif" width=18 height=1><font face="Times"><b>d</b> [<i>n</i>]</font>

<p><font face="Times">accesses the contents of data registers d0 through d7 of the 680x0 processor.</font>

<p><font face="Times">Example:</font></td></tr>

</table>

<p><img src="../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NeXT&gt; <b>d</b></font>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=125></td>

<td><font face="Courier" size="-1">d0: 00001234? <b>5678</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Change d0 from 0x1234 to 0x5678.</font><br>
<font face="Courier" size="-1">d1: 00000000?</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Don't change d1.</font><br>
<font face="Courier" size="-1">d2: 00000001? <b>.</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Type a period to exit.</font></td></tr>

</table>

<p><img src="../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NeXT&gt; <b>d0</b></font>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=125></td>

<td><font face="Courier" size="-1">d0: 00001234? <b>5678</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Change d0 from 0x1234 to 0x5678.</font><br>
<font face="Courier" size="-1">NeXT&gt;</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica" size="+1"><b>Open Processor Register</b></font>

<p><font face="Times">The command</font>

<p><img src="../../../Images/sp.gif" width=18 height=1><font face="Times"><b>r</b> [<i>regname</i>]</font>

<p><font face="Times">accesses the contents of the 680x0 processor registers.&nbsp; Possible values for <i>regname</i> are:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">pc</font></td>

<td><font face="Times">Program counter</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">sr</font></td>

<td><font face="Times">Status register</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">usp</font></td>

<td><font face="Times">User stack pointer</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">isp</font></td>

<td><font face="Times">Interrupt stack pointer</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">msp</font></td>

<td><font face="Times">Master stack pointer</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">vbr</font></td>

<td><font face="Times">Vector base register</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">sfc</font></td>

<td><font face="Times">Source function code</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">dfc</font></td>

<td><font face="Times">Destination function code</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">cacr</font></td>

<td><font face="Times">Cache control register</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">caar</font></td>

<td><font face="Times">Cache address register (68030 only)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">If you don't specify <i>regname</i>, all the processor registers are opened in the order listed above.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Open System Register</b></font>

<p><font face="Times">The command</font>

<p><img src="../../../Images/sp.gif" width=18 height=1><font face="Times"><b>s</b> [<i>systemreg</i>]</font>

<p><font face="Times">accesses the contents of the system registers.&nbsp; Possible values for <i>systemreg</i> are:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">intrstat</font></td>

<td><font face="Times">Interrupt status register</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">intrmask</font></td>

<td><font face="Times">Interrupt mask register</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">scr1</font></td>

<td><font face="Times">System control register #1</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">scr2</font></td>

<td><font face="Times">System control register #2</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">If you don't specify <i>systemreg</i>, all of the system registers are opened in the order they're listed above.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Examine Memory Locations</b></font>

<p><font face="Times">The command</font>

<p><img src="../../../Images/sp.gif" width=18 height=1><font face="Times"><b>e</b> [<i>lwb</i>] [<i>addrlist</i>] [<i>format</i>]</font>

<p><font face="Times">lets you examine particular locations in memory.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=123></td>

<td nowrap><font face="Times">[<i>lwb</i>]</font></td>

<td><font face="Times">Specify <b>l</b>, <b>w</b>, or <b>b</b> to select long, word, or byte length.&nbsp; The default is long.</font></td></tr>

<tr valign=top>

<td width=123 height=12></td></tr>

<tr valign=top>

<td width=123></td>

<td nowrap><font face="Times">[<i>addrlist</i>]</font></td>

<td><font face="Times">This argument specifies the starting address or list of addresses to cyclically examine.&nbsp; If you don't specify a value for <i>addrlist</i>, the command uses the most recent value of <i>addrlist</i>.</font></td></tr>

<tr valign=top>

<td width=123 height=12></td></tr>

<tr valign=top>

<td width=123></td>

<td nowrap><font face="Times">[<i>format</i>]</font></td>

<td><font face="Times">This argument controls how the value is displayed.&nbsp; It can be any of the standard format types supported by the C language <b>printf()</b> library routine.&nbsp; The default, <b>%x</b>, displays a number in hexadecimal.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">To have access to hardware addresses, you must get into the ROM monitor just after the system is powered on, before it has booted.&nbsp; Otherwise, you'll read or write to virtual addresses, not physical addresses.&nbsp; To enter the ROM monitor, do the following:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Helvetica"><b>1.</b></font></td>

<td><font face="Times">If your computer is on, press the Power key to turn it off.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Locate the ~ key on your keyboard.&nbsp; (You'll need to press it along with the Command and left Alternate keys soon after you turn the power back on.)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Helvetica"><b>2.</b></font></td>

<td><font face="Times">Turn the computer back on by pressing the Power key.</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Helvetica"><b>3.</b></font></td>

<td><font face="Times"><i>Within three seconds</i> of the appearance of the message &quot;Loading from disk&quot; or &quot;Loading from network,&quot; hold down the Command and left Alternate keys and press the ~ key.&nbsp; (If you're using a keyboard that has two Command keys, don't hold down the Alternate key; just hold down one of the Command keys and press the ~ key.)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">You should now be in the ROM monitor.&nbsp; You can use the <b>e</b> command to look at addresses on the CPU board.</font>

<p><font face="Times">Example 1:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=125></td>

<td><font face="Courier" size="-1">NeXT&gt; <b>e 4000000</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Examine the long at memory location 0x4000000.</font><br>
<font face="Courier" size="-1">4000000: 0? <b>12345678</b></font>&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">See that its value is 0x0; deposit the value 0x12345678.</font><br>
<font face="Courier" size="-1">4000004: 0? <b>.</b></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Type a period to exit.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Example 2:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=125></td>

<td><font face="Courier" size="-1">NeXT&gt; <b>e 4000000 4000000</b></font>&nbsp; <font face="Times">Repeatedly examine memory location 0x4000000.</font><br>
<font face="Courier" size="-1">4000000: 0? <b>12345678</b></font>&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">See that its value is 0x0; deposit the value 0x12345678.</font><br>
<font face="Courier" size="-1">4000000: 12345678? <b>.</b></font>&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">See that its value is 0x12345678; type a period to exit.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica" size="+1"><b>Open Function Code</b></font>

<p><font face="Times">The command</font>

<p><img src="../../../Images/sp.gif" width=18 height=1><font face="Times"><b>S</b> [<i>fcode</i>]</font>

<p><font face="Times">lets you inspect or modify the 680x0 function code (address space) used with the <b>e</b> (examine) command.&nbsp; The default code is 5 (supervisor data space).</font>

<p><font face="Times">Possible values for <i>fcode</i> are:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">0</font></td>

<td><font face="Times">Undefined, reserved</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">1</font></td>

<td><font face="Times">User data space (UD)</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">2</font></td>

<td><font face="Times">User program space (UP)</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">3</font></td>

<td><font face="Times">Undefined, reserved</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">4</font></td>

<td><font face="Times">Undefined, reserved</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">5</font></td>

<td><font face="Times">Supervisor data space (SD)</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">6</font></td>

<td><font face="Times">Supervisor program space (SP)</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">7</font></td>

<td><font face="Times">CPU space</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Example:</font></td></tr>

</table>

<p><img src="../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">NeXT&gt; <b>S</b></font>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=125></td>

<td><font face="Courier" size="-1">Function code 5 (SD)</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Current function code is 5.</font><br>
<font face="Courier" size="-1">NeXT&gt; <b>S 6</b></font><br>
<font face="Courier" size="-1">Function code 6 (SP)</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Change function code to 6.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica" size="+1"><b>Set Input Radix</b></font>

<p><font face="Times">The command</font>

<p><img src="../../../Images/sp.gif" width=18 height=1><font face="Times"><b>R</b> [<i>radix</i>]</font>

<p><font face="Times">lets you set the input radix.&nbsp; The default value for the input radix is 16.&nbsp; Any numbers you enter are interpreted in the base of the input radix (for example, input radix 16 means numbers are interpreted as base 16).&nbsp; If you don't specify <i>radix</i>, the current default input radix is displayed.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=6></td>

<td><font face="Helvetica" size="+2"><b>NMI Mini-Monitor Commands</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">The following NMI mini-monitor commands aren't currently useful for developers outside of NeXT.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>Set or Examine Any Kernel Flag</b></font>

<p><font face="Times">The command</font>

<p><img src="../../../Images/sp.gif" width=18 height=1><font face="Times"><i>flag</i><b>=</b>[<i>value</i>]</font>

<p><font face="Times">lets you examine or modify internal system flags (most internal system flags are of interest only to system developers at NeXT).</font>

<p><font face="Times">Example:</font></td></tr>

</table>

<p><img src="../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">nmi&gt; <b>debug=</b></font>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=125></td>

<td><font face="Courier" size="-1">kernel flags debug = 0x0</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">The <b>debug</b> flag has the value 0.</font><br>
<font face="Courier" size="-1">nmi&gt; <b>debug=2</b></font><br>
<font face="Courier" size="-1">kernel flag = 0x2</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font face="Times">Change the value of the <b>debug</b> flag to 2.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica" size="+1"><b>Set the IP Address</b></font>

<p><font face="Times">The command</font>

<p><img src="../../../Images/sp.gif" width=18 height=1><font face="Times"><b>kd_ipaddr=</b><i>value</i></font>

<p><font face="Times">lets you set the IP address used by the computer for kernel debugging.&nbsp; It's useful only to system developers at NeXT.</font></td></tr>

</table>



<p>

</body>
</html>
