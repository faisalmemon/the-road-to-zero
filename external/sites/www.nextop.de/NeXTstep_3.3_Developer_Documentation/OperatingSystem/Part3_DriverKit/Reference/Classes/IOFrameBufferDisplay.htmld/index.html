<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/OperatingSystem/Part3_DriverKit/Reference/Classes/IOFrameBufferDisplay.rtf -->
<!-- Date: Sun Jun 28 20:11:34 1998 -->
<head>
<title>IOFrameBufferDisplay</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica" size="+2"><b>IOFrameBufferDisplay</b></font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Helvetica"><b>Inherits From:</b></font></td>

<td><font face="Times">IODisplay : IODirectDevice : IODevice : Object</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Helvetica"><b>Conforms To:</b></font></td>

<td><font face="Times">IOScreenEvents</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Helvetica"><b>Declared In:</b></font></td>

<td><font face="Times">driverkit/IOFrameBufferDisplay.h</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=69></td>

<td><font face="Helvetica" size="+1"><b>Class Description</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">IOFrameBufferDisplay is an abstract class for managing display cards that support linear-mode frame buffers. IOFrameBufferDisplay's close interaction with the window server and event system means that your driver needs to do very little.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">If your display adapter doesn't allow you to linearly address the entire frame buffer at once, use the IOSVGADisplay class instead.</font>

<p><font face="Times">IOFrameBufferDisplay currently supports the following bit depths:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">2-bit grayscale</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">8-bit grayscale</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">8-bit color</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">16-bit RGB (5-5-5 or 4-4-4--both with 4096 colors)</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">24-bit RGB (8-8-8)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Most of the work in writing a IOFrameBufferDisplay driver is determining how to put the hardware into an advanced mode in which the frame buffer is linearly addressable. Some drivers support several advanced modes, which the user chooses between using the Configure application. The IODisplayInfo specification describes how to specify the modes your driver supports.</font>

<p><font face="Times">When specifying your driver's memory ranges in its default configuration table, you must first specify the addresses of the linear frame buffer, and then the addresses 0xa0000-0xbffff and 0xc0000-0xcffff.</font></td></tr>

</table>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">&#34;Memory Maps&#34; = &#34;0x7e00000-0x7ffffff 0xa0000-0xbffff 0xc0000-0xcffff&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">See the IODisplayInfo specification for information on display-specific configuration keys.</font>

<p><br><br>

<p><font face="Helvetica"><b>Implementing a Subclass</b></font>

<p><font face="Times">In your subclass of IOFrameBufferDisplay, you must implement the following methods:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">initFromDeviceDescription:</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">enterLinearMode</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">revertToVGAMode</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">You might also need to implement two more methods:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">If the hardware supports setting brightness, you must implement <b>setBrightness:</b>.</font></td></tr>

<tr valign=top>

<td width=105 height=9></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">To support multiple gamma correction tables, implement <b>setTransferTable:count:</b>.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=69></td>

<td><font face="Helvetica" size="+1"><b>Instance Variables</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">None declared in this class.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=69></td>

<td><font face="Helvetica" size="+1"><b>Method Types</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Creating and initializing IOFrameBufferDisplays</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=306></td>

<td><font face="Times">+ probe:</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">initFromDeviceDescription:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">Getting and setting parameters</font></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">getIntValues:forParameter:count:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=306></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">setCharValues:forParameter:count:</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">setIntValues:forParameter:count:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">Handling the cursor</font></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">hideCursor:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=306></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">moveCursor:frame:token:</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">showCursor:frame:token:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">Setting screen brightness</font></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">setBrightness:token:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Setting the gamma correction table</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=306></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">setTransferTable:count:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">Mapping the frame buffer</font></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">mapFrameBufferAtPhysicalAddress:length:</font></td></tr>

<tr valign=top>

<td width=105 height=7></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">Choosing display modes</font></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">enterLinearMode</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=306></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">revertToVGAMode</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">selectMode:count:</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">selectMode:count:valid:</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=69></td>

<td><font face="Helvetica" size="+1"><b>Class Methods</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>probe:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">+ (BOOL)<b>probe:</b><i>deviceDescription</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Without checking for the presence of hardware, allocates and initializes an IOFrameBufferDisplay. You shouldn't reimplement this method.</font>

<p><font face="Times">If the initialization (done with <b>initFromDeviceDescription:</b>) is unsuccessful, this method returns NO. Otherwise, this method sets the device kind to &quot;Linear Framebuffer&quot;, invokes <b>registerDevice</b>, and returns YES.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>initFromDeviceDescription:</b></font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=69></td>

<td><font face="Helvetica" size="+1"><b>Instance Methods</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>enterLinearMode</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(void)<b>enterLinearMode</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implemented by subclasses to put the display into linear frame buffer mode. This method is invoked by the system when appropriate, such as when the window server starts running.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">revertToVGAMode</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>getIntValues:forParameter:count:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(IOReturn)<b>getIntValues:</b>(unsigned int *)<i>parameterArray</i></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=163></td>

<td><font face="Times"><b>forParameter:</b>(IOParameterName)<i>parameterName</i></font><br>
<font face="Times"><b>count:</b>(unsigned int *)<i>count</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Handles NeXT-internal parameters specific to IOFrameBufferDisplays; forwards the handling of all other parameters to <b>super</b>.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>getIntValues:forParameter:count:</b> (IODevice)</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>hideCursor:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>hideCursor:</b>(int)<i>token</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implements this method, as described in the IOScreenEvents protocol specification. You should never need to invoke or implement this method.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>initFromDeviceDescription:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>initFromDeviceDescription:</b><i>deviceDescription</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Invokes <b>initFromDeviceDescription:</b> on <b>super</b>. If successful, sets the unit number and the name (to &quot;Display&quot; followed by the unit number). Frees itself if initialization was unsuccessful.</font>

<p><font face="Times">Subclasses must implement this method so that it performs all initialization necessary to set up the device and the driver. This includes setting the IODisplayInfo structure (as described in the IODisplay class description) and invoking <b>mapFrameBufferAtPhysicalAddress:length:</b>. If possible, this method should also check the hardware to see if it matches the IOConfigTable. If the hardware doesn't match, the driver should do what it can to ensure that the display is still usable.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <font face="Times">+ <b>probe:</b></font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>mapFrameBufferAtPhysicalAddress:length:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(vm_address_t)<b>mapFrameBufferAtPhysicalAddress:</b>(unsigned int)<i>address</i> <b>length:</b>(int)<i>numBytes</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Maps the physical memory for this instance into virtual memory for use by the device driver. If <i>address</i> is 0, this method maps the physical memory corresponding to local memory range 0, and <i>numBytes</i> is ignored. If <i>address</i> is not 0, the reserved resources are overridden--<i>address</i> is used as the physical memory address and <i>numBytes</i> is used as the length. The mapped memory range is cached as specified in the IODisplayInfo for this instance.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">When overriding reserved resources, you can't map memory outside of the memory range reserved for the device. However, you can map a subset of the memory range.</font>

<p><font face="Times">You should invoke this method during initialization.</font>

<p><font face="Times">Returns the virtual address that corresponds to <i>address</i>. If the memory mapping failed, this method logs an error message and returns NULL.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp;&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>initFromDeviceDescription:</b></font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>moveCursor:frame:token:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>moveCursor:</b>(Point *)<i>cursorLoc</i></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=163></td>

<td><font face="Times"><b>frame:</b>(int)<i>frame</i></font><br>
<font face="Times"><b>token:</b>(int)<i>token</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implements this method, as described in the IOScreenEvents protocol specification. You should never need to invoke or implement this method.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>revertToVGAMode</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(void)<b>revertToVGAMode</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implemented by subclasses to remove the display from whatever advanced mode it's in and enter a mode in which it can be used as a standard VGA device.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">enterLinearMode</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>selectMode:count:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(int)<b>selectMode:</b>(const IODisplayInfo *)<i>modeList</i> <b>count:</b>(int)<i>count</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Invokes <b>selectMode:count:valid:</b>, specifying 0 for the last argument.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>selectMode:count:valid:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(int)<b>selectMode:</b>(const IODisplayInfo *)<i>modeList</i></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=163></td>

<td><font face="Times"><b>count:</b>(int)<i>count</i></font><br>
<font face="Times"><b>valid:</b>(const BOOL *)<i>isValid</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Determines which IODisplayInfo in the driver-supplied <i>modeList</i> matches the value of the &quot;Display Mode&quot; key in the device's IOConfigTable. Drivers that support multiple advanced modes should invoke this method during initialization. When the driver receives a <b>enterLinearMode</b> message, it should enter the mode selected by this method. If this method doesn't find a valid mode, the driver should determine a mode that will work.</font>

<p><font face="Times">The &quot;Display Mode&quot; key is a configuration key that can be used by drivers to support multiple modes--for example, both 8-bit gray and 16-bit RGB. IODisplayInfo is defined in the header file <b>driverkit/displayDefs.h</b>.</font>

<p><font face="Times">The <i>modeList</i> argument should contain a IODisplayInfo for each advanced mode the driver supports. The <i>count</i> argument should specify the number of IODisplayInfos in <i>modeList</i>. <i>isValid</i> should either be 0 (in which case it's ignored) or an array that corresponds to the <i>modeList</i>. If <i>isValid</i>[1] is NO, for example, then this method ignores the IODisplayInfo pointed to by <i>modeList</i>[1].</font>

<p><font face="Times">If this method finds a match, it returns the index of the matching IODisplayInfo in <i>modeList</i>. If the &quot;Display Mode&quot; key is missing or its value is improperly formatted, or if a corresponding IODisplayInfo isn't found, this method returns -1.</font>

<p><font face="Times">See the IODisplay class description for information on display modes and the IODisplayInfo type.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>setBrightness:token:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>setBrightness:</b>(int)<i>level</i> <b>token:</b>(int)<i>token</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Checks whether <i>level</i> is between EV_SCREEN_MIN_BRIGHTNESS and EV_SCREEN_MAX_BRIGHTNESS (inclusive). If not, this method logs an error message. Subclasses that support brightness changes should override this method and implement it as described in the IOScreenEvents protocol specification.</font>

<p><font face="Times">Returns <b>self</b>.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>setCharValues:forParameter:count:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(IOReturn)<b>setCharValues:</b>(unsigned char *)<i>parameterArray</i></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=163></td>

<td><font face="Times"><b>forParameter:</b>(IOParameterName)<i>parameterName</i></font><br>
<font face="Times"><b>count:</b>(unsigned int)<i>count</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Handles NeXT-internal parameters specific to IOFrameBufferDisplays; forwards the handling of all other parameters to <b>super</b>.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>setCharValues:forParameter:count:</b> (IODevice)</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>setIntValues:forParameter:count:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(IOReturn)<b>setIntValues:</b>(unsigned int *)<i>parameterArray</i></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=163></td>

<td><font face="Times"><b>forParameter:</b>(IOParameterName)<i>parameterName</i></font><br>
<font face="Times"><b>count:</b>(unsigned int)<i>count</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Handles NeXT-internal parameters specific to IOFrameBufferDisplays; forwards the handling of all other parameters to <b>super</b>.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>setIntValues:forParameter:count:</b> (IODevice)</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>setTransferTable:count:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>setTransferTable:</b>(const unsigned int *)<i>table</i> <b>count:</b>(int)<i>numEntries</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Specifies new gamma correction values to be used by the hardware. The default implement does nothing but return <b>self</b>. Subclasses that support multiple gamma correction transforms must override this method so that it sets the hardware to reflect the values in <i>table</i>.</font>

<p><font face="Times">Gamma correction is necessary because displays respond nonlinearly to linear ranges of voltage. For example, consider a pixel that can have red, green, and blue values between 0 and 15. This pixel's brightness when the values are (7, 0, 0) might be more than 7/15 its brightness when the values are (15, 0, 0). Gamma correction lets the hardware adjust the voltage of the beam--for example, using 6.5/15 of maximum voltage instead of 7/15, so that the pixel isn't too bright.</font>

<p><font face="Times">Each entry in <i>table</i> specifies the gamma correction (a value scaled to be between 0 and 255, inclusive) for the corresponding pixel component values. For example, for RGB color modes, <i>table</i><b>[7]</b> specifies the gamma corrections for a red value of 7, a green value of 7, and a blue value of 7 (using one byte of the entry per component). If a pixel's value is (0, 5, 15), for example, the hardware should use the red gamma correction from <i>table</i><b>[0]</b>, the green gamma correction from <i>table</i><b>[5]</b>, and the blue gamma correction from <i>table</i><b>[15]</b>. Which bytes you use from each table entry depends on whether the transfer table is for a color or black-and-white mode; you can determine the mode from the value of <i>numEntries</i>.</font>

<p><font face="Times">When <i>numEntries</i> is IO_2BPP_TRANSFER_TABLE_SIZE or IO_8BPP_TRANSFER_TABLE_SIZE (as defined in the header file <b>driverkit/displayDefs.h</b>), the table is for a black-and-white display. In this case, each table entry has only one meaningful byte: the least significant byte.</font>

<p><font face="Times">When <i>numEntries</i> is IO_12BPP_TRANSFER_TABLE_SIZE, IO_15BPP_TRANSFER_TABLE_SIZE, or IO_24BPP_TRANSFER_TABLE_SIZE, the table is for an RGB display, and each entry has three meaningful bytes. The most significant byte holds the red gamma correction, the next most significant byte holds the green gamma correction, and the next holds the blue gamma correction. The least significant byte holds no information.</font>

<p><font face="Times">The following example shows how to copy the correction information from the transfer table to a particular type of hardware.</font></td></tr>

</table>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* This driver implements setTransferTable: so that it copies the</font><br>
<img src="../../../../Images/sp.gif" width=131 height=1><font face="Courier" size="-1">* table values into a table that contains first all the red values,</font><br>
<img src="../../../../Images/sp.gif" width=131 height=1><font face="Courier" size="-1">* then all the green values, and then all the blue values.&nbsp; It</font><br>
<img src="../../../../Images/sp.gif" width=131 height=1><font face="Courier" size="-1">* defines 3 instance variables -- redTransferTable,</font><br>
<img src="../../../../Images/sp.gif" width=131 height=1><font face="Courier" size="-1">* greenTransferTable, and blueTransferTable -- to point to where</font><br>
<img src="../../../../Images/sp.gif" width=131 height=1><font face="Courier" size="-1">* each component's values begin in the copied table. Finally,</font><br>
<img src="../../../../Images/sp.gif" width=131 height=1><font face="Courier" size="-1">* it puts the values in the hardware gamma correction table. */</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- setTransferTable:(unsigned int *)table count:(int)numEntries</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">int k;</font>

<p><img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">/* redTransferTable, greenTransferTable, and blueTransferTable</font><br>
<img src="../../../../Images/sp.gif" width=159 height=1><font face="Courier" size="-1">* are driver-defined instance variables</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">if (redTransferTable != 0)</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">IOFree(redTransferTable, 3 * transferTableCount);</font>

<p><img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">transferTableCount = numEntries;</font>

<p><img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">redTransferTable = IOMalloc(3 * numEntries);</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">greenTransferTable = redTransferTable + numEntries;</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">blueTransferTable = greenTransferTable + numEntries;</font>

<p><img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">switch ([self displayInfo]-&gt;bitsPerPixel) {</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">case IO_2BitsPerPixel:</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">case IO_8BitsPerPixel:</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">for (k = 0; k &lt; numEntries; k++) {</font><br>
<img src="../../../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">redTransferTable[k] = greenTransferTable[k] =</font><br>
<img src="../../../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">blueTransferTable[k] = table[k] &amp; 0xFF;</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">}</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">break;</font>

<p><img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">case IO_12BitsPerPixel:</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">case IO_15BitsPerPixel:</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">case IO_24BitsPerPixel:</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">for (k = 0; k &lt; numEntries; k++) {</font><br>
<img src="../../../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">redTransferTable[k] = (table[k] &gt;&gt; 24) &amp; 0xFF;</font><br>
<img src="../../../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">greenTransferTable[k] = (table[k] &gt;&gt; 16) &amp; 0xFF;</font><br>
<img src="../../../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">blueTransferTable[k] = (table[k] &gt;&gt; 8) &amp; 0xFF;</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">}</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">break;</font>

<p><img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">default:</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">IOFree(redTransferTable, 3 * numEntries);</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">redTransferTable = 0;</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">break;</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">}</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">[self setGammaTable]; /* subclass method */</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">return self;</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* subclass function */</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">static void</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">SetGammaValue(unsigned int r, unsigned int g, unsigned int b,</font><br>
<img src="../../../../Images/sp.gif" width=222 height=1><font face="Courier" size="-1">int level)</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">/* EV_SCALE_BRIGHTNESS is a macro defined in bsd/dev/ev_types.h</font><br>
<img src="../../../../Images/sp.gif" width=159 height=1><font face="Courier" size="-1">* that scales a pixel value to the specified brightness level. */</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">outb(PALETTE_DATA, EV_SCALE_BRIGHTNESS(level, r));</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">outb(PALETTE_DATA, EV_SCALE_BRIGHTNESS(level, g));</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">outb(PALETTE_DATA, EV_SCALE_BRIGHTNESS(level, b));</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/* subclass method */</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- setGammaTable</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">unsigned int i, j, g;</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">const IODisplayInfo *displayInfo;</font>

<p><img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">displayInfo = [self displayInfo];</font>

<p><img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">outb(PALETTE_WRITE, 0x00);</font>

<p><img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">/* brightnessLevel is a subclass ivar initialized to</font><br>
<img src="../../../../Images/sp.gif" width=159 height=1><font face="Courier" size="-1">* EV_SCREEN_MAX_BRIGHTNESS; setBrightness: changes it */</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">if (redTransferTable != 0) {</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">for (i = 0; i &lt; transferTableCount; i++) {</font><br>
<img src="../../../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">for (j = 0; j &lt; 256/transferTableCount; j++) {</font><br>
<img src="../../../../Images/sp.gif" width=236 height=1><font face="Courier" size="-1">SetGammaValue(redTransferTable[i],</font><br>
<img src="../../../../Images/sp.gif" width=334 height=1><font face="Courier" size="-1">greenTransferTable[i],</font><br>
<img src="../../../../Images/sp.gif" width=334 height=1><font face="Courier" size="-1">blueTransferTable[i], brightnessLevel);</font><br>
<img src="../../../../Images/sp.gif" width=208 height=1><font face="Courier" size="-1">}</font><br>
<img src="../../../../Images/sp.gif" width=180 height=1><font face="Courier" size="-1">}</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">}</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">return self;</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Gamma correction transforms are set using the <b>setframebuffertransfer</b> PostScript operator. The Window Server uses the functions specified in <b>setframebuffertransfer</b> to fill the values used in <i>table</i>. It then passes the values down the display system so that eventually the <b>setTransferTable:count:</b> message is invoked.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">The default transfer table cannot be specified using NetInfo, despite the claims of the <b>setframebuffertransfer </b>documentation.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <font face="Times"><b>setframebuffertransfer</b> PostScript Operator (<i>NEXTSTEP General Reference</i>)</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>showCursor:frame:token:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>showCursor:</b>(Point *)<i>cursorLoc</i></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=163></td>

<td><font face="Times"><b>frame:</b>(int)<i>frame</i></font><br>
<font face="Times"><b>token:</b>(int)<i>token</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implements this method, as described in the IOScreenEvents protocol specification. You should never need to invoke or implement this method.</font></td></tr>

</table>



<p>

</body>
</html>
