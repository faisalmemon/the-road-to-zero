<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/OperatingSystem/Part3_DriverKit/Reference/Classes/IOSVGADisplay.rtf -->
<!-- Date: Sun Jun 28 20:11:40 1998 -->
<head>
<title>IOSVGADisplay</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica" size="+2"><b>IOSVGADisplay</b></font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Helvetica"><b>Inherits From:</b></font></td>

<td><font face="Times">IODisplay : IODirectDevice : IODevice : Object</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Helvetica"><b>Conforms To:</b></font></td>

<td><font face="Times">IOScreenEvents</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Helvetica"><b>Declared In:</b></font></td>

<td><font face="Times">driverkit/IOSVGADisplay.h</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=69></td>

<td><font face="Helvetica" size="+1"><b>Class Description</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">IOSVGADisplay is an abstract class for managing Super VGA (SVGA) video displays. It provides most of the functionality needed by SVGA drivers. Functionality that varies from card to card must be provided by subclasses of IOSVGADisplay. In particular, different SVGA cards have different ways of setting the current plane and segment and of entering and exiting SVGA modes.</font>

<p><font face="Times">IOSVGADisplay supports 2-bit grayscale modes; it doesn't currently support 8-bit gray or color modes. To provide 2-bit grayscale support, IOSVGADisplay uses 2 of the 8 planes associated with screen pixels. The IOSVGADisplay subclass maps the values in the two planes into four entries in the hardware color palette, as described in <b>enterSVGAMode</b>.</font>

<p><font face="Times">Because the VGA specification allows only 64KB of screen memory to be mapped (from 0xa0000 to 0xbffff), the screen is split up into segments of 64KB or less. The display system tells the driver which segment and plane to map into the 64KB of available space. For a screen that's 768 pixels high by 1024 wide, the first 64KB segment (segment 0) consists of the top 512 rows of pixels. The next segment consists of the bottom 256 rows.</font>

<p><font face="Times">To write an SVGA display driver, you need to write two software modules:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">A subclass of IOSVGADisplay</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Five functions to be loaded into a user-level PostScript driver</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">How to write these modules is described below. See the IODisplay class description for additional notes on implementing a display driver.</font>

<p><br><br>

<p><font face="Helvetica"><b>Implementing a Subclass</b></font>

<p><font face="Times">In your subclass of IOSVGADisplay, you must implement the following methods:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">initFromDeviceDescription:</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">enterSVGAMode</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">revertToVGAMode</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">savePlaneAndSegmentSettings</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">restorePlaneAndSegmentSettings</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">setReadPlane:</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">setReadSegment:</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">setWritePlane:</font></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">setWriteSegment:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">If the hardware supports setting brightness, you should also implement <b>setBrightness:token:</b>.</font>

<p><br><br>

<p><font face="Helvetica"><b>Writing Functions for the PostScript Driver</b></font>

<p><font face="Times">Besides implementing a subclass of IOSVGADisplay, you also need to write five C functions. One, named <b>IOSetSVGAFunctions()</b>, should fill in the structure it's passed with pointers to the other four functions. It should return zero on success. The other four functions correspond exactly to four methods that you must also implement; each function should have exactly the same code as its corresponding method.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Function Prototype</b></font></td>

<td><font face="Helvetica"><b>Corresponding Method</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td nowrap><font face="Times">void <i>setReadPlane</i>(unsigned char <i>num</i>)</font></td>

<td><font face="Times">setReadPlane:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td nowrap><font face="Times">void <i>setReadSegment</i>(unsigned char <i>num</i>)</font></td>

<td><font face="Times">setReadSegment:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td nowrap><font face="Times">void <i>setWritePlane</i>(unsigned char <i>num</i>)</font></td>

<td><font face="Times">setWritePlane:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td nowrap><font face="Times">void <i>setWriteSegment</i>(unsigned char <i>num</i>)</font></td>

<td><font face="Times">setWriteSegment:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Here's an example of how to implement <b>IOSetSVGAFunctions()</b>.</font></td></tr>

</table>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">void SetReadPlane(unsigned char num) . . .</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">void SetReadSegment(unsigned char num) . . .</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">void SetWriteSegment(unsigned char num) . . .</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">void SetWritePlane(unsigned char num) . . .</font>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">int IOSetSVGAFunctions(IOSVGAFunctions *funcs)</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">funcs-&gt;setReadSegment = SetReadSegment;</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">funcs-&gt;setWriteSegment = SetWriteSegment;</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">funcs-&gt;setReadPlane = SetReadPlane;</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">funcs-&gt;setWritePlane = SetWritePlane;</font>

<p><img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">return 0;</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">The functions must contain only C code; Objective C code won't work.</font>

<p><font face="Times">The five functions should be defined in a user-level executable, to be loaded into the SVGA PostScript driver at run time. You need to inform the PostScript driver of the executable's location using the configuration key &quot;SVGA PostScript Driver Extension&quot;. You also need to specify the SVGA PostScript driver (<b>/usr/lib/NextStep/Displays/SVGA_psdrvr</b>) with the &quot;PostScript Driver&quot; key. For example, the lines below specify that the SVGA PostScript driver should load the executable named <b>TsengLabsET4000_psdrvr</b> from the driver's configuration bundle.</font></td></tr>

</table>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">&#34;SVGA PostScript Driver Extension&#34; = &#34;TsengLabsET4000_psdrvr&#34;;</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">&#34;PostScript Driver&#34; = &#34;/usr/lib/NextStep/Displays/SVGA_psdrvr&#34;;</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">See the IODisplay class description for other configuration keys that must be specified.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=69></td>

<td><font face="Helvetica" size="+1"><b>Instance Variables</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">None declared in this class.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=69></td>

<td><font face="Helvetica" size="+1"><b>Method Types</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Creating and initializing IOSVGADisplays</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=306></td>

<td><font face="Times">+ probe:</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">initFromDeviceDescription:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">Getting and setting parameters</font></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">getIntValues:forParameter:count:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=306></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">setIntValues:forParameter:count:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">Handling the cursor</font></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">hideCursor:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=306></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">moveCursor:frame:token:</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">showCursor:frame:token:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">Setting screen brightness</font></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">setBrightness:token:</font></td></tr>

<tr valign=top>

<td width=105 height=7></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">Mapping memory</font></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">mapFrameBufferAtPhysicalAddress:length:</font></td></tr>

<tr valign=top>

<td width=105 height=7></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">Choosing video modes</font></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">enterSVGAMode</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=306></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">revertToVGAMode</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">selectMode:count:</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">selectMode:count:valid:</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times">Setting planes and segments</font></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">savePlaneAndSegmentSettings</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=306></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">restorePlaneAndSegmentSettings</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">setReadPlane:</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">setReadSegment:</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">setWritePlane:</font><br>
<img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">setWriteSegment:</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=69></td>

<td><font face="Helvetica" size="+1"><b>Class Methods</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>probe:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">+ (BOOL)<b>probe:</b><i>deviceDescription</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Without checking for the presence of hardware, allocates and initializes an IOSVGADisplay. You shouldn't reimplement this method.</font>

<p><font face="Times">If initialization (done with <b>initFromDeviceDescription:</b>) is unsuccessful, this method returns NO. Otherwise, this method sets the device kind to &quot;frame buffer&quot;, invokes <b>registerDevice</b>, and returns YES.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=69></td>

<td><font face="Helvetica" size="+1"><b>Instance Methods</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>enterSVGAMode</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(void)<b>enterSVGAMode</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implemented by subclasses to put the display into SVGA mode. This method is invoked by the system when appropriate, such as when the window server starts running. This method should set up all the registers necessary for the selected mode, set the color palette, and clear the screen.</font>

<p><font face="Times">You should set the color palette to contain values for the four supported shades of gray in the first four entries; the rest of the entries should be zeroed out. NeXT drivers currently use the palette values shown in the following table.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Helvetica"><b>Color</b></font></td>

<td nowrap><font face="Helvetica"><b>Palette Index</b></font></td>

<td><font face="Helvetica"><b>Value</b></font></td></tr>

<tr valign=top>

<td width=124 height=4></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Black</font></td>

<td nowrap><font face="Times">0</font></td>

<td><font face="Times">0</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Dark gray</font></td>

<td nowrap><font face="Times">1</font></td>

<td><font face="Times">0x26</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">Light gray</font></td>

<td nowrap><font face="Times">2</font></td>

<td><font face="Times">0x34</font></td></tr>

<tr valign=top>

<td width=124></td>

<td nowrap><font face="Times">White</font></td>

<td nowrap><font face="Times">3</font></td>

<td><font face="Times">0x3F</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>revertToVGAMode</b></font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>getIntValues:forParameter:count:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(IOReturn)<b>getIntValues:</b>(unsigned int *)<i>parameterArray</i></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=163></td>

<td><font face="Times"><b>forParameter:</b>(IOParameterName)<i>parameterName</i></font><br>
<font face="Times"><b>count:</b>(unsigned int *)<i>count</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Handles NeXT-internal parameters specific to IOSVGADisplays; forwards the handling of all other parameters to <b>super</b>.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>hideCursor:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>hideCursor:</b>(int)<i>token</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implements this method, as described in the IOScreenEvents protocol specification. You should never need to invoke or implement this method.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>initFromDeviceDescription:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>initFromDeviceDescription:</b><i>deviceDescription</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Invokes <b>initFromDeviceDescription:</b> on <b>super</b>. If successful, sets the unit number and the name (to &quot;SVGADisplay&quot; followed by the unit number). Frees itself if initialization was unsuccessful.</font>

<p><font face="Times">Subclasses must implement this method so that it performs all initialization necessary to set up the device and the driver. After invoking <b>initFromDeviceDescription:</b> on <b>super</b>, this method should determine its mode (invoking <b>selectMode:count:</b> or <b>selectMode:count:valid:</b>, if necessary) and set <b>[self displayMode]</b> to the IODisplayInfo appropriate for the mode. The driver should finish by invoking <b>mapFrameBufferAtPhysicalAddress:length:</b> and setting the IODisplayInfo's <b>frameBuffer</b> field to the value returned.</font>

<p><font face="Times">If possible, this method should check the hardware to see if it matches the IOConfigTable. If the hardware doesn't match, the driver should do what it can to ensure that the display is still usable.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <font face="Times">IODisplay class description (&quot;IODisplayInfo&quot;)</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>mapFrameBufferAtPhysicalAddress:length:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(vm_address_t)<b>mapFrameBufferAtPhysicalAddress:</b>(unsigned int)<i>address</i> <b>length:</b>(int)<i>numBytes</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Maps the physical memory for this instance into virtual memory for use by the device driver. If <i>address</i> is 0, this method maps the physical memory corresponding to local memory range 0, and <i>numBytes</i> is ignored. If <i>address</i> is not 0, the reserved resources are overridden--<i>address</i> is used as the physical memory address and <i>numBytes</i> is used as the length. The mapped memory range is cached as IO_WriteThrough.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">When overriding reserved resources, you can't map memory outside of the memory range reserved for the device. However, you can map a subset of the memory range.</font>

<p><font face="Times">You should invoke this method during initialization.</font>

<p><font face="Times">Returns the virtual address that corresponds to <i>address</i>. If the memory mapping failed, this method logs an error message and returns NULL.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>moveCursor:frame:token:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>moveCursor:</b>(Point *)<i>cursorLoc</i></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=163></td>

<td><font face="Times"><b>frame:</b>(int)<i>frame</i></font><br>
<font face="Times"><b>token:</b>(int)<i>token</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implements this method, as described by the IOScreenEvents protocol. You should never need to invoke or implement this method.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>restorePlaneAndSegmentSettings</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(void)<b>restorePlaneAndSegmentSettings</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implemented by subclasses to restore the plane and segment settings to the saved values. This method is invoked by IOSVGADisplay's cursor handling methods. The cursor handling methods invoke <b>savePlaneAndSegmentSettings</b>, do whatever is necessary to update the cursor, and then invoke <b>restorePlaneAndSegmentSettings</b> to restore the display's state.</font>

<p><font face="Times">Here's an example of implementing this method by saving the current settings into subclass-defined instance variables.</font></td></tr>

</table>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- (void)restorePlaneAndSegmentSettings</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">IOWriteRegister(EIDR_SEQ_ADDR, SEQ_AT_MPK, writePlane);</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">IOWriteRegister(EIDR_GCR_ADDR, GCR_AT_READ_MAPS, readPlane);</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">outb(EIDR_GCR_SEGS, readSegment);</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">outb(EIDR_GCR_SEGS, writeSegment);</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>revertToVGAMode</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(void)<b>revertToVGAMode</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implemented by subclasses to remove the display from whatever advanced mode it's in and enter a mode in which it can be used as a standard VGA device. Implementing this method usually consists of setting registers that aren't used by VGA.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>savePlaneAndSegmentSettings</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(void)<b>savePlaneAndSegmentSettings</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implemented by subclasses to save the current plane and segment settings. This method is invoked by IOSVGADisplay's cursor handling methods. The cursor handling methods invoke <b>savePlaneAndSegmentSettings</b>, do whatever is necessary to update the cursor, and then invoke <b>restorePlaneAndSegmentSettings</b> to restore the display's state.</font>

<p><font face="Times">Each invocation of <b>savePlaneAndSegmentSettings</b> is followed by exactly one invocation of <b>restorePlaneAndSegmentSettings</b>, with no intervening invocations of <b>savePlaneAndSegmentSettings</b>. In other words, the driver only has to remember one group of settings at a time.</font>

<p><font face="Times">Here's an example of implementing this method by saving the current settings into subclass-defined instance variables.</font></td></tr>

</table>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- (void)savePlaneAndSegmentSettings</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">writePlane = IOReadRegister(EIDR_SEQ_ADDR, SEQ_AT_MPK);</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">readPlane = IOReadRegister(EIDR_GCR_ADDR, GCR_AT_READ_MAPS);</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">readSegment = inb(EIDR_GCR_SEGS);</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">writeSegment = inb(EIDR_GCR_SEGS);</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>selectMode:count:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(int)<b>selectMode:</b>(const IODisplayInfo *)<i>modeList</i> <b>count:</b>(int)<i>count</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Invokes <b>selectMode:count:valid:</b>, specifying 0 for the last argument.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>selectMode:count:valid:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(int)<b>selectMode:</b>(const IODisplayInfo *)<i>modeList</i></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=163></td>

<td><font face="Times"><b>count:</b>(int)<i>count</i></font><br>
<font face="Times"><b>valid:</b>(const BOOL *)<i>isValid</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Determines which IODisplayInfo in the driver-supplied <i>modeList</i> matches the value of the &quot;Display Mode&quot; key in the device's IOConfigTable. Drivers that support multiple advanced modes should invoke this method during initialization. When the driver receives a <b>enterSVGAMode</b> message, it should enter the mode selected by this method. If this method doesn't find a valid mode, the driver should determine a mode that will work.</font>

<p><font face="Times">The &quot;Display Mode&quot; key is a configuration key that can be used by drivers to support multiple modes--for example, 66 Hz and 72 Hz. IODisplayInfo is defined in the header file <b>driverkit/displayDefs.h</b>.</font>

<p><font face="Times">The <i>modeList</i> argument should contain an IODisplayInfo for each advanced mode the driver supports. The <i>count</i> argument should specify the number of IODisplayInfos in <i>modeList</i>. <i>isValid</i> should either be 0 (in which case it's ignored) or an array that corresponds to the <i>modeList</i>. If <i>isValid</i>[1] is NO, for example, then this method ignores the IODisplayInfo pointed to by <i>modeList</i>[1].</font>

<p><font face="Times">If this method finds a match, it returns the index of the matching IODisplayInfo in modeList. If the &quot;Display Mode&quot; key is missing or its value is improperly formatted, or if a corresponding IODisplayInfo isn't found, this method returns -1.</font>

<p><font face="Times">See the IODisplay class description for information on display modes and the IODisplayInfo type.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>setBrightness:token:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>setBrightness:</b>(int)<i>level</i> <b>token:</b>(int)<i>token</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Checks whether <i>level</i> is between EV_SCREEN_MIN_BRIGHTNESS and EV_SCREEN_MAX_BRIGHTNESS (inclusive). If not, logs an error message. Subclasses that support brightness changes should override this method. A typical implementation has code like this:</font></td></tr>

</table>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">/*&nbsp; Color palette constants (gamma 2.2, for typical CRT displays) */</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define WHITE_PALETTE_VALUE 0x3F</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define LIGHT_GRAY_PALETTE_VALUE 0x34</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define DARK_GRAY_PALETTE_VALUE 0x26</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define BLACK_PALETTE_VALUE 0</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">.</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">.</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">.</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">unsigned char val;</font>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">val = EV_SCALE_BRIGHTNESS(level, WHITE_PALETTE_VALUE);</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><i>/* Write val to the hardware's color palette entry for white */</i></font>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">val = EV_SCALE_BRIGHTNESS(level, LIGHT_GRAY_PALETTE_VALUE);</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><i>/* Write val to the entry for light gray */</i></font>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">val = EV_SCALE_BRIGHTNESS(level, DARK_GRAY_PALETTE_VALUE);</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><i>/* Write val to the entry for dark gray */</i></font>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">val = EV_SCALE_BRIGHTNESS(level, BLACK_PALETTE_VALUE);</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1"><i>/* Write val to the entry for black */</i></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Returns <b>self</b>.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>setIntValues:forParameter:count:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(IOReturn)<b>setIntValues:</b>(unsigned int *)<i>parameterArray</i></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=163></td>

<td><font face="Times"><b>forParameter:</b>(IOParameterName)<i>parameterName</i></font><br>
<font face="Times"><b>count:</b>(unsigned int)<i>count</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Handles NeXT-internal parameters specific to IOSVGADisplays; forwards the handling of all other parameters to <b>super</b>.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>setIntValues:forParameter:count:</b> (IODevice)</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>setReadPlane:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(void)<b>setReadPlane:</b>(unsigned char)<i>planeNum</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implemented by subclasses to set which of two planes the display subsystem will read from. Only one plane can be active at a time. Here's an example of implementing this method.</font></td></tr>

</table>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define GRAPHICS_CONTROLLER_REGISTER_ADDRESS 0x03CE</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define SEGMENT_REGISTER_INDEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x09</font>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- (void)setReadSegment: (unsigned char)segmentNum</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">IOWriteRegister(GRAPHICS_CONTROLLER_REGISTER_ADDRESS,</font><br>
<img src="../../../../Images/sp.gif" width=264 height=1><font face="Courier" size="-1">SEGMENT_REGISTER_INDEX,</font><br>
<img src="../../../../Images/sp.gif" width=264 height=1><font face="Courier" size="-1">(segmentNum &lt;&lt; 4));</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>setWritePlane:</b></font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>setReadSegment:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(void)<b>setReadSegment:</b>(unsigned char)<i>segmentNum</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implemented by the subclass to set the 64KB segment the display subsystem will read from.</font></td></tr>

</table>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define GRAPHICS_CONTROLLER_REGISTER_ADDRESS&nbsp;&nbsp; 0x03CE</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define PLANE_REGISTER_INDEX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x04</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">#define PROTECT_HIGH_REGISTER_BITS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xFC</font>

<p><img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">- (void)setReadPlane: (unsigned char)planeNum</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">{</font><br>
<img src="../../../../Images/sp.gif" width=152 height=1><font face="Courier" size="-1">IOReadModifyWriteRegister(GRAPHICS_CONTROLLER_REGISTER_ADDRESS,</font><br>
<img src="../../../../Images/sp.gif" width=334 height=1><font face="Courier" size="-1">PLANE_REGISTER_INDEX,</font><br>
<img src="../../../../Images/sp.gif" width=334 height=1><font face="Courier" size="-1">PROTECT_HIGH_REGISTER_BITS,</font><br>
<img src="../../../../Images/sp.gif" width=334 height=1><font face="Courier" size="-1">planeNum);</font><br>
<img src="../../../../Images/sp.gif" width=124 height=1><font face="Courier" size="-1">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>setWriteSegment:</b></font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>setWritePlane:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(void)<b>setWritePlane:</b>(unsigned char)<i>planeNum</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implemented by subclasses to set which of two planes the display subsystem will write to. Only one plane can be active at a time.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>setReadPlane:</b></font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>setWriteSegment:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times">(void)<b>setWriteSegment:</b>(unsigned char)<i>segmentNum</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implemented by the subclass to set the 64KB segment the display subsystem will read from.</font>

<p><font face="Helvetica"><b>See also:</b></font>&nbsp; <img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>setReadSegment:</b></font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica"><b>showCursor:frame:token:</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><img src="../../../../Images/c2D.gif" width=8 height=4> <font face="Times"><b>showCursor:</b>(Point *)<i>cursorLoc</i></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=163></td>

<td><font face="Times"><b>frame:</b>(int)<i>frame</i></font><br>
<font face="Times"><b>token:</b>(int)<i>token</i></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=106></td>

<td><font face="Times">Implements this method, as described in the IOScreenEvents protocol specification. You should never need to invoke or implement this method.</font></td></tr>

</table>



<p><br>

</body>
</html>
