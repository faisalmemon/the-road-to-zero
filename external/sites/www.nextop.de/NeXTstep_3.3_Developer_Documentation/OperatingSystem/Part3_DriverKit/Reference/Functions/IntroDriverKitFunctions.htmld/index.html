<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/OperatingSystem/Part3_DriverKit/Reference/Functions/IntroDriverKitFunctions.rtf -->
<!-- Date: Sun Jun 28 20:11:51 1998 -->
<head>
<title>IntroDriverKitFunctions</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p align=right><font face="Times" size="+3"><i>Functions</i></font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">This section describes three types of functions and macros:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">General-purpose functions--to perform basic tasks</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Driver Debugging Module (DDM) functions--to help all drivers keep debugging information</font></td></tr>

<tr valign=top>

<td width=105 height=12></td></tr>

<tr valign=top>

<td width=105></td>

<td nowrap><font face="Times"><img src="../../../../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Miscellaneous functions--such as DMA alignment macros, functions that work only in the kernel, and functions specific to a particular machine architecture.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Unless noted otherwise, all of the functions described in this section work in both user-level and kernel-level drivers.</font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Other Functions Available to Drivers</b></font>

<p><font face="Times">Almost all Mach functions are available to kernel-level device drivers. If you don't find the appropriate functionality in a method or function, you can use a Mach function. For example, <b>port_allocate()</b> and <b>msg_send()</b> are used by many drivers.</font>

<p><font face="Helvetica"><b>Note:</b></font>&nbsp; <font face="Times">Instead of including the header file <b>mach/mach.h</b>, you must include <b>mach/mach_user_internal.h</b> and <b>mach/mach_interface.h</b>.</font>

<p><font face="Times">The <b>host_priv_self()</b> Mach function does <i>not</i> work in the kernel. You should use <b>IOHostPrivSelf()</b> instead.</font>

<p><br><br><br>

<p><font face="Helvetica" size="+1"><b>General-Purpose Functions</b></font>

<p><font face="Times">The general-purpose functions, defined in the header file <b>driverkit/generalFuncs.h</b>, provide a consistent interface for device drivers that may have to run in kernel space at one time (or in one configuration) and in user space at another time. Using these functions minimizes the work or porting between the two environments. All the Driver Kit classes, as well all NeXT kernel-level drivers that use the Driver Kit, were written using these functions so that they have one set of source files with minimal kernel and user mode differences.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=34></td>

<td nowrap><font face="Helvetica"><b>Warning:</b></font></td>

<td><font face="Times">Before using any of the general-purpose functions, each user-level driver must call <b>IOInitGeneralFuncs()</b>. (Kernel-level drivers don't need to call it.)</font></td></tr>

<tr valign=top>

<td width=34 height=30></td></tr>

<tr valign=top>

<td width=34></td>

<td nowrap></td>

<td><font face="Helvetica" size="+1"><b>Thread Functions</b></font></td></tr>

<tr valign=top>

<td width=34 height=13></td></tr>

<tr valign=top>

<td width=34></td>

<td nowrap></td>

<td><font face="Times">These functions provide the functionality of the C-thread functions in a uniform way in both user and kernel space.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">IOForkThread()</font><br>
<font face="Times">IOSuspendThread()</font><br>
<font face="Times">IOResumeThread()</font><br>
<font face="Times">IOExitThread()</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Timer Functions</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">IOSleep()</font><br>
<font face="Times">IODelay()</font><br>
<font face="Times">IOScheduleFunc()</font><br>
<font face="Times">IOUnscheduleFunc()</font><br>
<font face="Times">IOGetTimestamp()</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Memory Allocation and Copying Functions</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">IOCopyMemory()</font><br>
<font face="Times">IOMalloc()</font><br>
<font face="Times">IOFree()</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Miscellaneous General-Purpose Functions</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">IOInitGeneralFuncs()</font><br>
<font face="Times">IOFindNameForValue()</font><br>
<font face="Times">IOFindValueForName()</font><br>
<font face="Times">IOLog()</font><br>
<font face="Times">IOPanic()</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Driver Debugging Module (DDM) Functions</b></font>

<p><font face="Times">See the &quot;Adding Debugging Code&quot; section in Chapter 2 for information on using the DDM.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">IOAddDDMEntry()</font><br>
<font face="Times">IOClearDDM()</font><br>
<font face="Times">IOCopyString()</font><br>
<font face="Times">IODEBUG()</font><br>
<font face="Times">IOGetDDMEntry()</font><br>
<font face="Times">IOGetDDMMask()</font><br>
<font face="Times">IOInitDDM()</font><br>
<font face="Times">IONsTimeFromDDMMsg()</font><br>
<font face="Times">IOSetDDMMask()</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Miscellaneous Functions</b></font>

<p><br><br>

<p><font face="Helvetica" size="+1"><b>Kernel-Only Functions</b></font>

<p><font face="Times">The function <b>IOConvertPort()</b> is necessary for some kernel-level drivers--and not for user-level drivers--because kernel-level drivers can execute in more than one task. The first thread of a kernel-level driver executes in the loadable kernel server's task, any threads that the driver creates execute in the kernel I/O task, and network drivers and drivers with UNIX entry points (at some stage) can execute in the context of an unknown task.</font>

<p><font face="Times"><b>IOGetObjectForDeviceName()</b> provides to kernel-level drivers some of the functionality provided to user-level programs by IODeviceMaster. Similarly, <b>IOHostPrivSelf()</b> is used by some kernel-level drivers that need the information normally returned by <b>host_priv_self()</b> (which is one of the few Mach functions that doesn't work in the kernel).</font>

<p><font face="Times">The function <b>IOVmTaskSelf()</b> supplies a <b>vm_task_t</b> for Mach function calls that expect one for the kernel; this is necessary because <b>vm_task_t</b> and <b>task_t</b> aren't the same in the kernel (as they are at user level). <b>IOVmTaskCurrent()</b> supplies a <b>vm_task_t</b> that's needed by some UNIX-style drivers. Finally, <b>IOVmTaskForBuf() </b>supplies a <b>vm_task_t</b> for the unknown task that is requesting UNIX-style I/O.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">IOConvertPort()</font><br>
<font face="Times">IOGetObjectForDeviceName()</font><br>
<font face="Times">IOHostPrivSelf()</font><br>
<font face="Times">IOPhysicalFromVirtual()</font><br>
<font face="Times">IOSetUNIXError()</font><br>
<font face="Times">IOVmTaskCurrent()</font><br>
<font face="Times">IOVmTaskForBuf()</font><br>
<font face="Times">IOVmTaskSelf()</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>DMA Alignment Macros</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">IOAlign()</font><br>
<font face="Times">IOIsAligned()</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Helvetica" size="+1"><b>Architecture-Specific Functions</b></font>

<p><font face="Times">The following functions are used by some Intel drivers to read and write I/O ports:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">inb()</font><br>
<font face="Times">inw()</font><br>
<font face="Times">inl()</font><br>
<font face="Times">outb()</font><br>
<font face="Times">outw()</font><br>
<font face="Times">outl()</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Some Intel drivers use the following function to help handle interrupts:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">IODisableInterrupt()</font><br>
<font face="Times">IOEnableInterrupt()</font><br>
<font face="Times">IOSendInterrupt()</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Some Intel devices require memory in the low 16 MB:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">IOMallocLow()</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=105></td>

<td><font face="Times">Intel display drivers often use the following functions to read and write VGA registers:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=124></td>

<td><font face="Times">IOReadRegister()</font><br>
<font face="Times">IOReadModifyWriteRegister()</font><br>
<font face="Times">IOWriteRegister()</font></td></tr>

</table>



<p><br><br><br><br><br><br><br><br>

</body>
</html>
