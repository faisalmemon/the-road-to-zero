<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/ReleaseNotes/CompilerTools.rtf -->
<!-- Date: Sun Jun 28 20:13:33 1998 -->
<head>
<title>CompilerTools</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Release 3.3&nbsp; Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">3.3 Release Notes:</font><br>
<font face="Times" size="+1">Compiler Tools</font>

<p><br><br><br>

<p><font face="Times">This document contains release notes for the 3.3, 3.2, 3.1, and 3.0 releases of the Compiler Tools.&nbsp; Items specific to the 3.3 release are listed first, and the Release 3.2, 3.1, and 3.0 notes follow.</font>

<p><font face="Times">This file contains information about the following topics:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The NeXT GNU based assemblers</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The NeXT Mach-O link editor</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Mach-O object tools (<b>nm</b>, <b>otool</b>, and so on)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">Numbers in parentheses following command names, as in <b>rld</b>(3), refer to Unix manual page sections.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.3</b></font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Feature</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The major feature for Release 3.3 is a true Mach-O assembler, available for all platforms. See &quot;The NeXT Mach-O GNU-based Assembler&quot; for more information.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Problems Fixed in Release 3.1</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">These problems have been fixed in Release 3.3:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-2">Reference:</font></td>

<td><font face="Times">37610</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-2">Problem:</font></td>

<td><font face="Times">Objective C messages are counted twice when profiling.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-2">Description:</font></td>

<td><font face="Times">If a method is compiled for profiling, it gets counted by two separate mechanisms, resulting in a double count.</font></td></tr>

<tr valign=top>

<td width=90 height=29></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-2">Reference:</font></td>

<td><font face="Times">41317</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-2">Problem:</font></td>

<td><font face="Times">The assembler for HP 9000 systems does not support cache control hints.</font></td></tr>

<tr valign=top>

<td width=90 height=12></td></tr>

<tr valign=top>

<td width=90></td>

<td nowrap><font face="Helvetica" size="-2">Description:</font></td>

<td><font face="Times">You can't get cache control hints from an instruction like LDCWS.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.2</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Known Problems</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">These new bugs have appeared since Release 3.1.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">37610</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Objective C messages are counted twice when profiling.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">If a method is compiled for profiling, it gets counted by two separate mechanisms, resulting in a double count.</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.1</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The major feature for the 3.1 release is the support for multiple architectures and cross development.&nbsp; The supported processor architectures are m68k and i386. The functionality of the 3.1 release is the same for all supported architectures as it was previously for the m68k architecture.&nbsp; The 3.1 release also adds the new functionality of multiple architecture files (&quot;fat&quot; files).</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">By default all tools target for the host they are executed on.&nbsp; Target architectures are specified by <b>-arch</b> <i>flag</i> to the tools.&nbsp; More than one target architecture can be specified.&nbsp; Tools that operate on object files (that don't create them) can also have <b>-arch all</b> specified to select all architectures.&nbsp; See the man pages for the specific tools for more details on how it operates on fat files.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The -<i>o</i> option to <i>otool</i>(1) is now fully working along with printing of the sections __protocol, __string_object and __runtime_setup in the __OBJC segment.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Bugs Fixed in Release 3.1</b></font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">These bugs have been fixed in Release 3.1:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">27954</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Some names in m68k assembly code appeared to behave as reserved words.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">Two-character symbol names beginning with `b', `d', or `i' were assumed by the assembler to indicate the m68k pseudo-registers `bc', `dc', or `ic', masking the desired use of the symbol name.</font></td></tr>

<tr valign=top>

<td width=97 height=18></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">23178</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Compiling with optimization produced some incorrect result with <b>float</b>s.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">An assembler bug caused comparison of small floating point numbers not to work in every case.</font></td></tr>

<tr valign=top>

<td width=97 height=18></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">19664</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times"><b>gprof</b> crashes when used on a program with bundles (NXBundle objects).</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">The profiling tools would not work with code loaded from bundles.</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.0</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">These notes were included with the Release 3.0 version of the Compiler Tools.</font>

<p><br><br>

<p><font face="Times">This file contains information about the following topics:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The NeXT GNU based assembler</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The NeXT Mach-O link editor</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Mach-O object tools (nm, otool, and so on)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The major change is that the assembler is much better. The other major feature is a new assembler manual. The assembler manual documents all features of the assembler (previously no assembler manual existed).</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+1"><b>The NeXT GNU-based Assemblers</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The NeXT assembler is now a fully supported program and no longer viewed just as a back end to the compiler code generator.&nbsp; Also all outstanding bugs from the 2.x releases have been fixed.&nbsp; Exhaustive testing of all the instructions and operands of the assembler has been done resulting in a much more robust assembler.&nbsp; A UNIX manual page now exists for the assembler.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Major New Features</b></font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Simple user defined macros (see <b>.macro</b>, and so on)</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Conditional assembly (see <b>.if</b>, and so on)</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">C language style assembler expressions with C precedence</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">All m68k mmu instructions are now supported</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">All previous warnings are now treated as errors and cause the assembler to exit and not create an object file when an error is encountered (errors such as unknown pseudo ops, mismatching operands to machine instructions, and so on)</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Documentation</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Assembler manual (available on-line in <b>/NextLibrary/Documentation/NextDev/Assembler</b>)</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times"><i>as</i>(1) Unix manual page</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The on-line assembler manual is indexed for use in Digital Librarian.&nbsp; A target for the manual is on the NextDeveloper bookshelf (<b>/NextLibrary/Bookshelves/NextDeveloper.bshlf</b>).</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Notable Bug Fixes</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">For the m68k, floating-point instructions that allow immediate operands were handled incorrectly.&nbsp; Previously an instruction like &quot;fmuls #2,fp0&quot; would not place a 2.0 in fp0 the binary bit pattern of 2 (for double formats, like fmuld, the immediate value would be trashed).&nbsp; The new assembler now treats this immediate like all others, as an integer and then converts it to a floating-point value.&nbsp; A new feature has also been added so that bit patterns can be used for floating-point immediate values by prefixing with 0b, which then causes the rest of the value to be assumed as hexadecimal number.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Known Bugs</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">68k assembler does not handle packed floating-point immediates. This is treated as an error.</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The logical operators &amp;&amp; and || are not implemented in expressions and can't be used.</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+1"><b>The NeXT Mach-O link editor</b></font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The new <b>-ObjC</b> flag provides objective-C linking semantics with respect to libraries. When this flag is present all library members for the specified libraries that define an objective-C class or category are loaded from the library.&nbsp; This solves problems with classes not being linked into the application and getting errors from the objective-C runtime when the class is used.&nbsp; This should be used whenever building a NeXT application and is the default in Project Builder.&nbsp; With this feature a library that contains objective-C can no longer be specified more than once (this includes libsys_s.a which is automatically included by cc(1) so it should not be specified in addition to that or multiply defined symbols will result).</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The new <b>-all_load</b> flag provides a way to link in all the members of the specified libraries.&nbsp; When this flag is present all library members for the specified libraries are always loaded from the library.&nbsp; This solves problems with respect to the use of <i>rld</i>(3), <i>objc_loadModules</i>(3) and NXBundles where the application wants to make available all of the library routines to the code it dynamically loads.&nbsp; This provides a more general solution that which is provided with the &quot;-u libsys_s&quot; like flags with respect to the NeXT supplied shared libraries.&nbsp; This solution&nbsp; works for all types of libraries including those not supplied by NeXT.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The new <b>-m</b> flag allows multiply defined symbols with a warning instead of treating them as a hard error.&nbsp; In this case the first symbol is used for linking and is the value of the symbol. This should only be used as a stopgap measure when the source code is unavailable to be fixed.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The new function&nbsp; void <b>rld_forget_symbol(</b>NXStream *<i>stream</i>, const char&#160;*<i>symbol_name</i><b>)</b> was added for use by Franz Lisp to better support its implementation of foreign functions (see the <i>rld</i>(3) Unix manual page for details).</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The <i>rld</i>(3) package now works more automatically with the debugger <i>gdb</i>(1) for debugging code that is loaded in to a program by the program itself.&nbsp; If the program loads into itself with <i>rld</i>(3) then the output_filename parameter of <i>rld_load</i>(3) and the use of gdb's add-file command is no longer needed.&nbsp; These are still needed if the program has a program other than itself loading objects into it.</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+1"><b>Mach-O Object Tools</b></font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The tool <i>strip</i>(1) now allows all combinations of its flags to better support stripping executables for later use with <i>rld</i>(3).&nbsp; This allows much easier control of the api that the executable wants to provide to the objects that it will load with <i>rld</i> and it will not have to publish symbols that are not part of its API.&nbsp; For example an executable that wishes to allow only a subset of its global symbols but all of the shared libraries globals to be used would be stripped with:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=108 height=1><font face="Courier" size="-1">strip -s api_symbols -A executable</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td><font face="Times">Here the file <i>api_symbols</i> would contain only those symbols from the executable that it wishes the objects loaded with <i>rld</i> to have access to.&nbsp; The other major change to <i>strip</i>(1) was to properly handle relocation entries and never strip them.&nbsp; Thus, with the addition of the <b>-u</b> flag to save all undefined symbols, <i>strip</i>(1) allows an object (made up of other objects) to strip its global name space so not to collide with other symbols. For example an object that is made up of a number of other objects that will be loaded into an executable would built and then stripped with:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=108 height=1><font face="Courier" size="-1">ld -o relocatable.o -r a.o b.o c.o</font><br>
<img src="../Images/sp.gif" width=108 height=1><font face="Courier" size="-1">strip -s api_symbols -u relocatable.o</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td><font face="Times">which would leave only the undefined symbols and symbols listed in the file <i>api_symbols</i> in the object file.&nbsp; In this case <i>strip</i>(1) has updated the relocation entries to reflect the new symbol table.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Notable Bug Fixes</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The m68k disassembler in <i>otool</i>(1) now correctly disassembles all m68k instruction from all of the m68k chips including the mmu instructions in the 030 and 040.&nbsp; Also the disassembly format exactly matches the assembler format for all instructions and operand formats.</font></td></tr>

</table>



<p>

</body>
</html>
