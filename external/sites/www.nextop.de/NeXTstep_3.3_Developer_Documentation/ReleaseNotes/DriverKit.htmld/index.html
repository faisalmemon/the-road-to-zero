<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/ReleaseNotes/DriverKit.rtf -->
<!-- Date: Sun Jun 28 20:13:41 1998 -->
<head>
<title>DriverKit</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Release 3.3 Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc. All Rights Reserved.</font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">3.3 Release Notes:</font><br>
<font face="Times" size="+1">Driver Kit</font>

<p><br><br><br>

<p><font face="Times">This file contains release notes for the Driver Kit. Items specific to each of the minor releases (Release 3.3, Release 3.2, and so on) are listed in separate sections, starting with the latest one.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.3</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The following new features have been added to the Driver Kit since Release 3.2:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The reservation of resources (such as I/O port ranges, interrupts, and so on) is now enforced by the kernel. This means that if your driver requests a resource in its <b>Default.table</b> that has been previously reserved, your driver will not be probed. A message will appear in the console reporting that the resource could not be reserved.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The <b>-setInterruptList:num:</b>, <b>-setChannelList:num:</b>, <b>-setPortRangeList:num:</b> and <b>-setMemoryRangeList:num:</b> methods can be used to change the resources reserved for your driver. The return type of these methods has changed from <b>void</b> to IOReturn, and the methods will return an error if the requested resources are not available.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Writing PCI and PCMCIA drivers is now supported. See the documentation for the IOPCIDirectDevice and IOPCMCIADirectDevice categories for more information.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The location for device drivers has changed. Drivers are now located in <b>/private/Drivers/</b><i>arch</i>, where <i>arch</i> is the architecture type for your computer (such as i386).</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Shared interrupts are now supported. See the &quot;Shared Interrupts&quot; section in Chapter 2, &quot;Designing a Driver,&quot; for more information.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">IOSCSIController supports indirect as well as direct device subclasses.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times"><b>driverLoader</b> now executes the post-load binary for boot drivers.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The Driver Kit documentation has been updated to reflect the latest API and document new features, such as shared interrupts and device auto detection. Chapters 1 through 4 have been revised and expanded to provide a fuller explanation of Driver Kit concepts, and Chapter 3 now contains information about writing specific types of drivers. A new appendix contains configuration file information and a reading list.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Known Problems</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The Configure application has this restriction:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=74></td>

<td nowrap><font face="Helvetica" size="-2">Reference:</font></td>

<td><font face="Times">46250</font></td></tr>

<tr valign=top>

<td width=74 height=17></td></tr>

<tr valign=top>

<td width=74></td>

<td nowrap><font face="Helvetica" size="-2">Problem:</font></td>

<td><font face="Times">Drivers cannot use C-style comments in <b>Default.table</b>.</font></td></tr>

<tr valign=top>

<td width=74 height=17></td></tr>

<tr valign=top>

<td width=74></td>

<td nowrap><font face="Helvetica" size="-2">Description:</font></td>

<td><font face="Times">The kernel ignores C-style comment delimiters (e.g. &#34;/*&#34; and &#34;*/&#34;) in driver string tables.</font></td></tr>

<tr valign=top>

<td width=74 height=17></td></tr>

<tr valign=top>

<td width=74></td>

<td nowrap><font face="Helvetica" size="-2">Workaround:</font></td>

<td><font face="Times">Don't use C-style comment delimiters in your driver's <b>Default.table</b>.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">There are some problems with adding help to a driver bundle that make it different from adding help to other kinds of projects.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">1.</font></td>

<td><font face="Times">To add help to a driver, put a valid help TOC file and the valid help files referenced in the TOC inside the driver bundle's <b><i>Drivername</i></b>.<b>config/Language.lproj/Help</b> folder.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">2.</font></td>

<td><font face="Times">The help files referenced in the TOC inside the driver bundle's <b><i>Drivername</i></b>.<b>config/Language.lproj/Help</b> folder must have unique names.&nbsp; No two drivers present on the system can have the same helpfile names.&nbsp; Helpfile names should contain some string that is unique to that driver, such as a particular brand name and model number. Next's convention for naming these files is to use the Long Name from the associated strings file with the spaces replaced with underbars.&nbsp; (i.e., Intel_824X0_PCI_Host_Bridge.rtfd)</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">3.</font></td>

<td><font face="Times">Don't use <b>compresshelp</b> or Project Builder's other help-building tools on the help files: If you index or compress the help files in the config bundle, they won't work.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">4.</font></td>

<td><font face="Times">You can't include links to other help files (such as an application's own help files) in a driver help file.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">5.</font></td>

<td><font face="Times">You can't use the help panel to find text in a driver's help file, unless you're already viewing the driver's help file. If you're viewing a driver help file, help-clicking doesn't work.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">6.</font></td>

<td><font face="Times">If you install a driver while <b>Configure</b> is running, the driver's TOC entries appear multiply and unreliably in Configure's TOC. If you quit and restart, it works OK.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Incompatible Changes</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The following incompatible changes have appeared since Release 3.2.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><b><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></b></font></td>

<td><font face="Times">You cannot initialize your driver with the <b>new</b> method, as in this statement:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=90 height=1><font face="Courier" size="-1">[&lt;object&gt; new];</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">You must use the <b>alloc</b> and <b>init</b> methods:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=90 height=1><font face="Courier" size="-1">[[&lt;object&gt; alloc] initWithDeviceDescription:&lt;descr&gt;];</font>

<p><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.2</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The following new features have been added to the Driver Kit since Release 3.1.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Writing SVGA drivers is now supported. See the IOSVGADisplay class specification for information.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Writing Token Ring drivers is now supported. See the IOTokenRing class specification for information.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Writing sound drivers is now supported. See the IOAudio class specification for information.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Loading drivers at boot time is now supported.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Standard makefiles now exist. Converting existing drivers to use the standard makefiles is described in the <b>README.rtf</b> file under <b>/NextLibrary/Documentation/NextDev/Examples/DriverKit/TestDriver</b>.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Many classes have changed slightly. Some of these changes are described under &quot;Incompatible Changes,&quot; below.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Known Problems</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The Configure application has this restriction:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=74></td>

<td nowrap><font face="Helvetica" size="-2">Reference:</font></td>

<td><font face="Times">37886</font></td></tr>

<tr valign=top>

<td width=74 height=17></td></tr>

<tr valign=top>

<td width=74></td>

<td nowrap><font face="Helvetica" size="-2">Problem:</font></td>

<td><font face="Times">Accessory views for custom inspectors must not exceed 80 pixels in height.</font></td></tr>

<tr valign=top>

<td width=74 height=17></td></tr>

<tr valign=top>

<td width=74></td>

<td nowrap><font face="Helvetica" size="-2">Description:</font></td>

<td><font face="Times">If you create an accessory view for a custom driver inspector used in Configure, your view must not exceed 80 pixels in height.</font></td></tr>

<tr valign=top>

<td width=74 height=12></td></tr>

<tr valign=top>

<td width=74></td>

<td nowrap><font face="Helvetica" size="-2">Workaround:</font></td>

<td><font face="Times">You can check the size using Interface Builder's Size inspector. Also, make sure the view is not resizable, that is, none of the springs are sprung in the inspector in Interface Builder.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Incompatible Changes</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The following incompatible changes have appeared since Release 3.1.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><b><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></b></font></td>

<td><font face="Times">You must recompile all Driver Kit drivers under 3.2--3.1 drivers will not load into 3.2 systems.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><b><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></b></font></td>

<td><img src="../Images/sp.gif" width=3 height=1><font face="Times">IOEthernet drivers need several changes before you can recompile them. These changes are described below.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times"><b>IOEthernet Changes</b></font>

<p><font face="Times">To convert a 3.1 Ethernet driver to a 3.2 Ethernet driver:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">1.</font></td>

<td><font face="Times">Add 2 instance variables to the subclass of IOEthernet</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=90 height=1><font face="Courier" size="-1">#import &lt;bsd/net/etherdefs.h&gt;</font>

<p><img src="../Images/sp.gif" width=90 height=1><font face="Courier" size="-1">@interface MyEthernetDriver:IOEthernet</font><br>
<img src="../Images/sp.gif" width=90 height=1><font face="Courier" size="-1">{</font><br>
<img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1">enet_addr_t&nbsp; myAddress;</font><br>
<img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1">IONetwork&nbsp;&nbsp; *network;</font>

<p><img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1"><i>/* Old</i></font><br>
<img src="../Images/sp.gif" width=125 height=1><font face="Courier" size="-1"><i>* instance</i></font><br>
<img src="../Images/sp.gif" width=125 height=1><font face="Courier" size="-1"><i>* variable</i></font><br>
<img src="../Images/sp.gif" width=125 height=1><font face="Courier" size="-1"><i>* list */</i></font><br>
<img src="../Images/sp.gif" width=90 height=1><font face="Courier" size="-1">}</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">2.</font></td>

<td><font face="Times">Change the driver's <b>initFromDeviceDescription:</b> implementation to match the following:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=90 height=1><font face="Courier" size="-1">- initFromDeviceDescription:(IODeviceDescription *)devDesc</font><br>
<img src="../Images/sp.gif" width=90 height=1><font face="Courier" size="-1">{</font><br>
<img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1">/* After this call, you should use [self name] to identify</font><br>
<img src="../Images/sp.gif" width=125 height=1><font face="Courier" size="-1">* the driver in any IOLog calls.*/</font><br>
<img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1">if ([super initFromDeviceDescription:devDesc] == nil)</font><br>
<img src="../Images/sp.gif" width=127 height=1><font face="Courier" size="-1">return nil;</font>

<p><img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1"><i>/* Initialize instance variables */</i></font>

<p><img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1"><i>/* Perform any cold-start driver initialization, which should</i></font><br>
<img src="../Images/sp.gif" width=125 height=1><font face="Courier" size="-1"><i>* include setting myAddress to the proper value.*/</i></font>

<p><img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1">IOLog(&#34;MyEthernetAdaptor at port %x irq %d\n&#34;,ioBase,irq);</font>

<p><img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1">/* Perform warm-start driver initialization. */</font><br>
<img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1">[self resetAndEnable:NO];</font>

<p><img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1">/* Inform my superclass of my address and cache the id of the</font><br>
<img src="../Images/sp.gif" width=125 height=1><font face="Courier" size="-1">* IONetwork object it creates for me. myAddress must be set</font><br>
<img src="../Images/sp.gif" width=125 height=1><font face="Courier" size="-1">* to the hardware address before this call is made. */</font><br>
<img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1">network = [super attachToNetworkWithAddress:myAddress];</font>

<p><img src="../Images/sp.gif" width=118 height=1><font face="Courier" size="-1">return self;</font><br>
<img src="../Images/sp.gif" width=90 height=1><font face="Courier" size="-1">}</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">3.</font></td>

<td><font face="Times">Remove all references to IOEthernet's <b>netif</b> instance variable, which is no longer accessible. You should now use your own network instance variable and set it to the value returned by the <b>attachToNetworkWithAddress:</b> method.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">4.</font></td>

<td><font face="Times">Remove all references to IOEthernet's <b>ethernetAddress</b> instance variable, which is no longer accessible. You should now use your own <b>myAddress</b> instance variable instead.</font></td></tr>

<tr valign=top>

<td width=72 height=18></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">5.</font></td>

<td><font face="Times">Implement <b>resetAndEnable:</b> to perform warm-start initialization for your driver. For 3.2, you'll need to call <b>setRunning:</b> inside your <b>resetAndEnable:</b> method.</font></td></tr>

<tr valign=top>

<td width=72 height=18></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times">6.</font></td>

<td><font face="Times">See the IOEthernet documentation for a description of the new API for implementing multicast addresses and promiscuous mode.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.1</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">Release 3.1 is the first release to contain the Driver Kit. Using the Driver Kit, you can write drivers for Intel-based computers running NeXTSTEP.</font>

<p><font face="Times"><b>Note:</b> Driver Kit isn't supported for 680x0-based systems.</font>

<p><font face="Times">Documentation for the Driver Kit is available in <b>/NextLibrary/Documentation/NextDev/OperatingSystem/Part3_DriverKit</b>. A simple example of building, loading, and debugging a Driver Kit driver is under <b>/NextLibrary/Documentation/NextDev/Examples/DriverKit</b>.</font>

<p><font face="Times">The <b>Concepts</b> directory under <b>OperatingSystem/Part3_DriverKit</b> contains information about the Driver Kit as a whole (Chapter 1), as well as some preliminary details on driver writing issues (Chapter 2). It also contains some information on building and configuring drivers (Chapter 4). Chapter 3 is missing; in the future, it'll contain information about writing specific types of drivers, such as drivers for ethernet cards and drivers for graphics cards.</font>

<p><font face="Times">The <b>Reference</b> directory has documentation for most of the core Driver Kit classes, protocols, and functions. The classes and protocols that aren't documented (many of which currently have header files under <b>bsd/dev</b> and <b>bsd/if</b>) are likely to have API changes (for example, class and method names are likely to change).</font></td></tr>

</table>



<p>

</body>
</html>
