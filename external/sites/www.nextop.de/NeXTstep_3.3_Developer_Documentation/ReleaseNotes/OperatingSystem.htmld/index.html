<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/ReleaseNotes/OperatingSystem.rtf -->
<!-- Date: Sun Jun 28 20:13:55 1998 -->
<head>
<title>OperatingSystem</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Release 3.3 Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">3.3 Release Notes:</font><br>
<font face="Times" size="+1">Operating System</font>

<p><br><br><br>

<p><font face="Times">This file contains release notes for the 3.2, 3.1, and 3.0 releases of the operating system. There were no changes for Release 3.3. Items specific to or introduced in Release 3.2 are listed first, followed by the 3.1 and 3.0 notes.&nbsp; Some information that would be useful to users or administrators has been moved to <b>/NextLibrary/Documentation/NextAdmin/ReleaseNotes/OperatingSystem.rtf</b>.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.2</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The following new features have been added to the operating system since Release 3.1.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Building POSIX applications is now supported.&nbsp; To compile POSIX 1003.1 conforming source, specify the <b>-posix</b> flag to <b>cc</b>.&nbsp; Note that POSIX kernel interfaces are not supported for NEXTSTEP applications.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Known Problems</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The following bugs have appeared since Release 3.1.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference:</font></td>

<td><font face="Times">37706</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem:</font></td>

<td><font face="Times"><b>siglongjmp</b> is not POSIX conforming under NEXTSTEP for Intel Processors</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description:</font></td>

<td><font face="Times"><b>setsigjmp</b>/<b>siglongjmp</b> offers the option of not restoring the signal mask when the long jump occurs.&nbsp; On Intel systems, the signal mask is always restored.</font></td></tr>

<tr valign=top>

<td width=97 height=12></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Workaround:</font></td>

<td><font face="Times">None.</font></td></tr>

<tr valign=top>

<td width=97 height=34></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference:</font></td>

<td><font face="Times">37707</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem:</font></td>

<td><font face="Times">On NEXTSTEP for Intel, the serial driver doesn't notify the tty driver of parity errors</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description:</font></td>

<td><font face="Times">It needs to do this for POSIX compatibility.</font></td></tr>

<tr valign=top>

<td width=97 height=12></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Workaround:</font></td>

<td><font face="Times">None.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Bugs Fixed in Release 3.2</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">These bugs have been fixed in Release 3.2:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference:</font></td>

<td><font face="Times">36695, 36696</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem:</font></td>

<td><font face="Times">The <b>zs</b> driver didn't return proper error codes with incorrect ioctls or certain line disciplines</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description:</font></td>

<td><font face="Times">Improper return of OK status codes by the <b>zs</b> driver caused various problems with programs attempting to use it.&nbsp; This has been fixed.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.1</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The following new features have been added to the operating system since Release 3.0.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Support for Intel hardware.&nbsp; See the Driver Kit release note for information on writing drivers for Intel hardware.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Two new Mach virtual memory functions, <b>vm_deactivate()</b> and <b>vm_set_policy()</b>.&nbsp; See the Mach operating system documentation for information about these functions.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The tty driver has been rewritten to support all features required for POSIX 1003.1.&nbsp; While the termios interface defined by POSIX is not available to non-POSIX applications, all features of the driver can be used through the ioctl interface.&nbsp; See the header files <b>sys/ioctl.h</b> and <b>sys/termios.h </b>(under <b>/usr/include/bsd</b>) and the <b>termios</b>(4p) man page for information about these features. Also, the tty driver now handles special characters properly, allowing 8-bit input characters and 8-bit special characters.&nbsp; A special character is disabled by setting it to 0xff.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Known Problems</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The following bug has appeared since Release 3.0.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference:</font></td>

<td><font face="Times">34051</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem:</font></td>

<td><font face="Times">On Gateway PCs, leaving the NMI mini-monitor can cause the keyboard to hang.</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description:</font></td>

<td><font face="Times">Entering the mini-monitor with Alt-Num Lock and hitting 'n' to continue will hang the keyboard on the second or third try.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">In Release 3.1, building POSIX applications isn't supported.&nbsp; POSIX will be supported in a future release.</font>

<p><font face="Times">In Release 3.1, the behavior of the new tty driver may differ from what is expected in a number of ways:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The tty driver now uses some of the higher bits (above the low byte) to encode framing and parity error conditions. In the event that a device driver passes an 8-bit character that is then sign extended, this might be a problem.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">In pty packet mode, only the state associated with the old interface is passed in a TIOCPKT_IOCTL packet.&nbsp; Additional state associated with the new driver is ignored.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Using both old and new ioctls from the same application can lead to unexpected behavior.&nbsp; In general, old ioctls should override the behavior of new ones, though not all cases have been tested.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Output delays are disabled when character size is 8 bits.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The original tty driver recognized certain input special characters (e.g., ^Z, ^W) only in the new-tty line discipline. This is no longer the case.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Output delays are disabled when character size is 8 bits ((c_flag &amp; CSIZE) == CS8).</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The break condition used to be translated (by the device driver) into an interrupt character.&nbsp; It is now implemented differently, with the effect that the action does not depend on the existence of an interrupt character (which can be undefined), or on the</font><br>
<font face="Times">flag NOFLSH.&nbsp; It also no longer echoes the interrupt character.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Bugs Fixed in Release 3.1</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">These bugs have been fixed in Release 3.1:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference:</font></td>

<td><font face="Times">26111</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem:</font></td>

<td><font face="Times">Tty doesn't always open and close properly</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description:</font></td>

<td><font face="Times">A bug in the tty driver sometimes prevents a program from closing and then and re-opening a device.</font></td></tr>

<tr valign=top>

<td width=97 height=34></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">28909</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Mach threads are not recovered under certain circumstances.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">Mach threads are not recovered under certain circumstances (such as using telnet in a particular way). The threads appear as &lt;mach-task&gt;s in a ps listing apparently owned by <b>root</b> and have a process id of -1. Letting these task proliferate can eventually lock the Workspace. Killing these tasks can hang the machine. The bug appears to be induced by the use of select on asynchronous media.</font></td></tr>

<tr valign=top>

<td width=97 height=34></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference:</font></td>

<td><font face="Times">31114</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem:</font></td>

<td><font face="Times">The 3.0 serial driver doesn't handle the new baud rates properly</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description:</font></td>

<td><font face="Times">When some new baud rates were added for 3.0, all the related tables were not updated which causes problems at the new baud rates.</font></td></tr>

<tr valign=top>

<td width=97 height=34></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference:</font></td>

<td><font face="Times">31270</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem:</font></td>

<td><font face="Times">Incorrect handling of writeback data on memory exceptions</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description:</font></td>

<td><font face="Times">On the 040 the kernel needs to retry writes after a user level exception handler fixes a page fault (due to the 040 exception continuation model).&nbsp;&nbsp; The kernel also needs to properly handle page faults that occur during handling of the 040 &#34;writeback&#34; registers.</font></td></tr>

</table>

<p><br><br><br><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.0</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">These notes were included with the Release 3.0 version of the operating system.&nbsp;&nbsp; Sections that are no longer relevant have been marked with an italicized comment.</font>

<p><font face="Times">This file contains information about the following topics:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Additional features in the Mach Interface Generator (MiG)</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">A new location for <b>errno</b></font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The obsolescence of a Bootstrap Server function</font></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Enhancements to the sg (SCSI generic) driver</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+1"><b>Mach Interface Generator (MiG)</b></font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The following are new features that have been added to MiG since Release 2.0.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">MiG now supports the <b>-sheader</b> option to make a header file suitable for inclusion in servers is generated.&nbsp; This includes server-side names for routines as well as the <i>_server()</i> procedure prototype.&nbsp; The header file is ifdefed using the format <i>(&#34;_%s%s&#34;, ServerPrefix, SubsystemName); </i>this means that server-header files and user-header files are mutually exclusive if <i>ServerPrefix == UserPrefix</i> or there is neither <i>ServerPrefix</i> nor <i>UserPrefix</i>.</font></td></tr>

<tr valign=top>

<td width=71 height=17></td></tr>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">MiG now supports send timeouts.&nbsp; Send timeouts are simmilar to wait timeouts, except they pertain to the msg_send side of an RPC.&nbsp; They can be used in the same way as the <i>WaitTime</i> keyword to specify a <i>SND_TIMEOUT</i> option to a <i>msg_send</i> or <i>msg_rpc</i> either from an argument to the function or as a global for the interface.</font></td></tr>

<tr valign=top>

<td width=71 height=17></td></tr>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">MiG will optionally generate a handler style interface in place of a server style interface.&nbsp; This is the mechanism prefered by the kernel loader.&nbsp; Specifying the <b>-handler</b> argument in place of the <b>-server</b> argument will cause a handler interface to be generated into the specified file name.&nbsp; This will also modify the behavior of the <b>-sheader</b> file to reflect the handler interface.</font></td></tr>

<tr valign=top>

<td width=71 height=17></td></tr>

<tr valign=top>

<td width=71></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">MiG outputs maximum Request/Reply message sizes in the server header file.&nbsp; This can be used in servers to preallocate the appropriate input or output message buffers.</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+1"><b>New Location of Errno</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The extern declaration of <b>errno</b> has moved from <b>&lt;stddef.h&gt;</b> to <b>&lt;errno.h&gt;</b> (under the <b>ansi</b> directory of <b>/NextDeveloper/Headers</b>).&nbsp; The change was made to conform to the ANSI definition.</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+1"><b>Bootstrap Server Functions</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The <b>bootstrap_get_unpriv_port()</b> function is obsolete.&nbsp; You should use <b>bootstrap_subset()</b> instead.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+1"><b>Generic SCSI Driver</b></font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The sg driver has been enhanced to control up to 4 devices, at /dev/sg[0123].&nbsp; Previously, it could handle only one open device at a time.&nbsp; See the sg(4) man page for more information.</font></td></tr>

</table>

<p><br><br><br>

<p><font face="Times" size="+1"><b>Known Problems</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">In the&nbsp; 2.0/2.2/3.0 system the setuid/setruid/seteuid, and setgid/setrgid/setegid system calls are not thread safe. If one thread is performing file system activity such as a stat(), open(), link(), access()...&nbsp; which use the credentials structure, and one of the setuid() calls is made in a second thread, there is the potential to corrupt the system and cause a panic.&nbsp; To avoid this, implement thread-locking so that calls to procedures which change credentials (setuid(), setruid(), etc.) cannot overlap calls which reference the credentials structure (e.g. file system access routines).</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">In the case where a program is executed on a client machine and then rebuilt on a server, if the program is immediately executed on the client after the build, the changes may not be seen due to caching of data on the client side.&nbsp; To avoid this, re-exec the program, as there is a timeout for cached NFS file attributes.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">If a file is being written on client A, and read on client B, changes appended to the file from client A after client B opens the file will not be seen by client B.&nbsp; This is only true for the read() system call.&nbsp; Changes can be seen if the file is remapped via the map_fd() system call.&nbsp; Use map_fd(), and check for changes to the file via fstat().&nbsp; If the file has changed, remap.</font></td></tr>

</table>



<p>

</body>
</html>
