<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<!-- Created with LatinByrd III -->
<!-- File: /Apps/NextDev/ReleaseNotes/WindowServer.rtf -->
<!-- Date: Sun Jun 28 20:14:01 1998 -->
<head>
<title>WindowServer</title>
</head>

<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" alink="#FF00FF" vlink="#FF0000">

<basefont size=3>

<p><font face="Times" size="-1">Release 3.3 Copyright</font> <font size="-1">&copy;</font><font face="Times" size="-1">1995 by NeXT Computer, Inc.&nbsp; All Rights Reserved.</font>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times" size="+1">3.3 Release Notes:</font><br>
<font face="Times" size="+1">Window Server</font>

<p><br><br><br><br>

<p><font face="Times">This file contains release notes for the 3.3, 3.2, 3.1, and 3.0 releases of the Window Server. Items specific to the 3.2 release are listed first, and the Release 3.1 and 3.0 notes follow. There are no items specific to the 3.3 release.</td></tr>

</table>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.2</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features in 3.2</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The performance of various imaging and window-moving operatations have been improved for both Motorola and Intel implementations of NEXTSTEP. Among these improvements are the following:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">In 16-bit color windows, a <b>compositerect</b> operation of type <b>Sover</b> is 4 times faster when the color isn't dithered (that is, when the premultiplied RGBA components are each exactly expressible in 4 bits).</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">8-bit grayscale <b>Sover</b>'ing now avoids multiplications when the source alpha is 0 or 1. Performance of both 8-bit grayscale and 16-bit <b>Sover</b>'ing have been improved.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Window-dragging of buffered windows is now done by copying from the backing store to the screen (DRAM&#160;-&gt;&#160;VRAM) rather than from screen to screen (VRAM&#160;-&gt;&#160;VRAM). This improves window dragging performance on systems with slow VRAM access times.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">8-bit and 16-bit identity case imaging operations are now faster.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Overall performance of 32-bit color drawing has been improved.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Bugs Fixed in Release 3.2</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">These bugs have been fixed in Release 3.2:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">37336</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Meshed 8-bit grayscale images with transparency were improperly displayed.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">On 8-bit grayscale or 24-bit color NEXTSTEP systems, images defined as meshed 8-bit grayscale displayed incorrectly if they had any transparency.</font></td></tr>

<tr valign=top>

<td width=97 height=36></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">36064</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times"><b>readimage</b> didn't work properly on 32-bit color windows on the i386 architecture.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">The value returned by <b>readimage</b> on an i386 NEXTSTEP system would return non-byteswapped data if used on a 32-bit color window.</font></td></tr>

</table>

<p><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.1</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New Features in 3.1</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The rendering algorithm for DeviceCMYK colors on RGB devices has been improved.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>setcmykadjust</b></font></td>

<td><font face="Times"><i>boolean</i> <b>setcmykadjust</b> -</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">When set to true, <b>setcmykadjust</b> invokes an enhanced algorithm for rendering /<b>DeviceCMYK</b> colors on an RGB device.&nbsp; This algorithm is computationally more expensive that the simple algorithm in the Red Book, but results in greater accuracy for publishing applications.&nbsp;&nbsp; Similar to <b>setstrokeadjust</b>, the current value of <b>setcmykadjust</b> is stored in the graphics state.</font></td></tr>

<tr valign=top>

<td width=36 height=18></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">When <b>setcmykadjust</b> is active, the behavior of <b>currentcmykcolor</b>, <b>currentgray</b>, <b>currentrgbcolor</b>, and <b>currenthsbcolor</b> changes so that any conversions in or out of the <b>DeviceCMYK</b> colorspace on behalf of these operators produces a result which if passed to the appropriate <b>...setcolor</b> operator yields a visually identical color.&nbsp; In other words, <b>current...color</b> followed by <b>set...color</b> should not change the visual appearance of the current color .&nbsp; In certain cases, however, an identical match is not possible. For example, <b>currentcmykcolor</b> may not be able to return a visually identical cmyk color if the current color has been specified in the <b>DeviceRGB</b> colorspace.&nbsp; This is because some <b>DeviceRGB</b> colors will fall outside of the gamut of the <b>DeviceCMYK</b> approximation used by <b>setcmykadjust</b>.&nbsp;&nbsp; In these cases,&nbsp; <b>currentcmykcolor</b> returns a reasonably similar color.</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times"><b>cmykadjust</b> normally defaults to true for windowdevices. However, this can be overiden on a per-context basis by using the <b>setdefaultcmykadjust</b> operator.</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>currentcmykadjust</b></font></td>

<td><font face="Times">- <b>currentcmykadjust</b> <i>boolean</i></font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times"><b>currentcmykadjust</b> returns a boolean indicating whether or not&nbsp; cmyk adjustment is active for the current graphics state.</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>setcmykadjustparams</b></font></td>

<td><font face="Times"><i>[ Cr Cg Cb Mr Mg Mb Yr Yg Yb Rr Rg Rb Gr Gg Gb Br Bg Bb ]</i></font><br>
<font face="Times"><i>gamma</i> <b>setcmykadjustparams -</b></font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">The cmyk to rgb algorithm invoked by <b>setcmykadjust</b> is based on a simple six color Neugebauer approximation.&nbsp; This approximation uses as parameters the rgb color specifications for cyan ink, magenta ink, yellow ink, magenta+yellow ink together (red), cyan+yellow ink together (green),&nbsp; and cyan+magenta ink together (blue).&nbsp; These colors are specified in the array argument such that the rgb equivalent of Cyan ink is given by <i>(Cr, Cg, Cb)</i>, etc.&nbsp; <i>gamma </i>allows for compensation for nonlinearities in ink coverage; i.e. a&nbsp; cyan tint of value <i>c</i> is assumed to cover a fraction <i>c^gamma</i> of the paper<i>.</i></font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">The default values for these parameters are equivalent to:</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">[</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=240></td>

<td nowrap><font face="Times">0.00784314</font></td>

<td nowrap><font face="Times">0.309804</font></td>

<td><font face="Times">1.0</font></td></tr>

<tr valign=top>

<td width=240></td>

<td nowrap><font face="Times">1.0</font></td>

<td nowrap><font face="Times">0.0</font></td>

<td><font face="Times">0.160784</font></td></tr>

<tr valign=top>

<td width=240></td>

<td nowrap><font face="Times">1.0</font></td>

<td nowrap><font face="Times">0.811765</font></td>

<td><font face="Times">0.0</font></td></tr>

<tr valign=top>

<td width=240></td>

<td nowrap><font face="Times">1.0</font></td>

<td nowrap><font face="Times">0.0</font></td>

<td><font face="Times">0.0</font></td></tr>

<tr valign=top>

<td width=240></td>

<td nowrap><font face="Times">0.0</font></td>

<td nowrap><font face="Times">0.294118</font></td>

<td><font face="Times">0.0156863</font></td></tr>

<tr valign=top>

<td width=240></td>

<td nowrap><font face="Times">0.0901961</font></td>

<td nowrap><font face="Times">0.0</font></td>

<td><font face="Times">0.164706</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=216></td>

<td><font face="Times">] 0.5 setcmykadjustparams</font>

<p><font face="Times">which provides a reasonable approximation for the inks used in the NeXT Color Printer as well as the C.E.I. standard inks.</font>

<p><font face="Times">These parameters are global to the PostScript interpreter, shared by all contexts.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>currentcmykadjustparams</b></font></td>

<td><font face="Times"><i>array</i> <b>currentcmykadjustparams</b> <i>array gamma</i></font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">Returns the current parameters for the Neugebauer approximation used by <b>setcmykadjust.</b>&nbsp; <i>array</i> must be of length 18, and is filled with the rgb components of the six ink colors (see <b>setcmykadjustparams</b>).</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>setdefaultcmykadjust</b></font></td>

<td><font face="Times"><i>boolean</i> <b>setdefaultcmykadjust</b> -</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">Sets the default value of cmykadjust for the context in which it is issued.&nbsp; When set to <i>true</i>, all windows will default to having cmyk adjustment active.&nbsp; The default value of this default is <i>true</i> for new contexts.</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>currentdefaultcmykadjust</b></font></td>

<td><font face="Times"><b>- currentdefaultcmykadjust</b>&nbsp; <i>boolean</i></font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">Returns the current default setting of cmykadjust for the context.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Bugs Fixed in Release 3.1</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">These bugs have been fixed in Release 3.1:</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">30925</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Disk space leak when aborting print jobs.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">When print jobs prematurely aborted (due to an error, for example), PostScript was not cleaning up all references to the spooled data.</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">30866</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Readimage on a small color window returns garbage alpha.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">Pixel values from screen are now correctly stuffed with opaque alpha.</font></td></tr>

<tr valign=top>

<td width=97 height=24></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">30784</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Certain Level 2 patterns can crash the WindowServer.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">Level 2 patterns that render&nbsp; 2bit image data in their <b>/PaintProc </b>procedure would&nbsp; sometimes cause DPS to crash .</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">30695</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Type 2 imaging problems.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">In certain cases, type 2 ( i.e. window-to-window) imaging&nbsp; from a 2bit source to a 2bit partially-obscured destination would cause rendering errors.</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">30661</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Too many patterns.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">Heavy pattern usage could cause the pattern caching machinery to get confused.&nbsp; The net result would be that drawing with `older' patterns&nbsp; (i.e. patterns least recently created) would have no effect.</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">30564</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Grayscale image rendering on NeXT Laser Printer.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">Rendering certain 8bit images for printing on the 400dpi NeXT Laser Printer would crash the WindowServer.</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">30447</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">WindowServer doesn't timeshare User and Printer well.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">PostScript contexts involved in printing&nbsp; are now completely starved from execution as long as another context is runnable. This results in improved responsiveness of the UI during printing.</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">30146</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">2bit imaging problems.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">When imaging a 2 bit image into a 2 bit window with alpha, where the current alpha is not one, the resulting image would be corrupted.</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">29472</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">NXImageBitmap not clipped properly.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">If an NXImageBitmap was to be completely clipped, then no clipping was being done.</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">28901</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Crash when printing a dvips output file.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">Certain Tek generated dvips files would cause the WindowServer to crash.</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">22307</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Image don't respect the Decode array.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">Many cases of Level 2 imaging did not respect the `Decode' array entry in the image dictionary.</font></td></tr>

<tr valign=top>

<td width=97 height=17></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Reference</font></td>

<td><font face="Times">22021</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Problem</font></td>

<td><font face="Times">Documents print as black rectangles.</font></td></tr>

<tr valign=top>

<td width=97 height=10></td></tr>

<tr valign=top>

<td width=97></td>

<td nowrap><font face="Helvetica" size="-2">Description</font></td>

<td><font face="Times">Occasionally documents would print as black rectangles on the NeXT Laser Printer.</font></td></tr>

</table>

<p><br><br><br><br><br>

<p><font face="Times" size="+1"><b>Notes Specific to Release 3.0</b></font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">These notes were included with the Release 3.0 version of the Window Server. Sections that are no longer relevant have been marked with an italicized comment.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Major New Features in 3.0</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The following new features have been added to the Window Server since Release 2.1.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">PostScript Level 2</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap></td>

<td><font face="Times">The NEXTSTEP 3.0 Window Server encorporates PostScript Level 2 from Adobe. This includes many extensions to the PostScript Language that have always been in Display PostScript, but also includes a number of new features such as</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap></td>

<td><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3> device independent color</font><br>
<font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3> patterns and forms</font><br>
<font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3> filters</font><br>
<font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3> setpagedevice</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap></td>

<td><font face="Times">For further information, consult the latest version of the PostScript Language Reference Manual (aka the <i>new</i> red book), published by Addison Wesley.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Device Independent Color in NEXTSTEP 3.0</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap></td>

<td><font face="Times">NEXTSTEP 3.0 contains enhancements to support device independent color.&nbsp; We have standardized on a calibrated RGB colorspace.&nbsp; All modes of the Application Kit's ColorPanel (except CMYK) now emit device independent colors.&nbsp; This means that applications using the Color Panel in conjuction with <b>NXSetColor() </b>will take full advantage Level 2 color when printing on PostScript Level 2 devices, including NeXT's new Color BubbleJet printer.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Device Independent Color Details</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td><font face="Times"><b>NXCalibratedRGB Color Space</b></font>

<p><font face="Times">The calibrated color space we have chosen matches the specifications of the standard NeXT MegaPixel Color Display.&nbsp; This color space is based on the CCIR Rec 709 phosphor set, balance to a white point of D65.&nbsp; This corresponds to CIE chromaticities of :</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=223></td>

<td nowrap><font face="Times">x</font></td>

<td><font face="Times">y</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=144></td>

<td nowrap><font face="Times">Red</font></td>

<td nowrap><font face="Times">.640</font></td>

<td><font face="Times">.330</font></td></tr>

<tr valign=top>

<td width=144></td>

<td nowrap><font face="Times">Green</font></td>

<td nowrap><font face="Times">.300</font></td>

<td><font face="Times">.600</font></td></tr>

<tr valign=top>

<td width=144></td>

<td nowrap><font face="Times">Blue</font></td>

<td nowrap><font face="Times">.150</font></td>

<td><font face="Times">.060</font></td></tr>

<tr valign=top>

<td width=144></td>

<td nowrap><font face="Times">White</font></td>

<td nowrap><font face="Times">.3127</font></td>

<td><font face="Times">.3290</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td><font face="Times">Because <b>NXCalibratedRGB</b> is closely related to colorimetry of NeXT monitors, chosing this color space gains the advantage of calibrated color, while sacrificing little if any performance for interactive rendering on the display.</font>

<p><font face="Times">The kit function <b>NXSetColor</b>() now uses a new operator <b>nxsetrgbcolor</b> to set its color when in any modes other than CMYK.&nbsp; <b>nxsetrgbcolor</b> and <b>nxsetgray</b> are defined as:</font>

<p><font face="Times">/nxsetrgbcolor { NXCalibratedRGBColorSpace setcolorspace setcolor } bind def</font><br>
<font face="Times">/nxsetgray&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { NXCalibratedRGBColorSpace setcolorspace dup dup setcolor } bind def</font>

<p><font face="Times">Note because the color space in Level 2 is implicitly changed by any of the Level I color operators (i.e. setrgbcolor, setgray) <b>setcolorspace</b> must be called explicitly each time the color is set.</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Spot Color</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap></td>

<td><font face="Times">Spot color in PostScript refers to the color of fills, strokes, and characters (everything except sampled images).&nbsp; In NEXTSTEP documents, these attributes are typically controlled via <b>NXColor</b>s and the Color Panel.&nbsp; Because of the changes detailed above, these documents will now automatically inherit calibrated color.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap></td>

<td><font face="Times">Spot Color can also be calibrated through the use of the Pantone Color support in 3.0.&nbsp; Pantone colors have the advantage working on Level 1 devices as well.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Sampled Images</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap></td>

<td><font face="Times">Sampled images in NEXTSTEP are typically stored in TIFF files and drawn by the <b>NXBitmapImageRep</b> object.&nbsp; RGB TIFF files will be assumed to be in the <b>NXCalibratedRGBColorSpace</b> color space.&nbsp; To insure interactive performance to the screen images are rendered to the screen in <b>DeviceRGB</b> colorspace and to the printer in <b>CalibratedRGB</b> by default.&nbsp; To render images to the screen using a calibrated color space, the application writer is responsible for setting up the current colorspace using</font> <font face="Courier"><b>NXDrawBitmap()</b></font> <font face="Times">with the </font><font face="Courier"><b>NX_CustomColorSpace</b></font> <font face="Times">option.&nbsp; Currently <b>NXBitmapImageRep</b> does not asupport the TIFF WhitePoint, PrimaryChromaticies, Gamma, and ColorResponseCurves, although this will occur in future releases of NEXTSTEP.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3> Color Rendering Dictionaries:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td><font face="Times">The Color Rendering dictionary <b>NXCalibratedRGB</b> is pre-defined in <b>globaldict</b>. This rendering dictionary defines the corresponding color rendering for the <b>NXCalibratedRGB</b> color space.&nbsp; The concatination of the <b>NXCalibratedRGB </b>color space and the <b>NXCalibratedRGB</b> color rendering dictionary results in the identity transformation.&nbsp; This allows the PostScript to optimize its calculation so that rendering with <b>NXCalibratedRGB</b>&nbsp; to the screen is as fast as rendering <b>DeviceRGB.</b></font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3> Resources</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=90></td>

<td><font face="Times">PostScript Level 2 supports a generalized resource scheme by which PostScript programs can refer to resources by name, as opposed to containing an entire definition of the resource.&nbsp; This is a generalization of the <b>definefont</b>/<b>findfont </b>mechanism.&nbsp;&nbsp; For full details, see the RedBook2.&nbsp; Resources exist on the <i>%resource%</i> device.&nbsp; On the NeXT, we search in three places for resources: ~/Library/PS2Resources/<i>category</i>, /LocalLibrary/PS2Resources/<i>category</i>,&nbsp; and ~/NextLibrary/PS2Resources/<i>category</i>.&nbsp; <i>category</i> is one of the regular or implicit resource categories defined in the RedBook2 on page 88.&nbsp; The following resources are installed in /NextLibrary/PS2Resources:</font>

<p><font face="Times">ColorRendering/NXCalibratedRGB</font><br>
<font face="Times">ColorSpace/NXCalibratedRGB</font><br>
<font face="Times">Patterns/NX_MediumGray</font><br>
<font face="Times">Patterns/NX_DarkGray</font><br>
<font face="Times">Patterns/NX_LightGray</font>

<p><font face="Times">Many of the predefined names which use these resources do so in a lazy manner. For example, the definition of <b>NX_MediumGrayPattern</b> is</font><br>
<img src="../Images/sp.gif" width=3 height=1><font face="Times">globaldict /NX_MediumGrayPattern {</font><br>
<img src="../Images/sp.gif" width=54 height=1><font face="Times">/NX_MediumGray /Pattern findresource</font><br>
<img src="../Images/sp.gif" width=54 height=1><font face="Times">matrix makepattern dup /NX_MediumGrayPattern exch store</font><br>
<font face="Times">} put</font>

<p><font face="Times">This loads the resource into VM upon first reference, and then rebinds the name to the actual instantiation of the pattern resource.</font>

<p><font face="Times">You can search for available resources with the <i>%resource%</i> device.&nbsp; For example,</font><br>
<img src="../Images/sp.gif" width=54 height=1><font face="Courier" size="-1">(%resource%Pattern/*) {==} 1024 string filenameforall</font><br>
<font face="Times">prints a list of all the files which define patterns.&nbsp; Of course, you can also do</font><br>
<img src="../Images/sp.gif" width=54 height=1><font face="Courier" size="-1">(*) {==} 1024 string /Pattern resourceforall</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Level 2 Caveats:</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">This section attempts to clarify some of the interaction between NeXT's DPS extensions and the new features in Level 2.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Alpha (transparency) is possible in Level 2 patterns, however these patterns are not portable to other PostScript implementations and the performance may not be as fast as if the pattern were opaque.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">It is not currently possible to use alpha in a Level 2 indexed color space.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">the window promotion logic has been extended in the following way to incorporate new level 2 features:&nbsp; Colored patterns promote windows as though the PaintProc were merely executed. Images in the CIEBasedA or CIEBasedABC colorspace (regardless of bit-depth) will promote the window as though an eight-bit per channel DeviceGray&nbsp; or DeviceRGB (respectively) image were drawn.&nbsp; Any image drawn in an Indexed colorspace will promote the window as though an eight-bit per channel DeviceGray or DeviceRGB image were drawn depending on the number of components in the underlying colorspace.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">since windowdevices can either be color or monochrome depending on their bit-depth, the semantics of color-rendering dictionaries on monochrome windows is changed slightly to include an implicit NTSC luminance sum&nbsp; (<i>gray</i> = .3*<i>red</i> + .59*<i>green</i> + .11*<i>blue</i>) as the last step.&nbsp; This means that the same three-channel color rendering rendering dictionary&nbsp; (by default <b>NXCalibratedRGBRendering</b>) can be used for a window regardless of its promotion state.&nbsp; Monochrome color rendering dictionaries for printer devices behave as documented in the Red Book.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>Changes</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td><font face="Times">The following changes have been made to the Window Server since Release 2.1.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Windows mistakenly promoted to 24 bits per pixel when rendering a 12 bit RGB image.&nbsp; This has been fixed to correctly promote only to 12 bits per pixel.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">Performing a PlusD <b>compositerect</b> in an 8 bit window didn't work properly.&nbsp; This has been fixed.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">On NeXTdimension, any color image being rendered into a 2 bit window didn't work.&nbsp; This has been fixed. (This was rarely seen unless the window was explicitly limited to 2-bits).</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">The <b>image</b> operator has been optimized in the case of&nbsp; rectilinear scaling, with the addition of special case scaling code when the source and destination are the same pixel depth and no transfer function is in effect.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times"><b>readimage</b> is no longer the most efficient way to read the bits <b>from</b> a window into an application.&nbsp; A new optimized pathway is available using the AppKit function <b>NXReadBitmap(),</b> (or, preferably, the <b>NXBitmapImageRep</b> object) which uses efficient Mach out-of-band messaging.&nbsp; <b>readimage</b> will continue to be support for backwards compatibility.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">out-of-band images which are passed <b>into</b> the window server (rendered via <b>NXDrawBitmap()</b>, or the <b>NXImageBitmapRep</b> object) can now have arbitrary <b>`rowBytes'</b>.&nbsp; This means that the pixels to be imaged need not be tightly packed into scanlines.&nbsp; This allows sub-regions of a bitmap stored on the client side to be passed to the window server without reformatting.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">out-of-band images passed <b>into</b> the window server are now allowed to pack non-alpha image data on natural machine-word boundaries.&nbsp; In particular 12 bit RGB data can be passed in 16 bit pixels (the alpha nibble MUST BE SET to 0xF). Similarly,&nbsp; 24bit non-alpha data can be passed in 32 bit RGB pixels (the alpha byte MUST BE SET to 0xFF).&nbsp; This allows applications to store rasters in a more natural way for their own processing, and minimizes the need for reformatting the data to pass to the window server for display.&nbsp; This capability is available through the AppKit's <b>NXDrawBitmap()</b> function</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">On the 68040 processor, we have improved the performance of the <b>image</b> operator in the case of unpacked 12 bit RGB data imaged (with the identity transform) into a 16 bit window.&nbsp; In order to take advantage of this performance improvement, your source data must be short-aligned (guaranteed if you malloc your source buffer) and its rowbytes must be a multiple of 4 (you can easily insure this if you are generating the source data and rowbytes yourself).&nbsp; In this case, a 400x400 image should take 55-60ms on a 25Mhz NeXTstation Color.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times">There is an additional performance gain above and beyond that mentioned above for an even more strict set of alignment restrictions:&nbsp; Your source data pointer is cacheline-aligned (16 byte aligned) with the destination data pointer that it will be written into and your source rowbytes modulo 16 equals the destination buffer rowbytes modulo16.&nbsp; Since your application cannot know the data pointer alignment of a buffered window, this is very difficult when imaging into a buffered window.&nbsp; But, if you are imaging into a retained window, the destination data pointer modulo 16 equals the x coordinate on screen multiplied by 2, and the rowbytes of the destination == 0 modulo 16.&nbsp; So, if you image into a retained window and align the address of the beginning of your source buffer to match the twice x coordinate (modulo 16) that it will be imaged to on the screen, and you make its rowbytes a multiple of 16 (to match the 0 modulo 16), then your image data will be copied to the screen in the fastest way possible (using the move16 instruction newly available on the 040).&nbsp; For large images this is 45% faster than case (4).&nbsp; In this case, a 400x400 image should take 37-40ms on a 25Mhz NeXTstation Color.</font></td></tr>

<tr valign=top>

<td width=72 height=17></td></tr>

<tr valign=top>

<td width=72></td>

<td nowrap><font face="Times"><img src="../Images/bullet1.gif" width=4 height=8 vspace=3></font></td>

<td><font face="Times"><b>setpagedevice</b> raises a <b>configurationerror</b> if the current device is not a page device or a window device.&nbsp; If the current device is a page device, then <b>setpagedevice</b> behaves as documented in the <i>PostScript Language Reference Manual, 2nd Edition</i>.&nbsp; If the current device is a window device, then the dictionary given to <b>setpagedevice</b> is discarded and <b>erasepage</b> followed by <b>initgraphics</b> is executed.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td><font face="Times"><b>New (NeXT) PostScript Operators</b></font>

<p><font face="Times">The following PostScript operators have been added or modified since Release 2.0.&nbsp; The operators marked <i>internal</i> shouldn't be used in applications based on the Application Kit since your use of them may conflict with the Kit's.&nbsp; For descriptions of these operators, see the <i>NEXTSTEP General Reference.</i>&nbsp; (Use the Digital Librarian to view the on-line version of the reference manual.)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>image</b></font></td>

<td><font face="Times">% New DPS extension</font></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>setshowpageprocedure</b></font></td>

<td><font face="Times">% public</font></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>currentshowpageprocedure</b></font></td>

<td><font face="Times">% public</font></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>setframebuffertransfer</b></font></td>

<td><font face="Times">% public</font></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>settrackingrect</b></font></td>

<td><font face="Times">% new features</font></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>currentframebuffertransfer</b></font></td>

<td><font face="Times">% public</font></td></tr>

</table>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>currentshowpageprocedure</b></font></td>

<td><font face="Times"><i>win</i>&nbsp; <b>currentshowpageprocedure</b>&nbsp; <i>proc</i></font></td></tr>

<tr valign=top>

<td width=36 height=10></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">Returns the current showpage procedure for the window specified by <i>win</i>.&nbsp; The showpage procedure is a PostScript procedure which will be executed each time the <b>showpage </b>operator is executed when the currentdevice is the given window.</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">ERRORS</font><br>
<img src="../Images/sp.gif" width=18 height=1><font face="Times"><b>invalidid</b>, <b>stackunderflow</b>, <b>typecheck</b></font></td></tr>

<tr valign=top>

<td width=36 height=10></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">SEE ALSO</font><br>
<img src="../Images/sp.gif" width=18 height=1><font face="Times"><b>setshowpageprocedure</b></font></td></tr>

<tr valign=top>

<td width=36 height=18></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>currentframebuffertransfer</b></font></td>

<td><font face="Times"><i>fbnum</i> <b>currentframebuffertransfer</b>&nbsp; <i>redproc greenproc blueproc grayproc</i></font></td></tr>

<tr valign=top>

<td width=36 height=10></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">Returns the current transfer functions in effect for the framebuffer indexed by <i>fbnum.&nbsp; fbnum</i> ranges from 0 to <b>countframebuffers</b> - 1.</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">ERRORS</font><br>
<img src="../Images/sp.gif" width=18 height=1><font face="Times"><b>invalidid</b>, <b>stackunderflow</b>, <b>typecheck</b></font></td></tr>

<tr valign=top>

<td width=36 height=10></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">SEE ALSO</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=234></td>

<td><font face="Times"><b>setframebuffertransfer, countframebuffers, framebuffer</b></font></td></tr>

</table>

<p><br><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>setframebuffertransfer</b></font></td>

<td><font face="Times"><i>redproc greenproc blueproc grayproc&nbsp; fbnum </i><b>setframebuffertransfer</b></font></td></tr>

<tr valign=top>

<td width=36 height=10></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">Sets the framebuffer transfer functions in effect for the framebuffer indexed by <i>fbnum.&nbsp; fbnum</i> ranges from 0 to <b>countframebuffers</b> - 1.&nbsp; The framebuffer transfer describes the relationship between the framebuffer values of the display, and the voltage produced to drive the monitor. <b>Important</b>:&nbsp; these transfer functions are outside of the domain of PostScript Level 2's imaging model.&nbsp; NeXT's WindowServer&nbsp; assumes that the framebuffer values are directly proportional to&nbsp; screen brightness.&nbsp; This is important for the accuracy of dithering, compositing, and similar calculations.&nbsp; This API is provided only for the purpose of developers developing screen-calibration products.&nbsp; The default transfer for NeXT Color Displays is&nbsp; &#34;{ 1 2.2 div exp } bind dup dup {}&#34;.&nbsp; The procedures must be allocated in shared VM.</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">It is possible to make framebuffer transfer functions persist beyond the lifetime of the WindowServer by storing a property in the NetInfo `screens' database.&nbsp; In the local NetInfo domain, /localconfig/screens holds the configuration information for the screens known to the WindowServer (i.e. MegaPixel, NeXTdimension).&nbsp; These specify the layout and activation state of the screen.&nbsp; A new property for 3.0 has been added called `defaultTransfer'.&nbsp; This property can contain a string of PostScript code suitable for execution by the <b>setframebuffertransfer</b> operator (without the <i>fbnum </i>parameter).&nbsp; For example the following represents the NetInfo configuration for a NeXTdimension screen with a default gamma of 2.0.</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=216 height=1><font face="Courier" size="-1">localhost:1#&nbsp; niutil -read&nbsp; . /localconfig/screens/NeXTdimension</font><br>
<img src="../Images/sp.gif" width=216 height=1><font face="Courier" size="-1">name: NeXTdimension</font><br>
<img src="../Images/sp.gif" width=216 height=1><font face="Courier" size="-1">slot: 2</font><br>
<img src="../Images/sp.gif" width=216 height=1><font face="Courier" size="-1">unit: 0</font><br>
<img src="../Images/sp.gif" width=216 height=1><font face="Courier" size="-1">defaultTransfer: {1 2.0 div exp } dup dup dup</font><br>
<img src="../Images/sp.gif" width=216 height=1><font face="Courier" size="-1">bounds: 0 1120 0 832</font><br>
<img src="../Images/sp.gif" width=216 height=1><font face="Courier" size="-1">active: 1</font><br>
<img src="../Images/sp.gif" width=216 height=1><font face="Courier" size="-1">_writers: *</font>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=216></td>

<td><font face="Times">The NetInfo `defaultTransfer' property is used to configure the screen each time the WindowServer starts up.&nbsp; This allows monitor calibration products to save their settings so the next time the WindowServer starts up, the new values will be used.&nbsp; Note that in some cases, the NetInfo configuration state for a monitor will not have active == 1, although the monitor is being used by the WindowServer. This is because if no screens are marked `active' in NetInfo, the WindowServer uses a suitable default.&nbsp; If a screen is not marked `active' in NetInfo, the other properties (such as `defaultTransfer') are ignored.&nbsp; So be sure that the screen for which you are adding a `defaultTransfer'entry is marked `active'.</font>

<p><font face="Times">Monochrome devices will ignore <i>redproc, greenproc,</i> and <i>blueproc</i>, RGB devices will ignore <i>grayproc.</i></font>

<p><font face="Times"><b>setframebuffertransfer</b> is unsupported on the current generation of NeXT monochrome displays.</font>

<p><font face="Times">ERRORS</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=234></td>

<td><font face="Times"><b>invalidid</b>, <b>stackunderflow</b>, <b>typecheck</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=216></td>

<td><font face="Times">SEE ALSO</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=234></td>

<td><font face="Times"><b>setframebuffertransfer, countframebuffers, framebuffer</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>setshowpageprocedure</b></font></td>

<td><font face="Times"><i>proc win</i>&nbsp; <b>setshowpageprocedure</b>&nbsp; <i>-</i></font></td></tr>

<tr valign=top>

<td width=36 height=10></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">Sets the showpage procedure for the window specified by <i>win</i>.&nbsp; The showpage procedure is a PostScript procedure which will be executed each time the <b>showpage</b> operator is executed when the device in the current graphics state is the given window.&nbsp; <i>proc</i> must be allocated in shared VM.</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">ERRORS</font><br>
<img src="../Images/sp.gif" width=18 height=1><font face="Times"><b>invalidid</b>, <b>stackunderflow</b>, <b>typecheck</b></font></td></tr>

<tr valign=top>

<td width=36 height=10></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">SEE ALSO</font><br>
<img src="../Images/sp.gif" width=18 height=1><font face="Times"><b>currentshowpageprocedure</b></font></td></tr>

<tr valign=top>

<td width=36 height=18></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>settrackingrect</b></font></td>

<td><font face="Times"><i>x y width height optionarray trectnum gstate </i><b>settrackingrect -</b></font></td></tr>

<tr valign=top>

<td width=36 height=10></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">In this alternate form, <b>settrackingrect</b>, can be used to set special event-gathering attributes of a rectangle.&nbsp; In this case events are not generated when the boundary is crossed, but certain low-level event system options can be controlled in the rectangle. <i>optionarray</i> contains key-value pairs that can, for example, affect pressure sensitivity in a rectangle.</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">This is an extensible API allowing the addition of new options as they are needed.&nbsp; Eventually the old tracking rect paramters will be subsumed by this new form of the operator. An empty option array is meaningless and will raise a <b>rangecheck</b> error.&nbsp; This form of the operator does not currently post mouse-entered and mouse-exited events. The following key-value pairs for <i>optionarray</i> are initially defined:</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=219></td>

<td nowrap><font face="Times"><b>Key</b></font></td>

<td nowrap><font face="Times"><b>Type</b></font></td>

<td><font face="Times"><b>Semantics</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>Pressure</b></font></td>

<td nowrap><font face="Times">bool</font></td>

<td><font face="Times">treat any non-zero pressure values as a mouse-down.&nbsp; (false is default)</font></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>Coalesce</b></font></td>

<td nowrap><font face="Times">bool</font></td>

<td><font face="Times">coalesce mouse motion events (true is default)</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=216></td>

<td><img src="../Images/sp.gif" width=3 height=1><font face="Times">Use the existing <b>cleartrackingrect</b> operator to remove special tracking rects.&nbsp; An example which turns pressure on and coalescing off would be:</font></td></tr>

</table>

<p><img src="../Images/sp.gif" width=216 height=1><font face="Courier" size="-1">x y width height [/Pressure true /Coalesce false] trectnum gstate settrackingrect</font>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=216></td>

<td><font face="Times">ERRORS</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=234></td>

<td><font face="Times"><b>invalidid</b>, <b>stackunderflow</b>, <b>typecheck</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=216></td>

<td><font face="Times">SEE ALSO</font></td></tr>

</table>

<p><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=36></td>

<td nowrap><font face="Times"><b>image</b></font></td>

<td><font face="Times"><i>dict</i>&nbsp; <b>image&nbsp; -</b></font></td></tr>

<tr valign=top>

<td width=36 height=10></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">The Level 2 image operator has been extended for Display PostScript Systems only.&nbsp; The changes allow the image operator to use a window as source sample data. There are several reasons why an application may want to do this.&nbsp; For example, an application for viewing large photographic images such as satellite images can use the image operator for panning and zooming. If the image data is placed in an off-screen window, panning can be accomplished by copying the data to the on-screen window, and zooming can be accomplished by copying the data with a scale.&nbsp; In this example, pixel expansion is desirable, so that all of the image data is seen. Another example in which a scale in the transformation is useful, is with bitmap editors. The pixels can be magnified for editing, then changed in the source sample data. Finally there is the advantage of&nbsp; using image data that is already accessible to the server. This improves performance since the image data does not need to be transferred from the client to the server. It is especially important if the server executes on a different system or processor than the client.</font></td></tr>

<tr valign=top>

<td width=36 height=30></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times"><b>Image Dictionary Changes</b></font></td></tr>

<tr valign=top>

<td width=36 height=18></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">Below is a description of the image dictionary for when windows are used as sources. In this case ImageType has a value of 2, and only the keys described in the table below have significance.</font></td></tr>

<tr valign=top>

<td width=36 height=15></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">The <b>DataSource</b> entry can now be a graphics state object. The graphics state object contains a reference to the destination device. It is used as a device independent representation of a window. The pixel representation of the source and the color space for the image is determined by the device in the source graphics state object.&nbsp; The only information used in the source graphics state is the device structure and the CTM. No assumptions about how the source was created will be made by the interpreter. Therefore it is up to the user to make sure that the desired effects will happen with the current transfer function and halftone screen. If the source gstate is the current gstate, and the source rectangle overlaps the destination, then the image will be rendered as if all of the source pixels had been read before imaging to the destination.</font></td></tr>

<tr valign=top>

<td width=36 height=15></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times">The <b>UnpaintedPath</b> entry is used when the pixels in a window were not available because the source rectangle includes areas outside of the clipping area for the window. This region is defined by the intersection of the source gstate's clip, the source gstate's viewclip, and the underlying window system's clip for the window. The <b>UnpaintedPath </b>will contain a userpath that encloses the entire area that was not available in the source. The userpath may be larger than the actual area that needs to be repainted, therefore a clip based on the source rectangle should be used. This clip, in addition to the <b>UnpaintedPath</b> can be used a clip for redrawing the PostScript code that created the source window, into the destination. Applications need to consider if a scale was used because pixel expansion or image interpolation can occur. In those cases, the missing area needs to be rendered off-screen and then reimaged into the missing area. In most cases, an application will not have to worry about handling missing pixels, because this can be taken care of in a tool kit. The <b>UnpaintedPath</b> entry will be filled in by the image operator only if the key exists in the image dictionary that is passed to image. Otherwise, the unpainted area will not be calculated and returned.</font></td></tr>

<tr valign=top>

<td width=36 height=17></td></tr>

<tr valign=top>

<td width=36></td>

<td nowrap></td>

<td><font face="Times"><b>PixelCopy</b> is used when the application does not want the color conversion, transfer function or halftone screen to have an effect on the image operation. This is useful when the source window was generated by another imaging model besides PostScript. It's color space may not be part of the PostScript imaging model, but the data can still be copied and transformed.</font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=219></td>

<td nowrap><font face="Times"><b>Key</b></font></td>

<td nowrap><font face="Times"><b>Type</b></font></td>

<td><font face="Times"><b>Semantics</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>ImageType</b></font></td>

<td nowrap><font face="Times">integer</font></td>

<td><font face="Times">(<i>Required</i>)&nbsp; Must be 2 for gstate object sources.</font></td></tr>

<tr valign=top>

<td width=216 height=17></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>XOrigin</b></font></td>

<td nowrap><font face="Times">real</font></td>

<td><font face="Times">(<i>Required</i>)&nbsp; X origin of source rectangle in user space coordinates as specified by the transformation in the <b>DataSource</b> graphics state object.</font></td></tr>

<tr valign=top>

<td width=216 height=17></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>YOrigin</b></font></td>

<td nowrap><font face="Times">real</font></td>

<td><font face="Times">(<i>Required</i>) Y origin of source rectangle in user space coordinates as specified by the transformation in the <b>DataSource</b> graphics state object.</font></td></tr>

<tr valign=top>

<td width=216 height=17></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>Width</b></font></td>

<td nowrap><font face="Times">real</font></td>

<td><font face="Times">(<i>Required</i>) Width of the rectangle to be copied in user space coordinates as specified by the transformation in the <b>DataSource</b> graphics state object.</font></td></tr>

<tr valign=top>

<td width=216 height=17></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>Height</b></font></td>

<td nowrap><font face="Times">real</font></td>

<td><font face="Times">(<i>Required</i>) Height of the rectangle to be copied in user space coordinates as specified by the transformation in the <b>DataSource</b> graphics state object.</font></td></tr>

<tr valign=top>

<td width=216 height=17></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>ImageMatrix</b></font></td>

<td nowrap><font face="Times">array</font></td>

<td><font face="Times">no change</font></td></tr>

<tr valign=top>

<td width=216 height=17></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>DataSource</b></font></td>

<td nowrap><font face="Times">gstate</font></td>

<td><font face="Times">(<i>Required</i>) A gstate object that contains the device that will be used for the source sample data. This device will also be used to determine the pixel representation for the source, and the color space to be used by image.</font></td></tr>

<tr valign=top>

<td width=216 height=17></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>Interpolate</b></font></td>

<td nowrap><font face="Times">boolean</font></td>

<td><font face="Times">no change</font></td></tr>

<tr valign=top>

<td width=216 height=17></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>UnpaintedPath</b></font></td>

<td nowrap><font face="Times">various</font></td>

<td><font face="Times">(<i>Returned Value</i>) If some of the pixels in the source were not available (because of clipping), then the <b>UnpaintedPath</b> entry contains a userpath in the current (destination) user space coordinates, that encloses the area that could not be filled. If all of the source pixels could be accessed, then the <b>UnpaintedPath</b> entry will contain a null object.</font></td></tr>

<tr valign=top>

<td width=216 height=68></td></tr>

<tr valign=top>

<td width=216></td>

<td nowrap><font face="Times"><b>PixelCopy</b></font></td>

<td nowrap><font face="Times">boolean</font></td>

<td><font face="Times">(<i>Optional</i>) If true, indicates that the source pixels should be copied directly, without going through the normal color conversion, transfer function, or halftoning. The number of bits per pixel of the source must match the number of bits per pixel of the destination, otherwise a <b>typecheck</b> error will occur. If false or not present, the pixels will be imaged in the usual way.</font></td></tr>

</table>

<p><br><br>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=216></td>

<td><font face="Times">Using image with gstate sources is similar to using image with any other sample data. One difference that should be considered is the source gstate's transformation matrix. Since the source rectangle is specified in the source's user space coordinates, the source gstate's CTM is included in the transformation. Therefore the mapping from the current user space to the image space is defined by the concatenation of the image matrix&nbsp; and the source gstate's CTM.</font>

<p><font face="Times">ERRORS</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=234></td>

<td><font face="Times"><b>invalidid</b>, <b>rangecheck</b>, <b>stackunderflow</b>, <b>typecheck</b></font></td></tr>

</table>

<p>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=216></td>

<td><font face="Times">SEE ALSO</font></td></tr>

</table>

<table cellspacing=0 cellpadding=0>

<tr valign=top>

<td width=234></td>

<td><font face="Times"><b>alphaimage</b>, <b>colorimage</b>, <b>image (red book)</b></font></td></tr>

</table>



<p>

</body>
</html>
